[module]
name = Entwicklung (BO)
short_description = Spielwiese für Ottiger Beat
type = patient
id = org.optinomic.template.test



[dependencies]

[description]
Mein kleine Spielwiese


[developer]
first_name = Beat
last_name = Ottiger
github_user = ottigerb
email = beat@optinomic.com
company = Optinomic Gmbh
phone = +41 (0)44 508 26 76
website = https://www.optinomic.com/

[readme]
## Entwicklung (BO)


### Entwickler
This patient-app `org.optinomic.template.test` is currently HOTLOADED!



[template START 6 6]
<head>
    <meta content="Optinomic GmbH" name="author">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui" name="viewport">
</head>
<div id="optinomic_app">
    <v-app style="background:#f8f8f8;background-color:#f8f8f8">
    <v-content>
        <v-container>
<app-optinomic title="Fragebogenauswertung" subtitle="Eine Übersicht der wichtigsten Ergebnisse und Auswertungen.">
    <app-fallkonferenz></app-fallkonferenz>
</app-optinomic>
        </v-container>
    </v-content>
    </v-app>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuex@2.x/dist/vuex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.js"></script>
<script>

// ----------------------------------------
// Current App Components
// ----------------------------------------


// Optinomic App-data
Vue.component('app-data', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    computed: {
        app_loading() {
            try {
                if (this.$store.state.data_apps.data_object[this.identifier]) {
                    return false;
                } else {
                    return true;    
                };
            } catch (e) {
                return true;
            };
        },
        app_have_data() {
            try {
                if (this.$store.state.data_apps.data_object[this.identifier].data.length > 0) {
                    return true;
                } else {
                    return false;    
                };
                return ;
            } catch (e) {
                return false;
            };
        },
    },
    methods: {},
    template: `
        <template>
            <div v-if="app_loading">
                <v-skeleton-loader
                    class="mx-auto"
                    type="card"
                ></v-skeleton-loader>
            </div>
            <div v-else>
                <div v-if="app_have_data">
                    <slot></slot>    
                </div>
                <div v-else>
                    <v-alert prominent text type="info">
                        Es sind keine Messdaten vorhanden.
                    </v-alert>
                </div>
            </div>
        </template>
    `
});

// app-fallkonferenz
Vue.component('app-fallkonferenz', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        },
        production: {
            type: Boolean,
            default: true
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_apps": {
                "production": [{
                        "name": "actinfo",
                        "title": "ActInfo",
                        "subtitle": "Information network on addiction care and therapy",
                        "identifier": "ch.suedhang.apps.actinfo_ein.production"
                    },
                    {
                        "name": "tmt",
                        "title": "TMT",
                        "subtitle": "Trail Making Test",
                        "identifier": "ch.suedhang.apps.tmt.production"
                    },
                    {
                        "name": "bdi",
                        "title": "BDI-II",
                        "subtitle": "Beck Depressions-Inventar",
                        "identifier": "ch.suedhang.apps.bdi.production"
                    },
                    {
                        "name": "asrs",
                        "title": "ASRS",
                        "subtitle": "ADHS-Screening",
                        "identifier": "ch.suedhang.apps.asrs.production"
                    },
                    {
                        "name": "aase",
                        "title": "AASE-G",
                        "subtitle": "Alcohol Abstinence Self-Effcacy | Skala Versuchung",
                        "identifier": "ch.suedhang.apps.aase-g.production"
                    },
                    {
                        "name": "bscl",
                        "title": "BSCL",
                        "subtitle": "Brief Symptom Checklist",
                        "identifier": "ch.suedhang.apps.bscl_anq.production"
                    },
                    {
                        "name": "isk",
                        "title": "ISK-K",
                        "subtitle": "Inventar Sozialer Kompetenzen - Kurzform",
                        "identifier": "ch.suedhang.apps.isk.production"
                    },
                    {
                        "name": "whoqol",
                        "title": "WHOQOL",
                        "subtitle": "WHO Quality of Life - Kurzform",
                        "identifier": "ch.suedhang.apps.whoqol.production"
                    },
                    {
                        "name": "sci",
                        "title": "SCI",
                        "subtitle": "Stress-Coping-Inventar",
                        "identifier": "ch.suedhang.apps.sci.production"
                    },
                    {
                        "name": "rs13",
                        "title": "RS-13",
                        "subtitle": "Resilienzfragebogen",
                        "identifier": "ch.suedhang.apps.rs13.production"
                    }
                ]
            },
            "pdf_contents": {}
        }
    },
    methods: {
        get_app_sr(name) {
            try {
                if (this.production) {
                    var return_obj = null;
                    this.pdf_apps.production.forEach(function (app) {
                        if (app.name === name) {
                            return_obj = this.$store.state.data_apps.data_object[app.identifier];
                        };
                    }.bind(this));
                    return return_obj;
                };
            } catch (err) {
                console.error('get_app_sr', err);
                return null;
            }
        },
        get_current_patient_module(name) {
            try {
                if (this.production) {

                    var return_obj = null;
                    this.pdf_apps.production.forEach(function (app) {
                        if (app.name === name) {
                            this.patient_modules.forEach(function (mod) {
                                if (mod.identifier === app.identifier) {
                                    return_obj = Object.assign({}, mod.module);
                                };
                            }.bind(this));
                        };
                    }.bind(this));
                    return return_obj;
                };
            } catch (err) {
                console.error('get_current_patient_module', err);
                return null;
            }
        },
        get_app_pdf_content(identifier) {
            try {
                return this.pdf_contents[identifier];
            } catch (err) {
                console.error('get_app_pdf_content', err);
                return [];
            }
        }
    },
    computed: {
        pdf_apps_array() {
            try {
                if (this.production) {
                    return this.pdf_apps.production;
                } else {
                    return null;
                };
            } catch (err) {
                console.error('pdf_apps_array', err);
                return null;
            }
        },
        pdf_apps_ready() {
            try {
                // Build App PDF's

                var return_ready = false;

                if (this.production && this.patient_modules) {
                    
                    this.pdf_apps.production.forEach(function (app) {

                        var sr_data = this.get_app_sr(app.name);
                        var app_data = this.get_current_patient_module(app.name);
                        
                        if (sr_data && app_data) {

                            if (app.name === 'aase') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.aase_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'actinfo_ein') {
                                var sr_data_aus = this.get_app_sr('actinfo_aus');
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.actinfo_pdf_content(sr_data, sr_data_aus));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };


                            if (app.name === 'bdi') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.bdi_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'bscl') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.bscl_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'isk') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.iskk_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };
 
                            if (app.name === 'rs13') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.rs13_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'sci') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.sci_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'tmt') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.tmt_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            if (app.name === 'whoqol') {
                                // Build PDF
                                var pdf = [];
                                pdf.push(this.pdf_app_info(app_data, true));
                                pdf.push(this.whoqol_pdf_content(sr_data));
                                // Store
                                this.pdf_contents[app.name] = pdf.slice();
                            };

                            return_ready = true;
                        };

                    }.bind(this));
                    return return_ready;
                };


            } catch (err) {
                console.error('pdf_apps_ready', err);
                return false;
            }
        }
    },
    created() {
        if (this.production) {
            this.pdf_apps.production.forEach(function (params) {
                this.$store.dispatch('getSurveyResponses', params);
            }.bind(this));
        };
    },
    template: `
    <div>
        <optinomic-content-block bold title="Fallkonferenz" subtitle="Übersicht - Applikationen" id="app_overview">
            <v-tabs vertical show-arrows center-active color="#8b0042">
                <v-tab class="caption" v-for="app in pdf_apps_array" :key="app.name">
                    <span v-text="app.title"></span>
                </v-tab>
    
                <v-tab-item v-for="app in pdf_apps_array" :key="app.name">
                    <v-card flat>
                        <v-card-text>
    
                            <h2 class="display-1 font-weight-medium" v-text="app.title"
                                style="color:black;margin-top:-8px;"></h2>
                            <p class="overline" style="margin-left:1px;color:#8b0042" v-text="app.subtitle"></p>
    
                            <app-data :identifier="app.identifier" v-if="app.name === 'actinfo'">
                                <app-actinfo production></app-actinfo>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'tmt'">
                                <app-tmt :identifier="app.identifier"></app-tmt>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'bdi'">
                                <app-bdi :identifier="app.identifier"></app-bdi>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'asrs'">
                                <app-asrs :identifier="app.identifier"></app-asrs>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'aase'">
                                <app-aase :identifier="app.identifier"></app-aase>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'bscl'">
                                <app-bscl :identifier="app.identifier"></app-bscl>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'isk'">
                                <app-isk :identifier="app.identifier"></app-isk>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'whoqol'">
                                <app-whoqol :identifier="app.identifier"></app-whoqol>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'sci'">
                                <app-sci :identifier="app.identifier"></app-sci>
                            </app-data>
    
                            <app-data :identifier="app.identifier"  v-if="app.name === 'rs13'">
                                <app-rs13 :identifier="app.identifier"></app-rs13>
                            </app-data>
                        </v-card-text>
                    </v-card>
                </v-tab-item>
            </v-tabs>
        </optinomic-content-block>
    
        <optinomic-content-block bold title="Fragebogenauswertung" subtitle="Fallkonferenz (Gesamt)"
            id="pdf_gesamtauswertung">
            <pdf-auswertung-gesamt></pdf-auswertung-gesamt>
        </optinomic-content-block>
    </div>
    `
});


// AASE-G | Application
Vue.component('app-aase', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": []
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.aase_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="AASE-G" subtitle="Übersicht | Grafik" id="aase_chart">
                    <optinmic-profile-chart 
                        :options="aase_chart.options"
                        :scales="aase_chart.scales" 
                        :ranges="aase_chart.ranges"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="AASE-G | Skala Versuchung"
                        header-right="Klinik Südhang" document-title="AASE_G" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// app-actinfo | Application
Vue.component('app-actinfo', {
    props: {
        production: {
            type: Boolean,
            default: true
        }
    },
    data: function () {
        return {
            "apps": {
                "production": [{
                        "name": "actinfo_ein",
                        "title": "ActInfo",
                        "subtitle": "Information network on addiction care and therapy",
                        "identifier": "ch.suedhang.apps.actinfo_ein.production"
                    },
                    {
                        "name": "actinfo_aus",
                        "title": "ActInfo",
                        "subtitle": "Information network on addiction care and therapy",
                        "identifier": "ch.suedhang.apps.actinfo_aus.production"
                    }
                ]
            },
            "pdf_content": []
        }
    },
    created() {
        // Load Data
        try {
            if (this.production === true) {
                this.apps.production.forEach(function (app) {
                    var params = {
                        "name": app.name,
                        "title": app.title,
                        "subtitle": app.subtitle,
                        "identifier": app.identifier
                    };
                    this.$store.dispatch('getSurveyResponses', params);
                }.bind(this));
            };
        } catch (err) {
            console.error('created - actInfo', err);
        }
    },
    methods: {},
    computed: {
        data_ein() {
            // ActInfo Ein Data
            try {
                if (this.production === true) {
                    var data_ein = null;
                    this.apps.production.forEach(function (app) {
                        if (app.name === "actinfo_ein") {
                            data_ein = this.$store.state.data_apps.data_object[app.identifier];
                            console.log('(✔) actInfo: data_ein', data_ein);
                        };
                    }.bind(this));
                    return data_ein;
                };
            } catch (err) {
                console.error('(!) actInfo: data_ein', err);
                return null;
            }
        },
        data_ein_last() {
            // Get Last Data of Data Ein
            try {
                var data_ein_last = this.data_ein.data[this.data_ein.data.length-1];
                console.log('(✔) actInfo: data_ein_last', data_ein_last);
                return data_ein_last
            } catch (err) {
                console.error('(!) actInfo: data_ein', err);
                return null;
            }
        },
        problemsubstanzen() {
            // Get Last Data of Data Ein
            try {
                if (this.data_ein_last.calculation.actinfo_ein.problemsubstanzen.substanzen.length > 1) {
                    return 'Problemsubstanzen'
                } else {
                    return 'Problemsubstanz'
                };
            } catch (err) {
                return 'Problemsubstanz'
            }
        },
        hauptproblem_substanz() {
            // Get Last Data of Data Ein
            try {
                var h = this.data_ein_last.calculation.actinfo_ein.zusatzangaben.hauptproblem_substanz_text;
                if ((h !== null) && (h !== '')) {
                    return h;
                } else {
                    return 'Häufigkeit'
                };
            } catch (err) {
                return 'Häufigkeit'
            }
        },
        data_aus() {
            // ActInfo Aus Data
            try {
                if (this.production === true) {
                    var data_aus = null;
                    this.apps.production.forEach(function (app) {
                        if (app.name === "actinfo_aus") {
                            data_aus = this.$store.state.data_apps.data_object[app.identifier];
                            console.log('(✔) actInfo: data_aus', data_aus);
                        };
                    }.bind(this));
                    return data_aus;
                };
            } catch (err) {
                console.error('(!) actInfo: data_aus', err);
                return null;
            }
        },
        data_merged() {
            // Merge Data ActInfo Ein/Aus
            try {
                    var return_obj = null;
                    if ((this.data_ein !== undefined) && (this.data_aus !== undefined)) {
                        return_obj = this.merge_data_ein_aus(this.data_ein, this.data_aus);
                        console.log('(✔) actInfo: data_merged', return_obj);
                    };
                    return return_obj;
            } catch (err) {
                console.error('(!) actInfo: data_merged', err);
                return null;
            }
        },
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.data_ein) && (this.data_aus) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.actinfo_pdf_content(this.data_ein, this.data_aus));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="data_merged">
                <optinomic-content-block v-if="data_merged.actinfo_ein_data" :title="problemsubstanzen" :subtitle="hauptproblem_substanz" id="actinfo_substanz">
                    <p v-text="data_ein_last.calculation.actinfo_ein.problemsubstanzen.description"></p>
                    <ol class="ml-4">
                        <li class="mb-3" v-for="s in data_ein_last.calculation.actinfo_ein.problemsubstanzen.substanzen" :key="s.substanz">
                            <b v-text="s.substanz + ': '"></b>
                            <span v-text="s.label"></span>
                        </li>
                    </ol>
                    <div v-if="data_ein_last.calculation.actinfo_ein.zusatzangaben">
                        <p class="title font-weight-light mt-8">Zusatzangaben</p>
                        <optinomic-clipboard-text :text="data_ein_last.calculation.actinfo_ein.zusatzangaben.kunsumalter_text + ' ' + data_ein_last.calculation.actinfo_ein.zusatzangaben.entzuege_text"></optinomic-clipboard-text>
                    </div>
                </optinomic-content-block>

                <optinomic-content-block v-if="data_merged.show_audit" title="Alkoholabhängigkeit" subtitle="Alcohol Use Disorders Identification (AUDIT)" id="actinfo_audit">
                    <optinomic-clipboard-text :text="data_merged.audit_text"></optinomic-clipboard-text>
                    <optinmic-profile-chart 
                        :options="actinfo_audit_chart.options"
                        :scales="actinfo_audit_chart.scales" 
                        :ranges="actinfo_audit_chart.ranges"
                        :scores="data_merged">
                    </optinmic-profile-chart>
                </optinomic-content-block>

                <optinomic-content-block v-if="data_merged.show_fagerstoem" title="Nikotinabhängigkeit" subtitle="Fagerström" id="actinfo_fagerstroem">
                    <optinomic-clipboard-text :text="data_merged.fagerstroem_text"></optinomic-clipboard-text>
                    <optinmic-profile-chart 
                        :options="actinfo_fagerstroem_chart.options"
                        :scales="actinfo_fagerstroem_chart.scales" 
                        :ranges="actinfo_fagerstroem_chart.ranges"
                        :scores="data_merged">
                    </optinmic-profile-chart>
                </optinomic-content-block>
                
                <optinomic-content-block show_in_toc="false" v-if="!data_merged.actinfo_ein_aus_data" title="Missings" subtitle="Datenhinweis"  id="actinfo_hinweis">
                    <v-alert dense outlined text type="warning" v-if="!data_merged.actinfo_ein_data">
                        actInfo | Eintritt: Noch nicht erfasst.
                    </v-alert>
                    <v-alert dense outlined text type="info" v-if="!data_merged.actinfo_aus_data">
                        actInfo | Austritt: Noch nicht erfasst.
                    </v-alert>
                </optinomic-content-block>
                
                
            </div>
            <div v-else lass="mt-12">
                <v-sheet class="mt-12 mb-3">
                    <v-skeleton-loader class="mx-auto" type="article, sentence, article"></v-skeleton-loader>
                </v-sheet>
            </div>

            <div v-if="pdf_ready">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="act-info"
                        header-right="Klinik Südhang" document-title="actInfo" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// ASRS | Application
Vue.component('app-asrs', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": []
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.asrs_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="ADHS-Screening (ASRS)" subtitle="Übersicht | Grafik" id="aase_chart">
                    <optinmic-profile-chart 
                        :options="asrs_chart.options"
                        :scales="asrs_chart.scales" 
                        :ranges="asrs_chart.ranges"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="ASRS | ADHS-Screening"
                        header-right="Klinik Südhang" document-title="ASRS" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// TMT - Application
Vue.component('app-tmt', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": [],
            "data_table": {
                "rows": [{
                        "name": "Messzeitpunkt",
                        "variable": "Zeitpunkt",
                        "path": "calculation.tmt_score.Messzeitpunkt.Messzeitpunkt_Text_Quotient",
                        "interpretation": "mz"
                    },
                    {
                        "name": "Erfassungsdatum",
                        "variable": "Datum",
                        "path": "calculation.tmt_score.date",
                        "interpretation": "date"
                    },
                    {
                        "name": "TMT A | Zeit",
                        "variable": "TMT_A_Time",
                        "path": "calculation.tmt_score.TMTATime"
                    },
                    {
                        "name": "TMT A | Fehler",
                        "variable": "TMT_A_Error",
                        "path": "calculation.tmt_score.TMTAError"
                    },
                    {
                        "name": "TMT A | Z-Wert",
                        "variable": "TMT_B_Z",
                        "path": "calculation.tmt_score.percentile.z_scores.tmtA_z_neu_rounded"
                    },
                    {
                        "name": "TMT B | Zeit",
                        "variable": "TMT_B_Time",
                        "path": "calculation.tmt_score.TMTBTime"
                    },
                    {
                        "name": "TMT B | Fehler",
                        "variable": "TMT_B_Error",
                        "path": "calculation.tmt_score.TMTBError"
                    },
                    {
                        "name": "TMT B | Z-Wert",
                        "variable": "TMT_B_Z",
                        "path": "calculation.tmt_score.percentile.z_scores.tmtB_z_neu_rounded"
                    }
                ]
            }
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.tmt_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="Trail Making Test (TMT)" subtitle="Übersicht | Grafik" id="tmt_chart">
                    <optinmic-profile-chart 
                        :options="tmt_chart.options"
                        :scales="tmt_chart.scales" 
                        :ranges="tmt_chart.ranges"
                        :clinic_samples="included_tmt_cs"
                        :clinic_sample_dive="tmt_get_cs_dive(sr)"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <optinomic-content-block :subtitle="sr_count_text" title="Datenblatt" id="tmt_data_table">
                <optinomic-data-table :rows="data_table.rows" :interpretations="data_table.interpretations" :sr="sr_data">
                </optinomic-data-table>
            </optinomic-content-block>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Trail Making Test (TMT)"
                        header-right="Klinik Südhang" document-title="TMT" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// BDI-II Application
Vue.component('app-bdi', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": [],
            "data_table": {
              "rows": [
                {
                    "name": "Messzeitpunkt",
                    "variable": "BDI_MZ",
                    "path": "response.Erhebungszeitpunkt",
                    "interpretation": "mz"
                  },
                  {
                    "name": "Erfassungsdatum",
                    "variable": "Daum",
                    "path": "response.Datum",
                    "interpretation": "date"
                  },
                  {
                    "name": "1. Traurigkeit",
                    "variable": "BDI_01",
                    "path": "response.BDI1",
                    "interpretation": "traurigkeit"
                  },
                  {
                    "name": "2. Pessimismus",
                    "variable": "BDI_02",
                    "path": "response.BDI2",
                    "interpretation": "pessimismus"
                  },
                  {
                    "name": "3. Versagensgefühle",
                    "variable": "BDI_03",
                    "path": "response.BDI3",
                    "interpretation": "versagensgefühle"
                  },
                  {
                    "name": "4. Verlust von Freude",
                    "variable": "BDI_04",
                    "path": "response.BDI4",
                    "interpretation": "verlust_von_freude"
                  },
                  {
                    "name": "5. Schuldgefühle",
                    "variable": "BDI_05",
                    "path": "response.BDI5",
                    "interpretation": "schuld"
                  },
                  {
                    "name": "6. Bestrafungsgefühle",
                    "variable": "BDI_06",
                    "path": "response.BDI6",
                    "interpretation": "bestrafung"
                  },
                  {
                    "name": "7. Selbstablehnung",
                    "variable": "BDI_07",
                    "path": "response.BDI7",
                    "interpretation": "selbstablehnung"
                  },
                  {
                    "name": "8. Selbstvorwürfe",
                    "variable": "BDI_08",
                    "path": "response.BDI8",
                    "interpretation": "selbstvorwuerfe"
                  },
                  {
                    "name": "9. Selbstmordgedanken",
                    "variable": "BDI_09",
                    "path": "response.BDI9",
                    "interpretation": "suizidalitaet"
                  },
                  {
                    "name": "10. Weinen",
                    "variable": "BDI_10",
                    "path": "response.BDI10",
                    "interpretation": "weinen"
                  },
                  {
                    "name": "11. Unruhe",
                    "variable": "BDI_11",
                    "path": "response.BDI11",
                    "interpretation": "unruhe"
                  },
                  {
                    "name": "12. Interessenverlust",
                    "variable": "BDI_12",
                    "path": "response.BDI12",
                    "interpretation": "interessenverlust"
                  },
                  {
                    "name": "13. Entschlussunfähigkeit",
                    "variable": "BDI_13",
                    "path": "response.BDI13",
                    "interpretation": "entschluss"
                  },
                  {
                    "name": "14. Wertlosigkeit",
                    "variable": "BDI_14",
                    "path": "response.BDI14",
                    "interpretation": "wert"
                  },
                  {
                    "name": "15. Energieverlust",
                    "variable": "BDI_15",
                    "path": "response.BDI15",
                    "interpretation": "energieverlust"
                  },
                  {
                    "name": "16. Veränderungen der Schlafgewohnheiten",
                    "variable": "BDI_16",
                    "path": "response.BDI16",
                    "interpretation": "schlaf"
                  },
                  {
                    "name": "17. Reizbarkeit",
                    "variable": "BDI_17",
                    "path": "response.BDI17",
                    "interpretation": "reizbarkeit"
                  },
                  {
                    "name": "18. Veränderungen des Appetits",
                    "variable": "BDI_18",
                    "path": "response.BDI18",
                    "interpretation": "appetit"
                  },
                  {
                    "name": "19. Konzentrationsschwierigkeiten",
                    "variable": "BDI_19",
                    "path": "response.BDI19",
                    "interpretation": "konzentration"
                  },
                  {
                    "name": "20. Ermüdung und Erschöpfung",
                    "variable": "BDI_20",
                    "path": "response.BDI20",
                    "interpretation": "ermuedung"
                  },
                  {
                    "name": "21. Verlust an sexuellem Interesse",
                    "variable": "BDI_21",
                    "path": "response.BDI21",
                    "interpretation": "sexualität"
                  },
                  {
                    "name": "Summenscore",
                    "variable": "Score",
                    "path": "calculation.bdi_score.score.score"
                  },
                  {
                    "name": "Interpretation",
                    "variable": "BDI-II",
                    "path": "calculation.bdi_score.score.current_range.interpretation_de"
                  }
              ],
              "interpretations": {
                "mz": [
                  {
                    "value": "1",
                    "text": "Eintritt"
                  },
                  {
                    "value": "2",
                    "text": "Austritt"
                  },
                  {
                    "value": "3",
                    "text": "Anderer Messzeitpunkt"
                  }
                ],
                "traurigkeit": [
                  {
                    "value": "0",
                    "text": "Ich bin nicht traurig"
                  },
                  {
                    "value": "1",
                    "text": "Ich bin oft traurig"
                  },
                  {
                    "value": "2",
                    "text": "Ich bin ständig traurig"
                  },
                  {
                    "value": "3",
                    "text": "Ich bin so traurig oder unglücklich, dass ich es nicht aushalte"
                  }
                ],
                "pessimismus": [
                  {
                    "value": "0",
                    "text": "Ich sehe nicht mutlos in die Zukunft"
                  },
                  {
                    "value": "1",
                    "text": "Ich sehe mutloser in die Zukunft als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich bin mutlos und erwarte nicht, dass meine Situation besser wird"
                  },
                  {
                    "value": "3",
                    "text": "Ich glaube, dass meine Zukunft hoffnungslos ist und nur noch schlechter wird"
                  }
                ],
                "versagensgefühle": [
                  {
                    "value": "0",
                    "text": "Ich fühle mich nicht als Versager"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe häufiger Versagensgefühle"
                  },
                  {
                    "value": "2",
                    "text": "Wenn ich zurückblicke, sehe ich eine Menge Fehlschläge"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe das Gefühl, als Mensch ein völliger Versager zu sein"
                  }
                ],
                "verlust_von_freude": [
                  {
                    "value": "0",
                    "text": "Ich kann Dinge genauso gut geniessen wie früher"
                  },
                  {
                    "value": "1",
                    "text": "Ich kann Dinge nicht mehr so geniessen wie früher"
                  },
                  {
                    "value": "2",
                    "text": "Dinge, die mir früher Freude gemacht haben, kann ich kaum mehr geniessen"
                  },
                  {
                    "value": "3",
                    "text": "Dinge, die mir früher Freude gemacht haben, kann ich überhaupt nicht mehr geniessen"
                  }
                ],
                "schuld": [
                  {
                    "value": "0",
                    "text": "Ich habe keine besonderen Schuldgefühle"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe oft Schuldgefühle wegen Dingen, die ich getan habe oder hätte tun sollen"
                  },
                  {
                    "value": "2",
                    "text": "Ich habe die meiste Zeit Schuldgefühle"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe ständig Schuldgefühle"
                  }
                ],
                "bestrafung": [
                  {
                    "value": "0",
                    "text": "Ich habe nicht das Gefühl, für etwas bestraft zu sein"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe das Gefühl, vielleicht bestraft zu werden"
                  },
                  {
                    "value": "2",
                    "text": "Ich erwarte, bestraft zu werden"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe das Gefühl, bestraft zu sein"
                  }
                ],
                "selbstablehnung": [
                  {
                    "value": "0",
                    "text": "Ich halte von mir genauso viel wie immer"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe Vertrauen in mich verloren"
                  },
                  {
                    "value": "2",
                    "text": "Ich bin von mir enttäuscht"
                  },
                  {
                    "value": "3",
                    "text": "Ich lehne mich völlig ab"
                  }
                ],
                "selbstvorwuerfe": [
                  {
                    "value": "0",
                    "text": "Ich kritisiere oder tadle mich nicht mehr als sonst"
                  },
                  {
                    "value": "1",
                    "text": "Ich bin mir gegenüber kritischer als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich kritisiere mich für all meine Mängel"
                  },
                  {
                    "value": "3",
                    "text": "Ich gebe mir die Schuld für alles Schlimme, was passiert"
                  }
                ],
                "suizidalitaet": [
                  {
                    "value": "0",
                    "text": "Ich denke nicht daran, mir etwas anzutun"
                  },
                  {
                    "value": "1",
                    "text": "Ich denke manchmal an Selbstmord, aber ich würde es nicht tun"
                  },
                  {
                    "value": "2",
                    "text": "Ich möchte mich am liebsten umbringen"
                  },
                  {
                    "value": "3",
                    "text": "Ich würde mich umbringen, wenn ich die Gelegenheit dazu hätte"
                  }
                ],
                "weinen": [
                  {
                    "value": "0",
                    "text": "Ich weine nicht öfter als früher"
                  },
                  {
                    "value": "1",
                    "text": "Ich weine jetzt mehr als früher"
                  },
                  {
                    "value": "2",
                    "text": "Ich weine beim geringsten Anlass"
                  },
                  {
                    "value": "3",
                    "text": "Ich möchte gern weinen, aber ich kann nicht"
                  }
                ],
                "unruhe": [
                  {
                    "value": "0",
                    "text": "Ich bin nicht unruhiger als sonst"
                  },
                  {
                    "value": "1",
                    "text": "Ich bin unruhiger als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich bin so unruhig, dass es mir schwerfällt, stillzusitzen"
                  },
                  {
                    "value": "3",
                    "text": "Ich bin so unruhig, dass ich mich ständig bewege oder etwas tun muss"
                  }
                ],
                "interessenverlust": [
                  {
                    "value": "0",
                    "text": "Ich habe das Interesse an anderen Menschen oder Tätigkeiten nicht verloren"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe weniger Interesse an anderen Menschen oder Dingen als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich habe Interesse an anderen Menschen oder Dingen grössten Teils verloren"
                  },
                  {
                    "value": "3",
                    "text": "Es fällt mir schwer, mich überhaupt für etwas zu interessieren"
                  }
                ],
                "entschluss": [
                  {
                    "value": "0",
                    "text": "Ich bin so entschlussfreudig wie immer"
                  },
                  {
                    "value": "1",
                    "text": "Es fällt mir schwerer als sonst, Entscheidungen zu treffen"
                  },
                  {
                    "value": "2",
                    "text": "Es fällt mir sehr viel schwerer als sonst, Entscheidungen zu treffen"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe Mühe, überhaupt Entscheidungen zu treffen"
                  }
                ],
                "wert": [
                  {
                    "value": "0",
                    "text": "Ich fühle mich nicht wertlos"
                  },
                  {
                    "value": "1",
                    "text": "Ich halte mich für weniger wertvoll und nützlich als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Verglichen mit anderen Menschen fühle ich mich viel weniger wert"
                  },
                  {
                    "value": "3",
                    "text": "Ich fühle mich völlig wertlos"
                  }
                ],
                "energieverlust": [
                  {
                    "value": "0",
                    "text": "Ich habe so viel Energie wie immer"
                  },
                  {
                    "value": "1",
                    "text": "Ich habe weniger Energie als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich habe so wenig Energie, dass ich kaum noch etwas schaffe"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe keine Energie, um überhaupt noch etwas schaffen"
                  }
                ],
                "schlaf": [
                  {
                    "value": "0",
                    "text": "Meine Schlafgewohnheiten haben sich nicht geändert"
                  },
                  {
                    "value": "1a",
                    "text": "Ich schlafe etwas mehr als sonst"
                  },
                  {
                    "value": "1b",
                    "text": "Ich schlafe etwas weniger als sonst"
                  },
                  {
                    "value": "2a",
                    "text": "Ich schlafe viel mehr als sonst"
                  },
                  {
                    "value": "2b",
                    "text": "Ich schlafe viel weniger als sonst"
                  },
                  {
                    "value": "3a",
                    "text": "Ich schlafe fast den ganzen Tag"
                  },
                  {
                    "value": "3b",
                    "text": "Ich wache 1 - 2 Stunden früher auf als gewöhnlich und kann nicht mehr einschlafen"
                  }
                ],
                "reizbarkeit": [
                  {
                    "value": "0",
                    "text": "Ich bin nicht reizbarer als sonst"
                  },
                  {
                    "value": "1",
                    "text": "Ich bin reizbarer als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Ich bin viel reizbarer als sonst"
                  },
                  {
                    "value": "3",
                    "text": "Ich fühle mich dauernd gereizt"
                  }
                ],
                "appetit": [
                  {
                    "value": "0",
                    "text": "Mein Appetit hat sich nicht verändert"
                  },
                  {
                    "value": "1a",
                    "text": "Mein Appetit ist etwas schlechter als sonst"
                  },
                  {
                    "value": "1b",
                    "text": "Mein Appetit ist etwas grösser als sonst"
                  },
                  {
                    "value": "2a",
                    "text": "Mein Appetit ist viel schlechter als sonst"
                  },
                  {
                    "value": "2b",
                    "text": "Mein Appetit ist viel grösser als sonst"
                  },
                  {
                    "value": "3a",
                    "text": "Ich habe überhaupt keinen Appetit"
                  },
                  {
                    "value": "3b",
                    "text": "Ich habe ständig Hunger"
                  }
                ],
                "konzentration": [
                  {
                    "value": "0",
                    "text": "Ich kann mich so gut konzentrieren wie immer"
                  },
                  {
                    "value": "1",
                    "text": "Ich kann mich nicht mehr so gut konzentrieren wie sonst"
                  },
                  {
                    "value": "2",
                    "text": "Es fällt mir schwer, mich längere Zeit auf irgend etwas zu konzentrieren"
                  },
                  {
                    "value": "3",
                    "text": "Ich kann mich überhaupt nicht mehr konzentrieren"
                  }
                ],
                "ermuedung": [
                  {
                    "value": "0",
                    "text": "Ich fühle mich nicht müder oder erschöpfter als sonst"
                  },
                  {
                    "value": "1",
                    "text": "Ich werde schneller müde oder erschöpft als sonst"
                  },
                  {
                    "value": "2",
                    "text": "Für viele Dinge, die ich üblicherweise tue, bin ich zu müde oder erschöpft"
                  },
                  {
                    "value": "3",
                    "text": "Ich bin so müde oder erschöpft, dass ich fast nichts mehr tun kann"
                  }
                ],
                "sexualität": [
                  {
                    "value": "0",
                    "text": "Mein Interesse an Sexualität hat sich in letzter Zeit nicht verändert"
                  },
                  {
                    "value": "1",
                    "text": "Ich interessiere mich weniger für Sexualität als früher"
                  },
                  {
                    "value": "2",
                    "text": "Ich interessiere mich jetzt viel weniger für Sexualität als früher"
                  },
                  {
                    "value": "3",
                    "text": "Ich habe das Interesse an Sexualität völlig verloren"
                  }
                ]
              }
            }
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.bdi_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="BDI-II" subtitle="Übersicht | Grafik" id="bdi_chart">
                    <optinmic-profile-chart 
                        :options="bdi_chart.options"
                        :scales="bdi_chart.scales" 
                        :ranges="bdi_chart.ranges"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>


            <optinomic-content-block :subtitle="sr_count_text" title="Datentabelle" id="id_data_table">
                <optinomic-data-table :rows="data_table.rows" :interpretations="data_table.interpretations" :sr="sr_data">
                </optinomic-data-table>
            </optinomic-content-block>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Beck Depressions-Inventar (BDI-II)"
                        header-right="Klinik Südhang" document-title="BDI" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// BSCL - Application
Vue.component('app-bscl', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": [],
            "data_table": {
                "rows": [{
                    "name": "Messzeitpunkt",
                    "variable": "mz_id",
                    "path": "calculation.scores_calculation.zusatzitem.mz_text"
                }, {
                    "name": "Datum",
                    "variable": "mz_datum",
                    "path": "calculation.scores_calculation.zusatzitem.mz_datum"
                }, {
                    "name": "Schlechter Appetit",
                    "variable": "zusatz_0",
                    "path": "calculation.scores_calculation.zusatzitem.items.0.result"
                }, {
                    "name": "Einschlafschwierigkeiten",
                    "variable": "zusatz_1",
                    "path": "calculation.scores_calculation.zusatzitem.items.1.result"
                }, {
                    "name": "Gedanken an Tod & Sterben",
                    "variable": "zusatz_2",
                    "path": "calculation.scores_calculation.zusatzitem.items.2.result"
                }, {
                    "name": "Schuldgefühle",
                    "variable": "zusatz_3",
                    "path": "calculation.scores_calculation.zusatzitem.items.3.result"
                }, {
                    "name": "Dropout | Code",
                    "variable": "dropout_code",
                    "path": "calculation.scores_calculation.zusatzitem.dropout_code"
                }, {
                    "name": "Dropout | Begründung",
                    "variable": "dropout_reason",
                    "path": "calculation.scores_calculation.zusatzitem.dropout_reason"
                }]
            }
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.bscl_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="BSCL" subtitle="Übersicht | Grafik" id="bscl_chart">
                    <optinmic-profile-chart 
                        :options="bscl_chart.options"
                        :scales="bscl_chart.scales" 
                        :ranges="bscl_chart.ranges"
                        :clinic_samples="included_bscl_cs"
                        :clinic_sample_dive="bscl_get_cs_dive(sr)"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <optinomic-content-block :subtitle="sr_count_text" title="Zusatzangaben" id="id_data_table">
                <optinomic-data-table :rows="data_table.rows" :sr="sr_data">
                </optinomic-data-table>
            </optinomic-content-block>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Brief Symptom Checklist (BSCL)"
                        header-right="Klinik Südhang" document-title="BSCL" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// ISK-K - Application
Vue.component('app-isk', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": []
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.iskk_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="ISK-K" subtitle="Übersicht | Grafik" id="bscl_chart">
                    <optinmic-profile-chart 
                        :options="isk_k_chart.options"
                        :scales="isk_k_chart.scales" 
                        :ranges="isk_k_chart.ranges"
                        :clinic_samples="included_isk_cs"
                        :clinic_sample_dive="iskk_get_cs_dive(sr)"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>


            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Inventar Sozialer Kompetenzen (ISK-K)"
                        header-right="Klinik Südhang" document-title="ISK-K" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// Optinomic | <pdf-auswertung-gesamt>
Vue.component('pdf-auswertung-gesamt', {
    props: {
        production: {
            type: Boolean,
            default: true
        }
    },
    data: () => ({
        "name": "Fallkonferenz",
        "title": "Fragebogenauswertung",
        "subtitle": "Eine Übersicht der wichtigsten Ergebnisse und Auswertungen.",
        "pdf_status": "Initialisiere",
        "pdf_create_count": 0,
        "pdf_building": false,
        "pdf_finished": false,
        "pdf_content": [],
        "pdf_apps": {
            "production": [{
                    "name": "actinfo_ein",
                    "title": "ActInfo",
                    "subtitle": "Information network on addiction care and therapy",
                    "identifier": "ch.suedhang.apps.actinfo_ein.production"
                },
                {
                    "name": "actinfo_aus",
                    "title": "ActInfo",
                    "subtitle": "Information network on addiction care and therapy",
                    "identifier": "ch.suedhang.apps.actinfo_aus.production"
                },
                {
                    "name": "tmt",
                    "title": "TMT",
                    "subtitle": "Trail Making Test",
                    "identifier": "ch.suedhang.apps.tmt.production"
                },
                {
                    "name": "bdi",
                    "title": "BDI-II",
                    "subtitle": "Beck Depressions-Inventar",
                    "identifier": "ch.suedhang.apps.bdi.production"
                },
                {
                    "name": "asrs",
                    "title": "",
                    "subtitle": "",
                    "identifier": "ch.suedhang.apps.asrs.production"
                },
                {
                    "name": "aase",
                    "title": "AASE-G",
                    "subtitle": "Alcohol Abstinence Self-Effcacy | Skala Versuchung",
                    "identifier": "ch.suedhang.apps.aase-g.production"
                },
                {
                    "name": "bscl",
                    "title": "BSCL",
                    "subtitle": "Brief Symptom Checklist",
                    "identifier": "ch.suedhang.apps.bscl_anq.production"
                },
                {
                    "name": "isk",
                    "title": "ISK-K",
                    "subtitle": "Inventar Sozialer Kompetenzen - Kurzform",
                    "identifier": "ch.suedhang.apps.isk.production"
                },
                {
                    "name": "whoqol",
                    "title": "WHOQOL-BREF",
                    "subtitle": "WHO Quality of Life - Kurzform",
                    "identifier": "ch.suedhang.apps.whoqol.production"
                },
                {
                    "name": "sci",
                    "title": "SCI",
                    "subtitle": "Stress-Coping-Inventar",
                    "identifier": "ch.suedhang.apps.sci.production"
                },
                {
                    "name": "rs13",
                    "title": "RS-13",
                    "subtitle": "Resilienzfragebogen",
                    "identifier": "ch.suedhang.apps.rs13.production"
                }
            ]
        }
    }),
    methods: {
        doPDF() {
            try {
                // --------------------------
                // Build PDF
                // --------------------------
                this.pdf_building = true;

                var pdf = [];
                var base = this.data_apps_array;

                console.warn('doPDF :: Building PDF', base);
                this.pdf_status = "Wird erstellt...";


                // ------------------------------------------
                // Globals
                // ------------------------------------------

                var app_title = function (data) {
                    var titel = [];
                    titel.push(makepdf._horizontalLine(100, "#E0E0E0"));
                    titel.push(makepdf._heading(data.params.title, data.params.subtitle, 'h1'));
                    titel.push(makepdf._text(data.module.short_description));

                    return makepdf._keepTogether(titel, data.params.name + '_titel');
                }.bind(this);


                // ------------------------------------------
                // Titelseite
                // ------------------------------------------

                var titelseite = function () {
                    var block = [];

                    block.push(makepdf._suedhang_logo_anschrift());
                    block.push(makepdf._title(this.title, this.subtitle));
                    block.push({
                        "text": "Wir berichten über den Aufenthalt von " + this.patient_data.extras.anrede + " vom " + this.stay_from_to + ".",
                        "style": "p"
                    });
                    block.push(makepdf._spacer(96));
                    block.push(makepdf._horizontalLine(62, "#F5F5F5"));
                    block.push(makepdf._stamp(this.patient_data.extras.full_name, 18));
                    block.push(makepdf._horizontalLine(62, "#F5F5F5"));

                    var title_block = {
                        "id": "document_title",
                        "alignment": "left",
                        "margin": [0, 18, 0, 0],
                        "columns": [{}, {
                            "width": "480",
                            "stack": block
                        }]
                    };

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return title_block;
                }.bind(this);


                // ------------------------------------------
                // actInfo
                // ------------------------------------------
                var actinfo = function () {
                    var pdf = [];
                    const current_app_name = 'actinfo';
                    try {
                        var data_ein = this.getAppBaseData('actinfo_ein');
                        data_ein.module = this.get_current_patient_module('actinfo_ein');
                        var data_aus = this.getAppBaseData('actinfo_aus');

                        var block = [];

                        // Titel
                        block.push(app_title(data_ein));

                        // Content from Plugin
                        block.push(this.actinfo_pdf_content(data_ein, data_aus));


                        this.pdf_create_count = this.pdf_create_count + 1;
                        return block;

                    } catch (e) {
                        pdf.push(makepdf._keepTogether(makepdf._indication('!', 'Error'), current_app_name + '_error'));
                    };

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return pdf;
                }.bind(this);


                // ------------------------------------------
                // tmt
                // ------------------------------------------
                var tmt = function () {
                    const current_app_name = 'tmt';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.tmt_pdf_content(data));


                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // bdi
                // ------------------------------------------
                var bdi = function () {
                    const current_app_name = 'bdi';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.bdi_pdf_content(data));


                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // aase
                // ------------------------------------------
                var aase = function () {
                    const current_app_name = 'aase';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.aase_pdf_content(data));

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // bscl
                // ------------------------------------------
                var bscl = function () {
                    const current_app_name = 'bscl';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.bscl_pdf_content(data));

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // whoqol
                // ------------------------------------------
                var whoqol = function () {
                    const current_app_name = 'whoqol';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.whoqol_pdf_content(data));

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // isk
                // ------------------------------------------
                var isk = function () {
                    const current_app_name = 'isk';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.iskk_pdf_content(data));


                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // sci
                // ------------------------------------------
                var sci = function () {
                    const current_app_name = 'sci';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);
                    // console.error(current_app_name, data);

                    var block = [];

                    // Titel
                    block.push(app_title(data));

                    // Content from Plugin
                    block.push(this.sci_pdf_content(data));

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return block;
                }.bind(this);


                // ------------------------------------------
                // rs13
                // ------------------------------------------
                var rs13 = function () {
                    const current_app_name = 'rs13';
                    var data = this.getAppBaseData(current_app_name);
                    data.module = this.get_current_patient_module(current_app_name);

                    // Build PDF
                    var pdf = [];
                    pdf.push(app_title(data));

                    // Content from Plugin
                    pdf.push(this.rs13_pdf_content(data));

                    this.pdf_create_count = this.pdf_create_count + 1;
                    return pdf;
                }.bind(this);


                // ------------------------------------------
                // PDF /  Pages & Order
                // ------------------------------------------
                pdf.push(titelseite());
                pdf.push(actinfo());
                pdf.push(makepdf._pageBreak());
                pdf.push(bdi());
                pdf.push(tmt());
                pdf.push(aase());
                pdf.push(bscl());
                pdf.push(whoqol());
                pdf.push(isk());
                pdf.push(sci());
                pdf.push(rs13());



                // Job Done
                this.pdf_status = "Erstellt!";
                this.pdf_content = pdf;
                this.pdf_finished = true;

            } catch (err) {
                this.pdf_status = "Fehler beim Erstellen.";
                console.error('doPDF', err);
            }
        },
        getAppBaseData(app_name) {
            try {
                var return_obj = null;
                this.data_apps_array.forEach(function (app) {
                    if (app.name === app_name) {
                        return_obj = this.get_app_data(app.identifier);
                    };
                }.bind(this));
                return return_obj;
            } catch (err) {
                console.error('getAppBaseData', err);
                return null;
            }
        },
        get_current_patient_module(name) {
            try {
                if (this.production) {

                    var return_obj = null;
                    this.pdf_apps.production.forEach(function (app) {
                        if (app.name === name) {
                            this.patient_modules.forEach(function (mod) {
                                if (mod.identifier === app.identifier) {
                                    return_obj = Object.assign({}, mod.module);
                                };
                            }.bind(this));
                        };
                    }.bind(this));
                    return return_obj;
                };
            } catch (err) {
                console.error('get_current_patient_module', err);
                return null;
            }
        }
    },
    computed: {
        data_apps_array() {
            try {
                if (this.production) {
                    return this.pdf_apps.production.slice();
                } else {
                    return [];
                };
            } catch (e) {
                console.error('data_apps_array', e);
                return null;
            };
        },
        readyforPDF() {
            try {
                var ret_val = true;

                this.data_apps_array.forEach(function (app) {
                    var data = this.get_app_data(app.identifier);

                    if (data !== undefined) {
                        if (data.loaded !== true) {
                            ret_val = false;
                        };
                    } else {
                        ret_val = false;
                    };
                }.bind(this));

                if (this.stay_current_data.found === false) {
                    ret_val = false;
                };
                return ret_val;
            } catch (e) {
                console.error('readyforPDF', e);
                return false;
            };
        },
        stay_current_data() {
            // return data
            try {
                return this.$store.state.stays.current.data;
            } catch (e) {
                return null;
            };
        },
        stay_from_to() {
            // return data
            try {
                return this.stay_current_data.extras.from_to;
            } catch (e) {
                return "";
            };
        }
    },
    watch: {
        readyforPDF: function (ready) {
            if (ready) {
                this.doPDF();
            };
        },
    },
    created() {
        // Load Data
        try {
            if (this.production) {

                this.pdf_status = "Daten werden geladen...";

                this.pdf_apps.production.forEach(function (app, appID) {
                    this.$store.dispatch('getSurveyResponses', app);
                }.bind(this));
            };
        } catch (err) {
            console.error('created', err);
        }
    },
    template: `
    <div>
        <div v-if="!pdf_finished" class="pt-2">

            <div v-if="pdf_building" class="d-flex flex-row justify-space-between align-center mr-4">
                <div class="mb-3 mr-2">
                    <v-icon color="#8b0042">mdi-file-pdf</v-icon>
                </div>
                <p class="mr-auto mt-2" v-text="pdf_status"></p>

                <div v-for="index in this.pdf_create_count" :key="index" style="margin-top:-12px;">
                    <v-badge class="ml-4" color="green" dot> </v-badge>
                </div>
                <div v-for="index in data_apps_array.length - this.pdf_create_count" :key="index" style="margin-top:-12px;">
                    <v-badge class="ml-4" color="blue" dot> </v-badge>
                </div>
            </div>
            <div v-else class="d-flex flex-row justify-space-between align-center mr-4">
                <div class="mb-3 mr-2">
                    <v-icon color="#8b0042">mdi-file-pdf</v-icon>
                </div>
                <p class="mr-auto mt-2" v-text="pdf_status"></p>

                <div v-for="app in data_apps_array" style="margin-top:-12px;">
                    <v-badge class="ml-4" v-if="(app.init === true) && (app.loaded !== true)  && (app.pdf_created !== true)" color="grey"
                        dot> </v-badge>
                    <v-badge class="ml-4" v-if="(app.init === true) && (app.loaded === true)  && (app.pdf_created !== true)" color="blue"
                        dot></v-badge>
                </div>
            </div>

        </div>
        <div v-else>
            <optinomic-pdfmake :header-left="patient_data.extras.secure" :footer-left="title" header-right="Klinik Südhang"
                :document-title="title" :content="pdf_content" hide-logo></optinomic-pdfmake>
        </div>
    </div>
    `
});

// whoqol - Application
Vue.component('app-whoqol', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": []
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.whoqol_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" title="WHOQOL-BREF" subtitle="Übersicht | Grafik" id="whoqol_chart">
                    <optinmic-profile-chart 
                        :options="whoqol_chart.options"
                        :scales="whoqol_chart.scales" 
                        :ranges="whoqol_chart.ranges"
                        :clinic_samples="included_whoqol_cs"
                        :clinic_sample_dive="whoqol_get_cs_dive(sr)"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="WHOQOL-BREF"
                        header-right="Klinik Südhang" document-title="WHOQOL-BREF" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// SCI - Application
Vue.component('app-sci', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": []
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.sci_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        },
        sr_sci() {
            var ret_obj = null;
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    ret_obj = this.sci_get_population(this.sr);    
                };
            } catch (e) {
                console.error('sr_sci', e);
            };
            return ret_obj;
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr_sci" title="Stressereignisse und Symptome" subtitle="Stress Coping Inventar (SCI)" id="sci_chart_stress">
                    <p class="text-center body-2"><span style="color:#8b0042" v-text="sr_sci.population"></span><span class="ml-2">(Stanine)</span></p>
                    
                    <optinmic-profile-chart 
                        :options="sci_chart_stress.options"
                        :scales="sci_chart_stress.scales" 
                        :ranges="sci_chart_stress.ranges"
                        :scores="sr_sci">
                    </optinmic-profile-chart>
                </optinomic-content-block>
                <optinomic-content-block v-else title="Stressereignisse und Symptome" subtitle="Stress Coping Inventar (SCI)" id="sci_chart_stress">
                    <v-skeleton-loader
                        class="mx-auto"
                        type="article"
                    ></v-skeleton-loader>
                </optinomic-content-block>

                <optinomic-content-block v-if="sr_sci" title="Copingstrategien" subtitle="Stress Coping Inventar (SCI)" id="sci_chart_hilfreich">
                    <p>Diese helfen die möglichen körperlichen und psychischen Stressreaktionen zu vermeiden oder zu reduzieren.</p>
                    <p class="mt-6 text-center body-2"><span style="color:#8b0042" v-text="sr_sci.population"></span><span class="ml-2">(Stanine)</span></p>
                    
                    <optinmic-profile-chart 
                        :options="sci_chart_hilfreich.options"
                        :scales="sci_chart_hilfreich.scales" 
                        :ranges="sci_chart_hilfreich.ranges"
                        :scores="sr_sci">
                    </optinmic-profile-chart>
                </optinomic-content-block>
                <optinomic-content-block v-else title="Copingstrategien" subtitle="Stress Coping Inventar (SCI)" id="sci_chart_stress">
                    <v-skeleton-loader
                        class="mx-auto"
                        type="article"
                    ></v-skeleton-loader>
                </optinomic-content-block>
            </div>


            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Stress Coping Inventar (SCI)"
                        header-right="Klinik Südhang" document-title="SCI" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// RS13-Application
Vue.component('app-rs13', {
    props: {
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {},
    data: function () {
        return {
            "pdf_content": [],
            "data_table": {
                "rows": [{
                        "name": "Messzeitpunkt",
                        "variable": "rs13_messzeitpunkt",
                        "path": "response.rs13_messzeitpunkt",
                        "interpretation": "mz"
                    },
                    {
                        "name": "Erfassungsdatum",
                        "variable": "rs13_date",
                        "path": "response.rs13_date",
                        "interpretation": "date"
                    },
                    {
                        "name": "Wenn ich Pläne habe, verfolge ich sie auch.",
                        "variable": "rs13_01",
                        "path": "response.rs13_01"
                    },
                    {
                        "name": "Normalerweise schaffe ich alles irgendwie.",
                        "variable": "rs13_02",
                        "path": "response.rs13_02"
                    },
                    {
                        "name": "Ich lasse mich nicht so schnell aus der Bahn werfen.",
                        "variable": "rs13_03",
                        "path": "response.rs13_03"
                    },
                    {
                        "name": "Ich mag mich.",
                        "variable": "rs13_04",
                        "path": "response.rs13_04"
                    },
                    {
                        "name": "Ich kann mehrere Dinge gleichzeitig bewältigen.",
                        "variable": "rs13_05",
                        "path": "response.rs13_05"
                    },
                    {
                        "name": "Ich bin entschlossen.",
                        "variable": "rs13_06",
                        "path": "response.rs13_06"
                    },
                    {
                        "name": "Ich nehme die Dinge wie sie kommen.",
                        "variable": "rs13_07",
                        "path": "response.rs13_07"
                    },
                    {
                        "name": "Ich behalte an vielen Dingen Interesse.",
                        "variable": "rs13_08",
                        "path": "response.rs13_08"
                    },
                    {
                        "name": "Normalerweise kann ich eine Situation aus mehreren Perspektiven betrachten.",
                        "variable": "rs13_09",
                        "path": "response.rs13_09"
                    },
                    {
                        "name": "Ich kann mich auch überwinden, Dinge zu tun, die ich eigentlich nicht machen will.",
                        "variable": "rs13_10",
                        "path": "response.rs13_10"
                    },
                    {
                        "name": "Wenn ich in einer schwierigen Situation bin, finde ich gewöhnlich einen Weg heraus.",
                        "variable": "rs13_11",
                        "path": "response.rs13_11"
                    },
                    {
                        "name": "In mir steckt genügend Energie, um alles zu machen, was ich machen muss.",
                        "variable": "rs13_12",
                        "path": "response.rs13_12"
                    },
                    {
                        "name": "Ich kann es akzeptieren, wenn mich nicht alle Leute mögen.",
                        "variable": "rs13_13",
                        "path": "response.rs13_13"
                    },
                    {
                        "name": "Resilienz Summenscore",
                        "variable": "rs13_score",
                        "path": "calculation.resilienz_score.rs13_score"
                    }
                ],
                "interpretations": {
                    "mz": [{
                            "value": 1,
                            "text": "Eintritt"
                        },
                        {
                            "value": 2,
                            "text": "Austritt"
                        },
                        {
                            "value": 3,
                            "text": "Anderer Messzeitpunkt"
                        }
                    ]
                }
            }
        }
    },
    methods: {},
    computed: {
        patient_secure() {
            try {
                return this.$store.state.patient.data.extras.secure;
            } catch (e) {
                return "";
            };
        },
        sr_count_text() {
            try {
                var ret_text = "";
                if (this.sr_data.length === 0) {
                    ret_text = "Keine Erfassung";
                };
                if (this.sr_data.length === 1) {
                    ret_text = "Eine Erfassung";
                };
                if (this.sr_data.length > 1) {
                    ret_text = "Erfassungen (" + this.sr_data.length + ")";
                };
                return ret_text;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            try {
                if ((this.sr_data.length) && (this.current_module)) {
                    // Build PDF
                    var pdf = [];
                    pdf.push(this.pdf_app_info(this.current_module, true));
                    pdf.push(this.rs13_pdf_content(this.sr));
                    this.pdf_content = pdf;
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    template: `
        <div>

            <div v-if="!missings">
                <optinomic-content-block v-if="sr" :title="base_config.app_short_description" subtitle="Übersicht | Grafik" id="rs13_chart">
                    <optinmic-profile-chart 
                        :options="rs13_chart.options"
                        :scales="rs13_chart.scales" 
                        :ranges="rs13_chart.ranges"
                        :scores="sr">
                    </optinmic-profile-chart>
                </optinomic-content-block>
            </div>

            <div v-for="sr in sr_data" :key="sr.event_id">

                <div v-if="sr.calculation_found">
                    <optinomic-content-block :title="rs13_getTitle(sr)" :subtitle="rs13_getSubtitle(sr)"
                        :id="'id_erfassung_' + sr.event_id">
                        <p class="overline">Auswertung / Interpretation</p>
                        <optinomic-clipboard-text :text="sr.calculation.resilienz_score.interpretation">
                        </optinomic-clipboard-text>
                    </optinomic-content-block>
                </div>

            </div>

            <optinomic-content-block :subtitle="sr_count_text" title="Datentabelle" id="id_data_table">
                <optinomic-data-table :rows="data_table.rows" :interpretations="data_table.interpretations" :sr="sr_data">
                </optinomic-data-table>
            </optinomic-content-block>

            <div v-if="!missings">
                <optinomic-content-block title="Druckvorlage" subtitle="PDF" id="id_pdf" v-if="pdf_ready">
                    <optinomic-pdfmake :header-left="patient_secure" footer-left="Resilienzfragebogen (RS-13)"
                        header-right="Klinik Südhang" document-title="Resilienz" :content="pdf_content" hide-logo>
                    </optinomic-pdfmake>
                </optinomic-content-block>
            </div>

        </div>
    `
});

// Plugin: plugin_actinfo
const plugin_actinfo = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "actinfo_audit_chart": {
                        "options": {
                            "min": -1,
                            "max": 41,
                            "item_height": 50,
                            "item_text_left": 130,
                            "item_text_right": 130,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": true,
                            "show_score_profile_line": false,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": false,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 5,
                            "response_title_path": "calculation.actinfo_ein.messzeitpunkt.mz_text",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "",
                            "left_text": "Risikoarmer Alkoholkonsum",
                            "right_title": "",
                            "right_text": "Verdacht auf Alkoholabhängigkeit",
                            "score_path": "calculation.actinfo_ein.AUDIT.AUDIT_Score",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                            "range_start": 0,
                            "range_stop": 7.5,
                            "text": "Risikoarmer Alkoholkonsum",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 7.5,
                            "range_stop": 15.5,
                            "text": "Verdacht auf eine alkoholbezogene Störung",
                            "color": "#FBB100"
                        }, {
                            "range_start": 15.5,
                            "range_stop": 40,
                            "text": "Hohe Wahrscheinlichkeit einer Alkoholabhängigkeit",
                            "color": "#C62828"
                        }]
                    },
                    "actinfo_fagerstroem_chart": {
                        "options": {
                            "min": -1,
                            "max": 11,
                            "item_height": 50,
                            "item_text_left": 130,
                            "item_text_right": 130,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": true,
                            "show_score_profile_line": false,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": false,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "response_title_path": "app_name",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "",
                            "left_text": "Geringe Abhängigkeit",
                            "right_title": "",
                            "right_text": "Starke Abhängigkeit",
                            "score_path": "FAGERSTROEM.FAGERSTROEM_Score",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                            "range_start": 0,
                            "range_stop": 2.5,
                            "text": "Gering",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 2.5,
                            "range_stop": 4.5,
                            "text": "Mittelstark",
                            "color": "#FFA000"
                        }, {
                            "range_start": 4.5,
                            "range_stop": 6.5,
                            "text": "Stark",
                            "color": "#FB7200"
                        }, {
                            "range_start": 6.5,
                            "range_stop": 10,
                            "text": "Sehr stark",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                merge_data_ein_aus: function (_sr_actinfo_ein, _sr_actinfo_aus) {
                    var _sr_actinfo = [];
                    var show_audit = false;
                    var show_fagerstoem = false;

                    if (_sr_actinfo_ein.have_data === true) {
                        _sr_actinfo_ein.data.forEach(function (current) {
                            if (current.all_found === true) {
                                current.app_name = 'Eintritt';
                                current.actinfo_ein_data = true;
                                current.actinfo_aus_data = false;
                                current.FAGERSTROEM = current.calculation.actinfo_ein.FAGERSTROEM;
                                if ("smoker" in current.FAGERSTROEM) {
                                    if (current.FAGERSTROEM.smoker.smoker === true) {
                                        show_fagerstoem = true;
                                    };
                                };
                                if ((current.calculation.actinfo_ein.AUDIT.AUDIT_Score !== 0) && (current.calculation.actinfo_ein.AUDIT.AUDIT_Score !== null) && (current.calculation.actinfo_ein.AUDIT.AUDIT_Score !== undefined)) {
                                    show_audit = true;
                                };
                                current.info = current.app_name + ': ' + current.FAGERSTROEM.interpretation.result;
                                _sr_actinfo.push(current);
                            };
                        }.bind(this));
                    };

                    if (_sr_actinfo_aus.have_data === true) {
                        _sr_actinfo_aus.data.forEach(function (current) {
                            if (current.all_found === true) {
                                current.app_name = 'Austritt';
                                current.actinfo_ein_data = false;
                                current.actinfo_aus_data = true;
                                current.FAGERSTROEM = current.calculation.another_calculation.FAGERSTROEM;
                                if ("smoker" in current.FAGERSTROEM) {
                                    if (current.FAGERSTROEM.smoker.smoker === true) {
                                        show_fagerstoem = true;
                                    };
                                };
                                current.info = current.app_name + ': ' + current.FAGERSTROEM.interpretation.result;
                                _sr_actinfo.push(current);
                            };

                        }.bind(this));
                    };

                    // Build some Texts
                    var audit_text = "";
                    var fagerstroem_text = "";
                    var motivation_text = "";
                    _sr_actinfo.forEach(function (item, itemID) {
                        if (item.actinfo_ein_data) {

                            audit_text = "Bei Eintritt bestand «" + item.calculation.actinfo_ein.AUDIT.interpretation.result + "» (∑=" + item.calculation.actinfo_ein.AUDIT.AUDIT_Score + ")."


                            if ("smoker" in item.FAGERSTROEM) {
                                if ("summyary" in item.FAGERSTROEM.smoker) {
                                    if (fagerstroem_text !== "") {
                                        fagerstroem_text = fagerstroem_text + " "
                                    };
                                    fagerstroem_text = fagerstroem_text + item.FAGERSTROEM.smoker.summyary;
                                };
                            };
                        };
                        if (item.actinfo_aus_data) {
                            if ("smoker" in item.FAGERSTROEM) {
                                if ("summyary" in item.FAGERSTROEM.smoker) {
                                    if (fagerstroem_text !== "") {
                                        fagerstroem_text = fagerstroem_text + " "
                                    };
                                    fagerstroem_text = fagerstroem_text + item.FAGERSTROEM.smoker.summyary;
                                };
                                if (item.FAGERSTROEM.smoker.motivation_data) {
                                    if (fagerstroem_text !== "") {
                                        fagerstroem_text = fagerstroem_text + " "
                                    };
                                    fagerstroem_text = fagerstroem_text + item.FAGERSTROEM.smoker.motivation_full_text;
                                    motivation_text = motivation_text + item.FAGERSTROEM.smoker.motivation_full_text;
                                };
                            };
                        };
                    }.bind(this));

                    
                    var actinfo_obj = {
                        "merged": true,
                        "actinfo_ein_data": _sr_actinfo_ein.have_data,
                        "actinfo_aus_data": _sr_actinfo_aus.have_data,
                        "actinfo_ein_aus_data": _sr_actinfo_ein.have_data && _sr_actinfo_aus.have_data,
                        "show_audit": show_audit,
                        "audit_text": audit_text,
                        "show_fagerstoem": show_fagerstoem,
                        "fagerstroem_text": fagerstroem_text,
                        "motivation_text": motivation_text,
                        "data": _sr_actinfo,
                        "app_id": "actinfo - Ein & Austritt"
                    };

                    if ((_sr_actinfo_ein.have_data === true) && (_sr_actinfo_aus.have_data === true)) {
                        actinfo_obj.actinfo_ein_aus_data = true;
                    };

                    return actinfo_obj;

                },
                actinfo_pdf_content: function (_sr_actinfo_ein, _sr_actinfo_aus) {
                    var _pdf_content = [];
                    var _data_ein_last = _sr_actinfo_ein.data[_sr_actinfo_ein.data.length-1];
                    var _sr_actinfo_merged = this.merge_data_ein_aus(_sr_actinfo_ein, _sr_actinfo_aus);
                    // console.error('pdf_build_actinfo :: ', _sr_actinfo_merged);

                    var ps_ol = {
                        "ol": []
                    };
                    _data_ein_last.calculation.actinfo_ein.problemsubstanzen.substanzen.forEach(function (s, ID) {
                        var txt = {
                            "text": [
                              {
                                "text": s.substanz,
                                "style": "p",
                                "bold": true
                              }
                            ]
                        };
                          
                        if ("label" in s) {
                          txt.text.push({
                              "text": ": ",
                              "style": "p",
                              "bold": true
                          });
                          txt.text.push({
                              "text": s.label,
                              "style": "p"
                          });
                        };

                        ps_ol.ol.push(txt);
                    }.bind(this));
                    var zusatzangaben = _data_ein_last.calculation.actinfo_ein.zusatzangaben.kunsumalter_text + " " + _data_ein_last.calculation.actinfo_ein.zusatzangaben.entzuege_text;

                    var ps = [];
                    ps.push(makepdf._heading("Problemsubstanzen", null, 'h3'));
                    ps.push(makepdf._text(_data_ein_last.calculation.actinfo_ein.problemsubstanzen.description));
                    ps.push(makepdf._spacer(3));
                    ps.push(ps_ol);
                    ps.push(makepdf._spacer(6));
                    ps.push(makepdf._text("Zusatzangaben: " + zusatzangaben));
                    _pdf_content.push(makepdf._keepTogether(ps, "problemsubstanzen"));

                    if (_sr_actinfo_merged.show_audit) {
                        var audit = [];
                        audit.push(makepdf._heading("AUDIT (Alcohol Use Disorders Identification)", null, 'h3'));
                        audit.push(makepdf._text(_sr_actinfo_merged.audit_text));
                        _pdf_content.push(makepdf._keepTogether(audit, "audit_text"));

                        var pdf_chart = [];
                        pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                        pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.actinfo_audit_chart.options), {}, {}, [], this.actinfo_audit_chart.scales, _sr_actinfo_ein, this.actinfo_audit_chart.ranges));
                        pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                        _pdf_content.push(makepdf._keepTogether(pdf_chart, "audit_chart"));
                    };

                    if (_sr_actinfo_merged.show_fagerstoem) {
                        var fagerstroem = [];
                        fagerstroem.push(makepdf._heading("Nikotinabhängigkeit (Fagerström)", null, 'h3'));
                        fagerstroem.push(makepdf._text(_sr_actinfo_merged.fagerstroem_text));
                        _pdf_content.push(makepdf._keepTogether(fagerstroem, "fagerstroem_text"));

                        var pdf_chart = [];
                        pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                        pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.actinfo_fagerstroem_chart.options), {}, {}, [], this.actinfo_fagerstroem_chart.scales, _sr_actinfo_merged, this.actinfo_fagerstroem_chart.ranges));
                        pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                        _pdf_content.push(makepdf._keepTogether(pdf_chart, "fagerstroem_chart"));
                    };

                    return _pdf_content;
                }
            }
        });
    }
};
Vue.use(plugin_actinfo);

// Plugin: plugin_aase
const plugin_aase = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "AASE_G",
                    "aase_chart": {
                        "options": {
                            "min": -1,
                            "max": 5,
                            "item_height": 50,
                            "item_text_left": 135,
                            "item_text_right": 135,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "response_title_path": "calculation.another_calculation.messzeitpunkt.mz_text_substanz",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Negativer Affekt",
                            "left_text": "Keine Versuchung",
                            "right_title": "Negativer Affekt",
                            "right_text": "Starke Versuchung",
                            "score_path": "calculation.another_calculation.mean_negativer_affekt",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Soziale Situationen",
                            "left_text": "Keine Versuchung",
                            "right_title": "Soziale Situationen",
                            "right_text": "Starke Versuchung",
                            "score_path": "calculation.another_calculation.mean_soziale_situationen",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Somatisches Unwohlsein",
                            "left_text": "Keine Versuchung",
                            "right_title": "Somatisches Unwohlsein",
                            "right_text": "Starke Versuchung",
                            "score_path": "calculation.another_calculation.mean_somatisches_unwohlsein",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Entzugserscheinungen",
                            "left_text": "Keine Versuchung",
                            "right_title": "Entzugserscheinungen",
                            "right_text": "Starke Versuchung",
                            "score_path": "calculation.another_calculation.mean_entzugserscheinungen",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Gesamtscore",
                            "left_text": "Keine Versuchung",
                            "right_title": "Gesamtscore",
                            "right_text": "Starke Versuchung",
                            "score_path": "calculation.another_calculation.score_mean",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                            "range_start": 0,
                            "range_stop": 0.999,
                            "text": "sehr geringe Versuchung",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 1,
                            "range_stop": 1.999,
                            "text": "geringe Versuchung",
                            "color": "#FFA000"
                        }, {
                            "range_start": 2,
                            "range_stop": 2.999,
                            "text": "hohe Versuchung",
                            "color": "#FB7200"
                        }, {
                            "range_start": 3,
                            "range_stop": 4,
                            "text": "sehr hohe Versuchung",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                aase_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.aase_chart.options), {}, {}, [], this.aase_chart.scales, sr, this.aase_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "aase_chart"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('aase_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_aase);

// Plugin: plugin_asrs
const plugin_asrs = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "ASRS",
                    "asrs_chart": {
                        "options": {
                            "min": -1,
                            "max": 7,
                            "item_height": 50,
                            "item_text_left": 135,
                            "item_text_right": 135,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": true,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "response_title_path": "calculation.asrs_score.score.current_range.interpretation",
                            "response_date_path": "calculation.asrs_score.messzeitpunkt.mz_date"
                        },
                        "scales": [{
                            "left_title": "ADHS",
                            "left_text": "Keine Hinweise",
                            "right_title": "ADHS",
                            "right_text": "Hinweise vorhanden",
                            "score_path": "calculation.asrs_score.score.score",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                                "range_start": 0,
                                "range_stop": 4,
                                "text": "Keine Hinweise auf ADHS vorhanden",
                                "color": "#4CAF50"
                            },
                            {
                                "range_start": 4,
                                "range_stop": 6,
                                "text": "Hinweise auf ADHS vorhanden",
                                "color": "#F44336"
                            }
                        ]
                    }
                }
            },
            methods: {
                asrs_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.asrs_chart.options), {}, {}, [], this.asrs_chart.scales, sr, this.asrs_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "asrs_chart"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('aase_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_asrs);

// Plugin: plugin_bdi
const plugin_bdi = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "BDI-II",
                    "bdi_chart": {
                        "options": {
                            "min": -1.5,
                            "max": 64.5,
                            "item_height": 50,
                            "item_text_left": 130,
                            "item_text_right": 130,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": false,
                            "show_score_vertical_line": true,
                            "show_score_profile_line": false,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": false,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.2,
                            "vertical_grid_every_x": 3,
                            "response_title_path": "calculation.bdi_score.score.current_range.interpretation_de",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Keine Depression",
                            "left_text": "",
                            "right_title": "Verdacht auf eine schwere Depression",
                            "right_text": "",
                            "score_path": "calculation.bdi_score.score.score",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                            "range_start": 0,
                            "range_stop": 8.5,
                            "text": "Keine Depression",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 8.5,
                            "range_stop": 13.5,
                            "text": "V.a. eine minimale Depression",
                            "color": "#FBB100"
                        }, {
                            "range_start": 13.5,
                            "range_stop": 19.5,
                            "text": "V.a. eine leichte Depression",
                            "color": "#FFA000"
                        }, {
                            "range_start": 19.5,
                            "range_stop": 28.5,
                            "text": "V.a. eine mittelschwere Depression",
                            "color": "#FB7200"
                        }, {
                            "range_start": 28.5,
                            "range_stop": 63,
                            "text": "V.a. eine schwere Depression",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                bdi_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.bdi_chart.options), {}, {}, [], this.bdi_chart.scales, sr, this.bdi_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "bdi_chart"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('bdi_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_bdi);

// Plugin: plugin_bscl_anq
const plugin_bscl_anq = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "BSCL",
                    "bscl_chart": {
                        "options": {
                            "min": -2,
                            "max": 14,
                            "item_height": 58,
                            "item_text_left": 100,
                            "item_text_right": 370,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "show_range_text": true,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": false,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 2,
                            "response_title_path": "calculation.scores_calculation.info.mz.mz_typ",
                            "response_date_path": "calculation.scores_calculation.info.mz.mz_date",
                            "norm_sample": "Gesunde Normstichprobe (N=300)",
                            "dropout": "calculation.scores_calculation.info.mz.dropout",
                            "dropout_reason": "calculation.scores_calculation.info.mz.dropout_reason"
                        },
                        "scales": [{
                            "left_title": "Somatisierung",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Kopfschmerzen, Herzbeschwerden, Atemprobleme, Magenbeschwerden, Muskelschmerzen, Schwächegefühl, Schweregefühl, Unwohlsein usw.",
                            "m_norm": [0.23, 0.32],
                            "sd_norm": [0.31, 0.33],
                            "score_path": "calculation.scores_calculation.all_results.somatisierung_z_score",
                            "clinic_sample_var": "somatisierung_z_score",
                            "items": 7
                        }, {
                            "left_title": "Zwanghaftigkeit",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Gedanken, Impulse und Handlungen, die konstant vorhanden und nicht änderbar und ich-fremd oder ungewollt erlebt werden, Kognitive Leistungsstörungen.",
                            "m_norm": [0.50, 0.54],
                            "sd_norm": [0.46, 0.43],
                            "score_path": "calculation.scores_calculation.all_results.zwanghaftigkeit_z_score",
                            "clinic_sample_var": "zwanghaftigkeit_z_score",
                            "items": 6
                        }, {
                            "left_title": "Unsicherheit im Sozialkontakt",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Minderwertigkeitsgefühle, Selbstabwertungen, Selbstzweifel, Selbstunsicherheit und negative Erwartungen bzgl. dem eigenen zwischenmenschlichen Verhalten.",
                            "m_norm": [0.35, 0.49],
                            "sd_norm": [0.40, 0.45],
                            "score_path": "calculation.scores_calculation.all_results.unsicherheit_im_sozialkontakt_z_score",
                            "clinic_sample_var": "unsicherheit_im_sozialkontakt_z_score",
                            "items": 4
                        }, {
                            "left_title": "Depressivität",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Gedrückte Stimmung, Gesunkenes Interesse am Leben, Verringerte Motivation und Energie, Hoffnungslosigkeit, bis hin zu Suizidgedanken.",
                            "m_norm": [0.24, 0.33],
                            "sd_norm": [0.32, 0.40],
                            "score_path": "calculation.scores_calculation.all_results.depressivit__t_z_score",
                            "clinic_sample_var": "depressivit__t_z_score",
                            "items": 6
                        }, {
                            "left_title": "Ängstlichkeit",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Angst mit Nervosität, Spannungen und Zittern, Panikattacken und Schreckgefühlen, Gefühle von Besorgnis und Furcht.",
                            "m_norm": [0.29, 0.39],
                            "sd_norm": [0.31, 0.36],
                            "score_path": "calculation.scores_calculation.all_results.__ngstlichkeit_z_score",
                            "clinic_sample_var": "__ngstlichkeit_z_score",
                            "items": 6
                        }, {
                            "left_title": "Aggressivität / Feindseligkeit",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Reizbarkeit und Unausgeglichenheit bis hin zu starker Aggressivität. Ärger, Aggression, Irritierbarkeit, Zorn und Verstimmung.",
                            "m_norm": [0.29, 0.37],
                            "sd_norm": [0.35, 0.33],
                            "score_path": "calculation.scores_calculation.all_results.aggressivit__t___feindseligkeit_z_score",
                            "clinic_sample_var": "aggressivit__t___feindseligkeit_z_score",
                            "items": 5
                        }, {
                            "left_title": "Phobische Angst",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Andauernde und unangemessene Furcht als Reaktion auf eine bestimmte Person, einen Platz, ein Objekt oder eine charakteristische Situation, die zu Vermeidungs- oder Fluchtverhalten führt.",
                            "m_norm": [0.14, 0.16],
                            "sd_norm": [0.23, 0.25],
                            "score_path": "calculation.scores_calculation.all_results.phobische_angst_z_score",
                            "clinic_sample_var": "phobische_angst_z_score",
                            "items": 5
                        }, {
                            "left_title": "Paranoides Denken",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Misstrauen, Minderwertigkeitsgefühle, paranoides Denken: Gedankenprojektion, Feindseligkeit, Argwohn, Grandiosität, Einengung, Angst vor Autonomieverlust und wahnhafte Täuschung.",
                            "m_norm": [0.33, 0.34],
                            "sd_norm": [0.40, 0.38],
                            "score_path": "calculation.scores_calculation.all_results.paranoides_denken_z_score",
                            "clinic_sample_var": "paranoides_denken_z_score",
                            "items": 5
                        }, {
                            "left_title": "Psychotizismus",
                            "left_text": "",
                            "right_title": "",
                            "right_text": "Gefühl der Isolation und zwischenmenschlichen Entfremdung. Verzerrter, isolierter Lebensstil bis zu Halluzination und Gedankenzerfall.",
                            "m_norm": [0.19, 0.19],
                            "sd_norm": [0.28, 0.27],
                            "score_path": "calculation.scores_calculation.all_results.psychotizismus_z_score",
                            "clinic_sample_var": "psychotizismus_z_score",
                            "items": 5
                        }, {
                            "left_title": "GSI",
                            "left_text": "Global Severity Index",
                            "right_title": "GSI",
                            "right_text": "Durchschnittliche Belastung in allen Bereichen",
                            "m_norm": [0.28, 0.35],
                            "sd_norm": [0.23, 0.23],
                            "score_path": "calculation.scores_calculation.all_results.gsi_global_severity_index_z_score",
                            "clinic_sample_var": "gsi_global_severity_index_z_score",
                            "items": 53
                        }],
                        "ranges": [{
                            "range_start": -999,
                            "range_stop": 1,
                            "text": "Gesunde Ausprägung",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 1,
                            "range_stop": 2,
                            "text": "Normale Ausprägung",
                            "color": "#FFFFFF"
                        }, {
                            "range_start": 2,
                            "range_stop": 999,
                            "text": "Starke Ausprägung",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                bscl_get_zusatzitems: function (r) {

                    var d = {
                        "should_print_chart": false,
                        "zusatzitems": {
                            "defined": false,
                            "array": []
                        },
                        "dopouts": {
                            "defined": false,
                            "array": []
                        },
                        "zusatzitems_full": {
                            "defined": false,
                            "array": []
                        }
                    };

                    r.data.forEach(function (sr) {
                        if ("zusatzitem" in sr.calculation.scores_calculation) {
                            var zusatzitem = sr.calculation.scores_calculation.zusatzitem;
                            zusatzitem.items.forEach(function (item) {
                                var base_name = item.id + "__";
                                zusatzitem[base_name + "name"] = item.name;
                                zusatzitem[base_name + "result"] = item.result;
                                zusatzitem[base_name + "field"] = item.field;
                            }.bind(this));

                            if (zusatzitem.dropout === true) {
                                d.dopouts.array.push(zusatzitem);
                            } else {
                                d.zusatzitems.array.push(zusatzitem);
                            };
                            d.zusatzitems_full.array.push(zusatzitem);
                        };
                    }.bind(this));

                    if (d.zusatzitems.array.length > 0) {
                        d.zusatzitems.defined = true;
                        d.should_print_chart = true;
                    };

                    if (d.dopouts.array.length > 0) {
                        d.dopouts.defined = true;
                    };

                    if (d.zusatzitems_full.array.length > 0) {
                        d.zusatzitems_full.defined = true;
                    };

                    var return_obj = Object.assign({}, r);
                    return_obj.zusatz = d;

                    return return_obj;
                },
                bscl_get_cs_dive: function(s) {
                    var dive = [];
                    try {
                        if (s.data.length > 0) {
                            var latest_sr = s.data[s.data.length - 1];
                            
                            // Messzeitpunkt
                            if (latest_sr.calculation.scores_calculation.info.mz.mz_id !== 99) {
                                dive.push(latest_sr.calculation.scores_calculation.info.mz.mz_id);
                            };

                            // console.log('bscl_get_cs_dive SET', dive)
                        };

                    } catch (e) {
                        console.log('bscl_get_cs_dive', e)
                    };
                    return dive;                    
                },
                bscl_pdf_zusatzangaben: function (sr) {
                    var pdf = [];
                    try {

                        var allResults = sr.zusatz.zusatzitems_full.array;

                        // -----------------------------------------------
                        // Sort Results
                        // -----------------------------------------------

                        function sortByKey(array, key) {
                            return array.sort(function (a, b) {
                                var x = a[key];
                                var y = b[key];
                                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                            });
                        }


                        allResults = sortByKey(allResults, "mz_date");


                        // -----------------------------------------------
                        // Build pdfmake Table
                        // -----------------------------------------------

                        var table = {
                            "headerRows": 1,
                            "layout": "lightHorizontalLines",
                            "margin": [0, 6, 0, 12],
                            "table": {
                                "widths": [95, "*", "*", "*", "*"],
                                "body": []
                            }
                        };

                        var talbe_header = [
                            [{
                                    "text": "Messzeitpunkt",
                                    "style": "p",
                                    "margin": [0, 0, 0, 0]
                                },
                                {
                                    "text": "Datum",
                                    "style": "chart_p",
                                    "margin": [0, 0, 0, 6]
                                },
                            ],
                            {
                                "text": "Schlechter Appetit",
                                "alignment": "center",
                                "style": "p"
                            },
                            {
                                "text": "Einschlaf-schwierigkeiten",
                                "alignment": "center",
                                "style": "p"
                            },
                            {
                                "text": "Gedanken an Tod & Sterben",
                                "alignment": "center",
                                "style": "p"
                            },
                            {
                                "text": "Schuldgefühle",
                                "alignment": "center",
                                "style": "p"
                            }
                        ];

                        table.table.body.push(talbe_header);



                        allResults.forEach(function (result, resultID) {

                            if (result.dropout) {
                                // Dropout
                                var messung = [
                                    [{
                                            "text": result.mz_typ,
                                            "style": "p",
                                            "margin": [0, 6, 0, 0]
                                        },
                                        {
                                            "text": result.mz_datum,
                                            "style": "chart_p",
                                            "margin": [0, 0, 0, 6]
                                        },
                                    ],
                                    {
                                        "colSpan": 4,
                                        "margin": [0, 6, 0, 0],
                                        "text": [{
                                                "text": result.dropout_reason + "\n",
                                                "style": "p"
                                            },
                                            {
                                                "text": "Dropout (" + result.dropout_code + ")",
                                                "style": "chart_p",
                                                "color": "#F44336"
                                            }
                                        ]
                                    }
                                ];
                            } else {
                                // Daten vorhanden

                                var text_0 = "k.A.";
                                var text_1 = "k.A.";
                                var text_2 = "k.A.";
                                var text_3 = "k.A.";

                                result.items.forEach(function (item, itemID) {
                                    if (parseInt(item.id) === 0) {
                                        text_0 = item.result;
                                    };
                                    if (parseInt(item.id) === 1) {
                                        text_1 = item.result;
                                    };
                                    if (parseInt(item.id) === 2) {
                                        text_2 = item.result;
                                    };
                                    if (parseInt(item.id) === 3) {
                                        text_3 = item.result;
                                    };
                                }.bind(this));

                                var messung = [
                                    [{
                                            "text": result.mz_typ,
                                            "style": "p",
                                            "margin": [0, 6, 0, 0]
                                        },
                                        {
                                            "text": result.mz_datum,
                                            "style": "chart_p",
                                            "margin": [0, 0, 0, 6]
                                        },
                                    ],
                                    {
                                        "text": text_0,
                                        "style": "p",
                                        "alignment": "center",
                                        "margin": [0, 10, 0, 0]
                                    },
                                    {
                                        "text": text_1,
                                        "style": "p",
                                        "alignment": "center",
                                        "margin": [0, 10, 0, 0]
                                    },
                                    {
                                        "text": text_2,
                                        "style": "p",
                                        "alignment": "center",
                                        "margin": [0, 10, 0, 0]
                                    },
                                    {
                                        "text": text_3,
                                        "style": "p",
                                        "alignment": "center",
                                        "margin": [0, 10, 0, 0]
                                    }
                                ];
                            };


                            table.table.body.push(messung);


                        }.bind(this));

                        var return_stack = {
                            "id": "bscl_zusatzangaben",
                            "stack": []
                        };

                        return_stack.stack.push(makepdf._heading("Zusatzangaben", null, 'h2'));
                        return_stack.stack.push(table);

                        return return_stack;

                    } catch (e) {
                        console.log('bscl_pdf_zusatzangaben', e)
                    };

                    return pdf;
                },
                bscl_pdf_content: function (s) {
                    var pdf = [];
                    try {
                        if (s.data.length > 0) {

                            var sr = this.bscl_get_zusatzitems(s);
                            var cs_dive = this.bscl_get_cs_dive(s);

                            if (sr.zusatz.should_print_chart === true) {
                                var chart = [];
                                chart.push(makepdf._horizontalLine(100, "#F5F5F5", 1));
                                chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.bscl_chart.options), {}, included_bscl_cs, cs_dive, this.bscl_chart.scales, sr, this.bscl_chart.ranges));
                                chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                                pdf.push(makepdf._keepTogether(chart, "chart_" + this.name));
                            };

                            pdf.push(makepdf._keepTogether(this.bscl_pdf_zusatzangaben(sr), "zusatzangaben_" + this.name));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('bscl_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_bscl_anq);

// Plugin: plugin_isk_k
const plugin_isk_k = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "ISK_K",
                    "isk_k_chart": {
                        "options": {
                            "min": -8,
                            "max": 4,
                            "item_height": 76,
                            "item_text_left": 256,
                            "item_text_right": 164,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "show_range_text": true,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": false,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "norm_sample": "Z-Normierung aufgrund von Gesunden (N = 4'208)",
                            "response_title_path": "calculation.scores_calculation.info.mz.mz_typ",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Soziale Orientierung",
                            "left_text": "Auf den eigenen Vorteil bedacht sein, sich nicht für andere interessieren und deren Meinung ignorieren oder gering schätzen.",
                            "right_title": "Soziale Orientierung",
                            "right_text": "Überinvolviert, zu schnelle Kompromissbereitschaft",
                            "m_norm": [0.23, 0.32],
                            "sd_norm": [0.31, 0.33],
                            "score_path": "calculation.scores_calculation.all_results.soziale_orientierung_z_score",
                            "clinic_sample_var": "soziale_orientierung_z_score",
                            "items": 10
                        }, {
                            "id": 1,
                            "left_title": "Offensivität",
                            "left_text": "Sich sozial isolieren, Konflikten aus dem Weg gehen, sich unterordnen, Entscheidungen vor sich her schieben.",
                            "right_title": "Offensivität",
                            "right_text": "Streitlustig, unüberlegte Entscheidungen",
                            "m_norm": [0.19, 0.19],
                            "sd_norm": [0.28, 0.27],
                            "score_path": "calculation.scores_calculation.all_results.offensivit__t_z_score",
                            "clinic_sample_var": "offensivit__t_z_score",
                            "items": 8
                        }, {
                            "left_title": "Selbststeuerung",
                            "left_text": "Sich treiben lassen, in seinem Handeln von ggf. stark schwankenden Emotionen bestimmt sein und die Verantwortung für das eigene Leben in der Umwelt ansiedeln.",
                            "right_title": "Selbststeuerung",
                            "right_text": "Zwanghafte Selbstkontrolle",
                            "m_norm": [0.33, 0.34],
                            "sd_norm": [0.40, 0.38],
                            "score_path": "calculation.scores_calculation.all_results.selbststeuerung_z_score",
                            "clinic_sample_var": "selbststeuerung_z_score",
                            "items": 8
                        }, {
                            "left_title": "Reflexibilität",
                            "left_text": "Sich nicht mit seinem Verhalten auseinandersetzten, gleichgültig gegenüber dem Verhalten und Erleben anderer Menschen.",
                            "right_title": "Reflexibilität",
                            "right_text": "Zwanghafte Selbstdarstellung, Rigidität",
                            "m_norm": [0.14, 0.16],
                            "sd_norm": [0.23, 0.25],
                            "score_path": "calculation.scores_calculation.all_results.reflexibilit__t_z_score",
                            "clinic_sample_var": "reflexibilit__t_z_score",
                            "items": 7
                        }],
                        "ranges": [{
                            "range_start": -999,
                            "range_stop": -2,
                            "text": "starke Ausprägung",
                            "color": "#F44336"
                        }, {
                            "range_start": -1,
                            "range_stop": 1,
                            "text": "normale Ausprägung",
                            "color": "#4CAF50"
                        }, {
                            "range_start": 2,
                            "range_stop": 999,
                            "text": "starke Ausprägung",
                            "color": "#F44336"
                        }]
                    }
                }
            },
            methods: {
                iskk_get_cs_dive: function(s) {
                    var dive = [];
                    try {
                        if (s.data.length > 0) {
                            var latest_sr = s.data[s.data.length - 1];
                            
                            // Messzeitpunkt
                            var mz = latest_sr.calculation.scores_calculation.info.mz.mz_id - 1;
                            if ((mz === 0) || (mz === 1) || (mz === 2)) {
                                dive.push(mz);
                            } else {
                                dive.push(3);
                            };

                            // console.log('iskk_get_cs_dive SET', dive)
                        };
                    } catch (e) {
                        console.log('iskk_get_cs_dive', e)
                    };
                    return dive;                    
                },
                iskk_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var cs_dive = this.iskk_get_cs_dive(sr);

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.isk_k_chart.options), {}, included_isk_cs, cs_dive, this.isk_k_chart.scales, sr, this.isk_k_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "iskk_chart"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('iskk_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_isk_k);

// Plugin: plugin_rs13
const plugin_rs13 = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "base_config": {
                        "app_name": "Resilienzfragebogen (RS-13)",
                        "app_short_description": "Psychische Widerstandskraft",
                    },
                    "rs13_chart": {
                        "options": {
                            "min": 0,
                            "max": 100,
                            "item_height": 51,
                            "item_text_left": 65,
                            "item_text_right": 65,
                            "color_skin": "indigo_grey_pink",
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#673AB7",
                            "show_baseline": true,
                            "show_scale_text": true,
                            "show_score_vertical_line": true,
                            "show_score_profile_line": false,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "show_ranges_overview": true,
                            "allow_toggle_settings_block": false,
                            "range_alpha": 0.08,
                            "vertical_grid_every_x": 10,
                            "response_title_path": "calculation.resilienz_score.range.interpretation_de",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_text": "Niedrige Resilienz",
                            "right_text": "Hohe Resilienz",
                            "score_path": "calculation.resilienz_score.rs13_score",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                                "range_start": 13,
                                "range_stop": 66,
                                "interpretation_de": "niedrige Widerstandskraft (Resilienz)",
                                "text": "Niedrig",
                                "color": "#F44336"
                            },
                            {
                                "range_start": 67,
                                "range_stop": 72,
                                "interpretation_de": "moderate Widerstandskraft (Resilienz)",
                                "text": "Moderat",
                                "color": "#FF9800"
                            },
                            {
                                "range_start": 73,
                                "range_stop": 91,
                                "interpretation_de": "hohe Widerstandskraft (Resilienz)",
                                "text": "Hoch",
                                "color": "#4CAF50"
                            }
                        ]
                    },
                }
            },
            methods: {
                rs13_getTitle: function (r) {
                    try {
                        var ret_string = "Erfassung vom ";

                        if ("rs13_messzeitpunkt" in r.response) {
                            if (parseInt(r.response.rs13_messzeitpunkt) === 1) {
                                ret_string = "Erfassung «Eintritt» vom ";
                            };
                            if (parseInt(r.response.rs13_messzeitpunkt) === 2) {
                                ret_string = "Erfassung «Austritt» vom ";
                            };
                        } else {
                            ret_string = "Erfassung vom ";
                        };

                        if ("rs13_date" in r.response) {
                            ret_string = ret_string + this.getDateCH(r.response.rs13_date, false);
                        } else {
                            ret_string = ret_string + this.getDateCH(r.date, false);
                        };

                    } catch (e) {
                        console.error('getTitle', e);
                    }
                    return ret_string;
                },
                rs13_getSubtitle: function (r) {
                    var ret_string = "::";
                    try {
                        if (r.calculation_found) {
                            const name = r.calculation.resilienz_score.range.interpretation_de;
                            ret_string = name.charAt(0).toUpperCase() + name.slice(1);
                        } else {
                            ret_string = "Calculation wird berechnet...";
                        };
                        return ret_string;
                    } catch (e) {
                        console.error('getSubtitle', e);
                    }
                    return ret_string;
                },
                rs13_pdf_content: function (sr) {
                    var pdf = [];
                    try {

                        if (sr.data.length > 0) {

                            // Chart | Grafik
                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.rs13_chart.options), {}, {}, [], this.rs13_chart.scales, sr, this.rs13_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._spacer(10));
                            pdf.push(makepdf._keepTogether(pdf_chart, "rs13_chart"));

                            // Messungen
                            sr.data.forEach(function (sr) {
                                if (sr.calculation_found) {
                                    // Messung Titel
                                    var subtitle = [];
                                    subtitle.push(makepdf._horizontalLine(100, "#F5F5F5"));
                                    subtitle.push(makepdf._heading(this.rs13_getTitle(sr), '', 'h3'));
                                    pdf.push(makepdf._keepTogether(subtitle, "rs13_messung_title"));

                                    // Interpretation
                                    var interpretation = [];
                                    interpretation.push(makepdf._text(this.rs13_getSubtitle(sr) + ": " + sr.calculation.resilienz_score.interpretation));
                                    pdf.push(makepdf._keepTogether(interpretation, "rs13_messung_interpretation"));

                                } else {
                                    pdf.push(makepdf._noData("Resilienz: ", "Calculation noch nicht berechnet.", 6));
                                };
                            }.bind(this));

                        } else {
                            pdf.push(this.pdf_no_data(this.base_config.app_name));
                        };

                    } catch (e) {
                        console.log('rs13_pdf_content', e)
                        pdf.push(this.pdf_error(this.base_config.app_name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_rs13);

// Plugin: plugin_sci
const plugin_sci = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "SCI",
                    "sci_chart_stress": {
                        "options": {
                            "min": 0,
                            "max": 10,
                            "item_height": 58,
                            "item_text_left": 200,
                            "item_text_right": 200,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": false,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "response_title_path": "info.app_zeitpunkt",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Negative Ereignisse",
                            "left_text": "Keine oder wenig Belastung durch negative Ereignisse",
                            "right_title": "Negative Ereignisse",
                            "right_text": "Viele Stressoren durch negative Ereignisse",
                            "score_path": "calculation.scores.scores.0.stanine",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Stresssymptome",
                            "left_text": "Wenig körperliche und psychische Stressreaktionen",
                            "right_title": "Stresssymptome",
                            "right_text": "Viele körperliche und psychische Stressreaktionen",
                            "score_path": "calculation.scores.scores.1.stanine",
                            "clinic_sample_var": null
                        }],
                        "ranges": [{
                            "range_start": 0.5,
                            "range_stop": 1.5,
                            "text": "Stanine: 1 | 4%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 1.5,
                            "range_stop": 2.5,
                            "text": "Stanine: 2 | 7%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 2.5,
                            "range_stop": 3.5,
                            "text": "Stanine: 3 | 12%",
                            "color": "#FFA000"
                        }, {
                            "range_start": 3.5,
                            "range_stop": 4.5,
                            "text": "Stanine: 4 | 17%",
                            "color": "#FFA000"
                        }, {
                            "range_start": 4.5,
                            "range_stop": 5.5,
                            "text": "Stanine: 5 | 20%",
                            "color": "#FBB100"
                        }, {
                            "range_start": 5.5,
                            "range_stop": 6.5,
                            "text": "Stanine: 6 | 17%",
                            "color": "#FBB100"
                        }, {
                            "range_start": 6.5,
                            "range_stop": 7.5,
                            "text": "Stanine: 7 | 12%",
                            "color": "#FB7200"
                        }, {
                            "range_start": 7.5,
                            "range_stop": 8.5,
                            "text": "Stanine: 8 | 7%",
                            "color": "#FB7200"
                        }, {
                            "range_start": 8.5,
                            "range_stop": 9.5,
                            "text": "Stanine: 9 | 4%",
                            "color": "#C62828"
                        }]
                    },
                    "sci_chart_hilfreich": {
                        "options": {
                            "min": 0,
                            "max": 10,
                            "item_height": 58,
                            "item_text_left": 200,
                            "item_text_right": 200,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "show_ranges_overview": false,
                            "allow_toggle_settings_block": false,
                            "topnumber_hide_first_last": true,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "response_title_path": "info.app_zeitpunkt",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Positives Denken",
                            "left_text": "Stressbewältigung durch positives Denken",
                            "right_title": "Positives Denken",
                            "right_text": "Selbstzweifel und Fokus auf Negatives",
                            "score_path": "calculation.scores.scores.2.stanine",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Aktive Stressbewältigung",
                            "left_text": "Aktive und vorbeugende Stressbewältigung",
                            "right_title": "Aktive Stressbewältigung",
                            "right_text": "Stressoren werden nicht beseitigt",
                            "score_path": "calculation.scores.scores.3.stanine",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Soziale Unterstützung",
                            "left_text": "Viel Unterstützung durch Freunde und Bekannte",
                            "right_title": "Soziale Unterstützung",
                            "right_text": "Kaum Unterstützung durch andere",
                            "score_path": "calculation.scores.scores.4.stanine",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Halt im Glauben",
                            "left_text": "Person findet Halt im Glauben",
                            "right_title": "Halt im Glauben",
                            "right_text": "Kaum religiöser / spiritueller Halt",
                            "score_path": "calculation.scores.scores.5.stanine",
                            "clinic_sample_var": null
                        }, {
                            "left_title": "Alkohol- und Zigarettenkonsum",
                            "left_text": "Kein erhöhter Akohol- oder Zigarettenkonsum",
                            "right_title": "Alkohol- und Zigarettenkonsum",
                            "right_text": "Ungünstige Bewältigung durch Alkohol und Zigaretten",
                            "score_path": "calculation.scores.scores.6.stanine",
                            "clinic_sample_var": null
                        }],
                        "ranges_alt": [{
                            "range_start": 0.5,
                            "range_stop": 1.5,
                            "text": "Stanine: 1 | 4%",
                            "color": "#C62828"
                        }, {
                            "range_start": 1.5,
                            "range_stop": 2.5,
                            "text": "Stanine: 2 | 7%",
                            "color": "#FB7200"
                        }, {
                            "range_start": 2.5,
                            "range_stop": 3.5,
                            "text": "Stanine: 3 | 12%",
                            "color": "#FFA000"
                        }, {
                            "range_start": 3.5,
                            "range_stop": 4.5,
                            "text": "Stanine: 4 | 17%",
                            "color": "#FBB100"
                        }, {
                            "range_start": 4.5,
                            "range_stop": 5.5,
                            "text": "Stanine: 5 | 20%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 5.5,
                            "range_stop": 6.5,
                            "text": "Stanine: 6 | 17%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 6.5,
                            "range_stop": 7.5,
                            "text": "Stanine: 7 | 12%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 7.5,
                            "range_stop": 8.5,
                            "text": "Stanine: 8 | 7%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 8.5,
                            "range_stop": 9.5,
                            "text": "Stanine: 9 | 4%",
                            "color": "#2E7D32"
                        }],
                        "ranges": [{
                            "range_start": 0.5,
                            "range_stop": 1.5,
                            "text": "Stanine: 1 | 4%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 1.5,
                            "range_stop": 2.5,
                            "text": "Stanine: 2 | 7%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 2.5,
                            "range_stop": 3.5,
                            "text": "Stanine: 3 | 12%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 3.5,
                            "range_stop": 4.5,
                            "text": "Stanine: 4 | 17%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 4.5,
                            "range_stop": 5.5,
                            "text": "Stanine: 5 | 20%",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 5.5,
                            "range_stop": 6.5,
                            "text": "Stanine: 6 | 17%",
                            "color": "#FBB100"
                        }, {
                            "range_start": 6.5,
                            "range_stop": 7.5,
                            "text": "Stanine: 7 | 12%",
                            "color": "#FFA000"
                        }, {
                            "range_start": 7.5,
                            "range_stop": 8.5,
                            "text": "Stanine: 8 | 7%",
                            "color": "#FB7200"
                        }, {
                            "range_start": 8.5,
                            "range_stop": 9.5,
                            "text": "Stanine: 9 | 4%",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                sci_get_population: function (_sr) {

                    var _sr_sci = [];
                    var population = ""


                    _sr.data.forEach(function (current, ID) {

                        current.info = {};
                        current.info.app_zeitpunkt = 'Unbekannt';
                        if ("Erhebungszeitpunkt" in current.calculation.scores.response.data.response) {

                            if (current.calculation.scores.response.data.response.Erhebungszeitpunkt === "1") {
                                current.info.app_zeitpunkt = 'Eintritt';
                            } else {
                                if (current.calculation.scores.response.data.response.Erhebungszeitpunkt === "2") {
                                    current.info.app_zeitpunkt = 'Austritt';
                                } else {
                                    current.info.app_zeitpunkt = 'Verlauf';
                                };
                            };
                        };

                        current.info.score_0 = parseInt(current.calculation.scores.scores["0"].stanine);
                        current.info.score_1 = parseInt(current.calculation.scores.scores["1"].stanine);
                        current.info.score_2 = 10 - parseInt(current.calculation.scores.scores["2"].stanine);
                        current.info.score_3 = 10 - parseInt(current.calculation.scores.scores["3"].stanine);
                        current.info.score_4 = 10 - parseInt(current.calculation.scores.scores["4"].stanine);
                        current.info.score_5 = 10 - parseInt(current.calculation.scores.scores["5"].stanine);
                        current.info.score_6 = parseInt(current.calculation.scores.scores["6"].stanine);

                        population = current.calculation.scores.population.name;

                        _sr_sci.push(current);

                    });

                    var return_obj = {
                        "done": true,
                        "population": population,
                        "data": _sr_sci
                    }

                    if (_sr_sci.length > 0) {
                        return_obj.have_data = true;
                    } else {
                        return_obj.have_data = false;
                    };
                    return return_obj;

                },
                sci_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var population_data = this.sci_get_population(sr);

                            var stanine_beschriftung = {
                                "id": "stanine_beschriftung",
                                "stack": [{
                                        "text": population_data.population,
                                        "style": "chart_p",
                                        "alignment": "center",
                                        "margin": [0, 12, 0, 0]
                                    },
                                    {
                                        "text": "Stanine",
                                        "style": "chart_p",
                                        "color": "#9E9E9E",
                                        "alignment": "center",
                                        "margin": [0, 0, 0, 0]
                                    },
                                ]
                            };

                            var chart_stress = [];
                            chart_stress.push(makepdf._heading("Stressereignisse und Syptome", "", 'h2'));
                            chart_stress.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            chart_stress.push(stanine_beschriftung);
                            chart_stress.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.sci_chart_stress.options), {}, {}, [], this.sci_chart_stress.scales, sr, this.sci_chart_stress.ranges));
                            chart_stress.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf.push(makepdf._keepTogether(chart_stress, this.name + "_chart_stanine_stress"));

                            var chart_hilfreich = [];
                            chart_hilfreich.push(makepdf._heading("Copingstrategien", "", 'h2'));
                            chart_hilfreich.push(makepdf._text("Diese helfen die möglichen körperlichen und psychischen Stressreaktionen zu vermeiden oder zu reduzieren."));
                            chart_hilfreich.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            chart_hilfreich.push(stanine_beschriftung);
                            chart_hilfreich.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.sci_chart_hilfreich.options), {}, {}, [], this.sci_chart_hilfreich.scales, sr, this.sci_chart_hilfreich.ranges));
                            chart_hilfreich.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf.push(makepdf._keepTogether(chart_hilfreich, this.name + "_chart_stanine_coping"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('sci_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_sci);

// Plugin: plugin_tmt
const plugin_tmt = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "TMT",
                    "tmt_chart": {
                        "options": {
                            "min": -6,
                            "max": "auto",
                            "item_height": 58,
                            "item_text_left": 100,
                            "item_text_right": 100,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "range_alpha": 0.09,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": false,
                            "vertical_grid_every_x": 1,
                            "norm_sample": "Z-Normierung anhand von Gesunden",
                            "response_title_path": "calculation.tmt_score.Messzeitpunkt.Messzeitpunkt_Text",
                            "response_date_path": "date"
                        },
                        "start": {
                            "left_title": "schnell",
                            "left_text": "Schneller im Vergleich zur Norm",
                            "left_color": "#4CAF50",
                            "right_title": "langsam",
                            "right_text": "Verlangsamung gegenüber Norm",
                            "right_color": "#F44336"
                        },
                        "scales": [{
                            "left_title": "TMT A",
                            "left_text": "schnell",
                            "right_title": "TMT A",
                            "right_text": "langsam",
                            "score_path": "calculation.tmt_score.percentile.z_scores.tmtA_z_neu_rounded",
                            "clinic_sample_var": "TMTAZ",
                            "items": 1
                        }, {
                            "id": 1,
                            "left_title": "TMT B",
                            "left_text": "schnell",
                            "right_title": "TMT B",
                            "right_text": "langsam",
                            "score_path": "calculation.tmt_score.percentile.z_scores.tmtB_z_neu_rounded",
                            "clinic_sample_var": "TMTBZ",
                            "items": 5
                        }],
                        "ranges": [{
                            "range_start": -999,
                            "range_stop": 1,
                            "text": "Normale Geschwindigkeit",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 2,
                            "range_stop": 999,
                            "text": "Verlangsamung gegenüber Norm",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                _show_BA: function (mz) {
                    mz = mz || 999
                    if (mz === 1) {
                        return true;
                    } else {
                        return false;
                    }
                },
                tmt_get_cs_dive: function(s) {
                    var dive = [];
                    try {
                        if (s.data.length > 0) {
                            var latest_sr = s.data[s.data.length - 1];

                            // ---- Altersgruppe
                            if (latest_sr.calculation.tmt_score.percentile.age_perz.altersgruppe !== 99) {
                                dive.push(latest_sr.calculation.tmt_score.percentile.age_perz.altersgruppe);
                            } else {
                                dive.push(11);
                            };
                        
                            // Ausbildungsgrad
                            var ausbildungsgrad = latest_sr.calculation.tmt_score.percentile.age_perz.education_high;
                            if (ausbildungsgrad === true) {
                                dive.push(1);
                            } else {
                                dive.push(0);
                            };
                        
                            // Messzeitpunkt
                            var mz = latest_sr.calculation.tmt_score.mz - 1;
                            if ((mz === 0) || (mz === 1) || (mz === 2)) {
                                dive.push(mz);
                            } else {
                                dive.push(3);
                            };
  
                            // console.log('tmt_get_cs_dive SET', dive)
                        };
                    } catch (e) {
                        console.log('tmt_get_cs_dive', e)
                    };
                    return dive;                    
                },
                tmt_pdf_datenblatt: function (_sr) {
                    // ----------------------------------------------- 
                    // Build pdfmake Table 
                    // -----------------------------------------------

                    var table = {
                        "headerRows": 1,
                        "layout": "lightHorizontalLines",
                        "margin": [
                            0, 6, 0, 12
                        ],
                        "table": {
                            "widths": [
                                170,
                                "*",
                                "*",
                                "*",
                                "*",
                                "*"
                            ],
                            "body": []
                        }
                    };

                    var talbe_header = [
                        [{
                            "text": "Messzeitpunkt",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "Datum",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }],
                        [{
                            "text": "Zeit",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "TMT A",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }],
                        [{
                            "text": "Fehler",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "TMT A",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }],
                        [{
                            "text": "Zeit",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "TMT B",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }],
                        [{
                            "text": "Fehler",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "TMT B",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }],
                        [{
                            "text": "Quotient",
                            "style": "p",
                            "margin": [0, 0, 0, 0]
                        }, {
                            "text": "B/A",
                            "style": "chart_p",
                            "margin": [0, 0, 0, 6]
                        }]
                    ];

                    table.table.body.push(talbe_header);

                    _sr.data.forEach(function (item, resultID) {

                        var messung = [
                            [{
                                "text": item.calculation.tmt_score.Messzeitpunkt.Messzeitpunkt_Text,
                                "style": "p",
                                "margin": [0, 6, 0, 0]
                            }, {
                                "text": this.getDateCH(item.date, false),
                                "style": "chart_p",
                                "margin": [0, 0, 0, 6]
                            }], {
                                "text": item.calculation.tmt_score.TMTATime,
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            }, {
                                "text": item.calculation.tmt_score.TMTAError,
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            }, {
                                "text": item.calculation.tmt_score.TMTBTime,
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            }, {
                                "text": item.calculation.tmt_score.TMTBError,
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            }
                        ];

                        if (this._show_BA(item.calculation.tmt_score.Messzeitpunkt.Messzeitpunkt)) {
                            var ba = {
                                "text": item.calculation.tmt_score.quotient_rounded,
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            };
                        } else {
                            var ba = {
                                "text": "-",
                                "style": "p",
                                "margin": [0, 11, 0, 0]
                            };
                        }

                        messung.push(ba);

                        table.table.body.push(messung);

                    }.bind(this));

                    var return_stack = {
                        "id": "tmt_datenblatt",
                        "stack": []
                    };

                    return_stack.stack.push(makepdf._heading("Datenblatt", null, 'h2'));
                    return_stack.stack.push(table);

                    return return_stack;
                },
                tmt_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var cs_dive = this.tmt_get_cs_dive(sr);

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.tmt_chart.options), {}, included_tmt_cs, cs_dive, this.tmt_chart.scales, sr, this.tmt_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "tmt_chart"));
                            pdf.push(makepdf._keepTogether(this.tmt_pdf_datenblatt(sr), "tmt_datenblatt"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('tmt_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_tmt);

// Plugin: plugin_whoqol
const plugin_whoqol = {
    install(Vue, options) {
        Vue.mixin({
            data: function () {
                return {
                    "name": "WHOQOL-BREF",
                    "whoqol_chart": {
                        "options": {
                            "min": -2,
                            "max": 5,
                            "item_height": 75,
                            "item_text_left": 120,
                            "item_text_right": 120,
                            "color_grid": "#9E9E9E",
                            "color_clinic_sample": "#888888",
                            "color_skin": "grey_dark_to_light",
                            "show_baseline": false,
                            "show_ranges_overview": false,
                            "show_scale_text": true,
                            "show_score_vertical_line": false,
                            "show_score_profile_line": true,
                            "show_score_circles": true,
                            "show_settings_block": false,
                            "allow_toggle_settings_block": true,
                            "topnumber_hide_first_last": false,
                            "range_alpha": 0.09,
                            "vertical_grid_every_x": 1,
                            "norm_sample": "Z-Normierung anhand von Gesunden",
                            "response_title_path": "calculation.phys_psych_calculation.info.mz.mz_typ",
                            "response_date_path": "date"
                        },
                        "scales": [{
                            "left_title": "Körperliche Lebensqualität",
                            "left_text": "Hoch",
                            "right_title": "Körperliche Lebensqualität",
                            "right_text": "Vermindert",
                            "score_path": "calculation.phys_psych_calculation.all_results.koerperliche_lebensqualitaet_z_score_inverted",
                            "clinic_sample_var": "koerperliche_lebensqualitaet_z_score_inverted"
                        }, {
                            "id": 1,
                            "left_title": "Psychische Lebensqualität",
                            "left_text": "Hoch",
                            "right_title": "Psychische Lebensqualität",
                            "right_text": "Vermindert",
                            "score_path": "calculation.phys_psych_calculation.all_results.psychische_lebensqualitaet_z_score_inverted",
                            "clinic_sample_var": "psychische_lebensqualitaet_z_score_inverted"
                        }],
                        "ranges": [{
                            "range_start": -999,
                            "range_stop": 1,
                            "text": "Normale Lebensqualität",
                            "color": "#2E7D32"
                        }, {
                            "range_start": 2,
                            "range_stop": 999,
                            "text": "Verminderte Lebensqualität",
                            "color": "#C62828"
                        }]
                    }
                }
            },
            methods: {
                whoqol_get_cs_dive: function(s) {
                    var dive = [];
                    try {
                        if (s.data.length > 0) {
                            var latest_sr = s.data[s.data.length - 1];
                            
                            // Messzeitpunkt
                            if (latest_sr.calculation.phys_psych_calculation.info.mz.mz_id !== 99) {
                                dive.push((latest_sr.calculation.phys_psych_calculation.info.mz.mz_id - 1));
                            } else {
                                dive.push(3);
                            };

                            // Altersgruppe
                            if (latest_sr.calculation.phys_psych_calculation.info.age_norm.altersgruppe !== 99) {
                                dive.push((latest_sr.calculation.phys_psych_calculation.info.age_norm.altersgruppe));
                            } else {
                                dive.push(8);
                            };

                            // Geschlecht
                            if (latest_sr.patient.gender === "female") {
                                dive.push(0);
                            } else {
                                dive.push(1);
                            };

                            // console.log('whoqol_get_cs_dive SET', dive)
                        };

                    } catch (e) {
                        console.log('whoqol_get_cs_dive', e)
                    };
                    return dive;                    
                },
                whoqol_pdf_content: function (sr) {
                    var pdf = [];
                    try {
                        if (sr.data.length > 0) {

                            var cs_dive = this.whoqol_get_cs_dive(sr);

                            var pdf_chart = [];
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));
                            pdf_chart.push(makepdf._pdf_chart_profile("de", this.get_pdf_chart_options(this.whoqol_chart.options), {}, included_whoqol_cs, cs_dive, this.whoqol_chart.scales, sr, this.whoqol_chart.ranges));
                            pdf_chart.push(makepdf._horizontalLine(100, "#F5F5F5"));

                            pdf.push(makepdf._keepTogether(pdf_chart, "audit_chart"));

                        } else {
                            pdf.push(this.pdf_no_data(this.name));
                        };

                    } catch (e) {
                        console.log('whoqol_pdf_content', e)
                        pdf.push(this.pdf_error(this.name));
                    };

                    return pdf;
                }
            }
        });
    }
};
Vue.use(plugin_whoqol);

// ----------------------------------------
// General Includes
// ----------------------------------------

const included_bscl_cs = null;
const included_isk_cs  = null;
const included_tmt_cs = null;
const included_whoqol_cs  = null;



// <optinmic-profile-chart>
Vue.component('optinmic-profile-chart', {
    props: {
        options: {
            type: Object,
            default: null
        },
        scales: {
            type: Array,
            default: null
        },
        scores: {
            type: Object,
            default: null
        },
        ranges: {
            type: Array,
            default: null
        },
        clinic_samples: {
            type: Object,
            default: null
        },
        clinic_sample_dive: {
            type: Array,
            default: null
        }
    },
    data: function () {
        return {
            chart: null,
            chart_data: {
                data: null,
                dive: null
            },
            container_top_height: 18,
            cs_toggle: false
        };
    },
    watch: {
        chart_data: function () {
            // console.log('DATA Changed', newData, oldData);
            this.chart.data = this.chart_data.data;
            this.chart.invalidateRawData();
        }
    },
    methods: {
        toggleCS() {
            if (this.clinic_samples !== null) {
                this.cs_toggle = !this.cs_toggle;
            }
        },
        updateData() {
            // User did something
            this.chart_data = this.dataBuild();
        },
        dataBuild() {
            // Prepare Data
            var scores_orig = this.scores;
            var scales = this.scales;
            var options = this.options;
            var cs = this.clinic_samples;
            var cs_dive = this.getCSDive;

            try {
                var scores = JSON.parse(JSON.stringify(scores_orig));
                var data_object = {
                    data: [],
                    captures: [],
                    dive: cs_dive,
                    cs_sample_n: 0,
                    cs_sample_text: ""
                };

                var getCategoryText = function (title, text) {
                    var r = "";
                    
                    if ((title !== "") && (title !== undefined)) {
                        r = r + title;
                    }
                    
                    if (((title !== "") && (title !== undefined)) && ((text !== "") && (text !== undefined))) {
                        r = r + ": ";
                    }
                    
                    if ((text !== "") && (text !== undefined)) {
                        r = r + text;
                    }
                    return "[font-size:11px]" + r + "[/]";
                };

                var flatten = function (obj, name, stem) {
                    var out = {};
                    var newStem =
                        typeof stem !== "undefined" && stem !== "" ?
                        stem + "." + name :
                        name;

                    if (typeof obj !== "object") {
                        out[newStem] = obj;
                        return out;
                    }

                    for (var p in obj) {
                        var prop = flatten(obj[p], p, newStem);
                        out = merge([out, prop]);
                    }

                    return out;
                };

                var merge = function (objects) {
                    var out = {};

                    for (var i = 0; i < objects.length; i++) {
                        for (var p in objects[i]) {
                            out[p] = objects[i][p];
                        }
                    }

                    return out;
                };

                var getDataDive = function (_d, dive, cs_var) {
                    var return_obj = {};
                    var build_var = "";
                    dive.forEach(
                        function (_pos) {
                            build_var = build_var + _pos;
                            build_var = build_var + ".";
                        }.bind(this)
                    );
                    build_var = build_var + "statistics." + cs_var;
                    var data = flatten(_d);

                    return_obj.n = data[build_var + ".n"];
                    return_obj.max = data[build_var + ".max"];
                    return_obj.min = data[build_var + ".min"];
                    return_obj.mean = data[build_var + ".mean"];
                    return_obj.standard_deviation =
                        data[build_var + ".standard_deviation"];
                    return_obj.mean_1sd_min = data[build_var + ".mean_1sd_min"];
                    return_obj.mean_1sd_plus = data[build_var + ".mean_1sd_plus"];
                    return_obj.variance = data[build_var + ".variance"];
                    return_obj.z_score_min = data[build_var + ".z_score_min"];
                    return_obj.z_score_max = data[build_var + ".z_score_max"];

                    return return_obj;
                };

                scales.forEach(
                    function (s, sid) {
                        var scale = Object.assign({}, s);
                        // Category
                        scale.category_left = getCategoryText(s.left_title, s.left_text);
                        scale.category_right = getCategoryText(s.right_title, s.right_text);

                        // Messungen hinzufügen
                        scores.data.forEach(
                            function (_sr) {
                                var sr = flatten(_sr);
                                var capture_name = "capture_event_" + sr.event_id;
                                if (sid === 0) {
                                    var obj = {
                                        category: capture_name,
                                        name: sr[options.response_title_path],
                                        date: sr[options.response_date_path],
                                        dropout: false
                                    };

                                    // Dropout
                                    if (sr[options.dropout] === true) {
                                        obj.name =
                                            "[red font-size: 12px]" + sr[options.dropout_reason];
                                        obj.dropout = true;
                                    }
                                    data_object.captures.push(obj);
                                }
                                scale[capture_name] = sr[scale.score_path];
                            }.bind(this)
                        );

                        // Clinic Samples hinzufügen;
                        if (cs !== null) {
                            // If no Dive is given - always last.
                            if (cs_dive === null) {
                                cs_dive = [];
                                if ("dimensions" in cs) {
                                    cs.dimensions.forEach(
                                        function (dim) {
                                            cs_dive.push(dim.array.length - 1);
                                        }.bind(this)
                                    );
                                    data_object.dive = cs_dive;
                                }
                            }

                            // get current statisics object
                            scale.cs_data = getDataDive(
                                cs.data,
                                cs_dive,
                                scale.clinic_sample_var
                            );

                            scale.cs_mean = null;
                            scale.cs_start = null;
                            scale.cs_end = null;
                            data_object.cs_sample_n = "...";

                            if (scale.cs_data) {
                                scale.cs_mean = scale.cs_data.mean;
                                scale.cs_start = scale.cs_data.mean_1sd_min;
                                scale.cs_end = scale.cs_data.mean_1sd_plus;
                                data_object.cs_sample_n = scale.cs_data.n;
                            } else {
                                console.error(
                                    "--> CS",
                                    cs.data,
                                    cs_dive,
                                    scale.cs_full_data,
                                    s,
                                    sid
                                );
                            }
                        }

                        // publish
                        data_object.data.push(scale);
                    }.bind(this)
                );

                // Fill CS Text
                // Clinic Samples hinzufügen;
                if (cs !== null) {
                    cs.dimensions.forEach(
                        function (dim, dim_id) {
                            if (data_object.cs_sample_text !== "") {
                                data_object.cs_sample_text = data_object.cs_sample_text + " | ";
                            }
                            data_object.cs_sample_text =
                                data_object.cs_sample_text +
                                dim.array[data_object.dive[dim_id]].text;
                        }.bind(this)
                    );

                    if (data_object !== undefined) {
                        // console.error('HERE', data_object);
                        data_object.cs_sample_text =
                            data_object.cs_sample_text +
                            " (N=" +
                            data_object.cs_sample_n +
                            ")";
                    }
                }

                // console.warn('buildData :: ', data_object);
                // this.chart_data = data_object;
                return data_object;
            } catch (e) {
                console.error("Error: buildData", e);
            }
        },
        chartBuild() {
            // console.warn("BUILD CHART NOW!");

            // ---------------------------------
            // Functions
            // ---------------------------------

            var hasValue = function (value) {
                try {
                    if (
                        value === null ||
                        value === "null" ||
                        value === undefined ||
                        value === ""
                    ) {
                        return false;
                    } else {
                        return true;
                    }
                } catch (e) {
                    return false;
                }
            };

            var drawRanges = function (ranges, options) {
                try {
                    // console.warn('drawRanges :: ', ranges, options);

                    ranges.forEach(
                        function (r) {
                            var range = valueAxis.axisRanges.create();
                            var range_start = r.range_start;
                            if (range_start === -999) {
                                range_start = options.min;
                            }
                            var range_stop = r.range_stop;
                            if (range_stop === 999) {
                                range_stop = options.max;
                            }

                            range.value = range_start;
                            range.endValue = range_stop;
                            range.axisFill.fill = am4core.color(r.color);
                            range.axisFill.fillOpacity = options.range_alpha || 0.3;
                            //range.grid.stroke = am4core.color(r.color);
                            //range.grid.strokeOpacity = 0.8;

                            var range_line_left = valueAxis.axisRanges.create();
                            range_line_left.value = r.range_start;
                            range_line_left.endValue = r.range_start + 0.01;
                            range_line_left.axisFill.fill = am4core.color(r.color);
                            range_line_left.axisFill.fillOpacity = 0.8;
                            range_line_left.axisFill.strokeOpacity = 0;

                            var range_line_right = valueAxis.axisRanges.create();
                            range_line_right.value = r.range_stop - 0.01;
                            range_line_right.endValue = r.range_stop;
                            range_line_right.axisFill.fill = am4core.color(r.color);
                            range_line_right.axisFill.fillOpacity = 0.8;

                            if (options.show_range_text === true) {
                                range.label.text = "[font-size:12px]" + r.text + "[/]";
                                range.label.fill = am4core.color("black");
                                range.label.fillOpacity = 0.5;

                                range.label.inside = true;
                                range.label.location = 0;
                                range.label.rotation = 90;
                                range.label.marginTop = 5;
                                range.label.adapter.add("horizontalCenter", function () {
                                    return "left";
                                });
                                range.label.adapter.add("verticalCenter", function () {
                                    return "bottom";
                                });
                            }
                        }.bind(this)
                    );
                } catch (e) {
                    console.error("Error: drawRanges", e);
                }
            };

            var drawAxis = function (options) {
                try {
                    // console.warn('drawAxis :: ', options);

                    //create LEFT category axis
                    var categoryAxis_left = chart.yAxes.push(
                        new am4charts.CategoryAxis()
                    );
                    var label_left = categoryAxis_left.renderer.labels.template;
                    label_left.wrap = true;
                    label_left.align = "left";
                    //label_left.truncate = true;
                    label_left.maxWidth = options.item_text_left;
                    categoryAxis_left.dataFields.category = "category_left";
                    categoryAxis_left.renderer.grid.template.location = 0;
                    categoryAxis_left.renderer.opposite = false;
                    categoryAxis_left.renderer.inversed = true;

                    //create LEFT category axis
                    var categoryAxis_right = chart.yAxes.push(
                        new am4charts.CategoryAxis()
                    );
                    var label_right = categoryAxis_right.renderer.labels.template;
                    label_right.wrap = true;
                    label_right.align = "left";
                    //label_right.truncate = true;
                    label_right.maxWidth = options.item_text_right;
                    categoryAxis_right.dataFields.category = "category_right";
                    categoryAxis_right.renderer.grid.template.location = 0;
                    categoryAxis_right.renderer.opposite = true;
                    categoryAxis_right.renderer.inversed = true;
                } catch (e) {
                    console.error("Error: drawAxis", e);
                }
            };

            var drawProfiles = function (data_object, options) {
                try {
                    // console.warn('drawProfiles :: ', data_object);
                    var stroke_width = 6;

                    var getDateCH = function (date, full) {
                        var dateObj = new Date(date);
                        var o = {};
                        if (full === true) {
                            o = {
                                weekday: "long",
                                year: "numeric",
                                month: "long",
                                day: "numeric"
                            };
                        } else {
                            o = {
                                year: "numeric",
                                month: "numeric",
                                day: "numeric"
                            };
                        }
                        return dateObj.toLocaleDateString("de-DE", o);
                    };

                    data_object.captures.forEach(
                        function (val) {
                            //create line
                            var lineSeries = chart.series.push(new am4charts.LineSeries());
                            lineSeries.dataFields.categoryY = "category_left";
                            lineSeries.dataFields.valueX = val.category;
                            lineSeries.name =
                                "[font-size: 14px]" +
                                getDateCH(val.date) +
                                "[/]\n[font-size: 12px]" +
                                val.name;
                            lineSeries.strokeWidth = stroke_width;
                            lineSeries.strokeOpacity = 1;
                            lineSeries.tooltipText = val.name + ": {valueX.value}";

                            //add bullets | show_score_circles
                            var show_score_circles = true;
                            if (
                                hasValue(options.show_score_circles) &&
                                options.show_score_circles === false
                            ) {
                                show_score_circles = false;
                            }
                            if (show_score_circles) {
                                var circleBullet = lineSeries.bullets.push(
                                    new am4charts.CircleBullet()
                                );
                                circleBullet.circle.fill = am4core.color("#fff");
                                circleBullet.circle.strokeWidth = stroke_width;
                            }

                            //add line-bullets | show_score_profile_line
                            var show_score_vertical_line = false;
                            if (
                                hasValue(options.show_score_profile_line) &&
                                options.show_score_vertical_line === true
                            ) {
                                show_score_vertical_line = true;
                            }
                            if (show_score_vertical_line) {
                                var lineBullet = lineSeries.bullets.push(
                                    new am4charts.Bullet()
                                );
                                var square = lineBullet.createChild(am4core.Rectangle);
                                square.width = stroke_width;
                                square.height = options.item_height;
                                square.horizontalCenter = "middle";
                                square.verticalCenter = "middle";
                                var circle = lineBullet.createChild(am4core.Circle);
                                circle.fill = "white";
                                circle.radius = stroke_width / 2;
                                circle.height = options.item_height;
                                circle.horizontalCenter = "middle";
                                circle.verticalCenter = "middle";
                            }
                        }.bind(this)
                    );
                } catch (e) {
                    console.error("Error: drawProfiles", e);
                }
            };

            var drawCS = function (cs, options) {
                // console.warn('drawCS :: ', cs);

                var series = chart.series.push(new am4charts.ColumnSeries());
                series.dataFields.categoryY = "category_left";
                series.dataFields.valueX = "cs_end";
                series.dataFields.openValueX = "cs_start";
                series.name = "[font-size: 12px] Klinikstichprobe";
                series.tooltipText = "{openValueX.value} - {valueX.value}";

                if (hasValue(options.color_clinic_sample)) {
                    // series.columns.template.fill = options.color_clinic_sample;
                    var gradient = new am4core.LinearGradient();
                    gradient.addColor(am4core.color(options.color_clinic_sample));
                    gradient.addColor(am4core.color(options.color_clinic_sample));
                    gradient.addColor(am4core.color("black"));
                    gradient.addColor(am4core.color(options.color_clinic_sample));
                    gradient.addColor(am4core.color(options.color_clinic_sample));
                    series.columns.template.fill = gradient;
                    series.columns.template.fillOpacity = 0.35;

                    series.columns.template.stroke = options.color_clinic_sample;
                    series.columns.template.strokeWidth = 1;
                    series.columns.template.strokeOpacity = 0.65;
                }
            };

            var drawNormSampleText = function (
                options,
                container_top_height,
                chart_data
            ) {
                var fontSize = 12;

                var c_top_left = container_top.createChild(am4core.Container);
                c_top_left.width = options.item_text_left;
                c_top_left.height = container_top_height;
                c_top_left.marginRight = fontSize / 2;

                var c_top_right = container_top.createChild(am4core.Container);
                c_top_right.width = am4core.percent(100);
                c_top_right.height = container_top_height;
                c_top_right.marginLeft = fontSize / 2;

                var l1 = c_top_left.createChild(am4core.Label);
                l1.text = "Normstichprobe";
                l1.fontSize = fontSize;
                l1.horizontalCenter = "right";
                l1.verticalCenter = "center";
                l1.x = options.item_text_left;
                l1.y = 0;
                l1.fill = "black";
                l1.fillOpacity = 0.5;

                var r1 = c_top_right.createChild(am4core.Label);
                r1.text = options.norm_sample;
                r1.fontSize = fontSize;
                r1.x = 0;
                r1.y = 0;
                r1.fill = "black";
                r1.fillOpacity = 0.8;

                var l2 = c_top_left.createChild(am4core.Label);
                l2.text = "Klinikstichprobe";
                l2.fontSize = fontSize;
                l2.horizontalCenter = "right";
                l2.verticalCenter = "center";
                l2.x = options.item_text_left;
                l2.y = l1.fontSize + 6;
                l2.fill = "black";
                l2.fillOpacity = 0.5;

                var r2 = c_top_right.createChild(am4core.Label);
                r2.text = chart_data.cs_sample_text;
                r2.fontSize = fontSize;
                r2.x = 0;
                r2.y = l1.fontSize + 6;
                r2.fill = "black";
                r2.fillOpacity = 0.8;
            };

            // Containers
            var container = am4core.create(this.$refs.chartdiv, am4core.Container);
            container.width = am4core.percent(100);
            container.height = am4core.percent(100);
            container.layout = "vertical";

            if (this.clinic_samples !== null) {
                var container_top = container.createChild(am4core.Container);
                container_top.width = am4core.percent(100);
                container_top.height = this.container_top_height;
                container_top.layout = "horizontal";
            }

            var container_chart = container.createChild(am4core.Container);
            container_chart.width = am4core.percent(100);
            container_chart.height = am4core.percent(100);
            container_chart.toFront();

            // Create Chart & add Data
            let chart = container_chart.createChild(am4charts.XYChart);
            chart.dateFormatter.dateFormat = "dd.MM.yyyy";
            chart.exporting.menu = new am4core.ExportMenu();
            chart.exporting.title = "Optinomic - Chart";
            chart.exporting.filePrefix = "optinomic_chart";

            // Create value axis for captures
            var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
            valueAxis.renderer.opposite = true;
            valueAxis.min = this.options.min;
            valueAxis.max = this.options.max;

            // Add Data to Chart
            this.chart_data = this.dataBuild();
            chart.data = this.chart_data.data;

            // Zeichne Achsen
            drawAxis(this.options);

            // Ranges
            drawRanges(this.ranges, this.options);

            // Profiles
            drawProfiles(this.chart_data, this.options);

            // Klinikstichprobe
            if (this.clinic_samples !== null) {
                drawCS(this.clinic_samples, this.options);

                drawNormSampleText(
                    this.options,
                    this.container_top_height,
                    this.chart_data
                );
            }

            // add chart cursor
            chart.cursor = new am4charts.XYCursor();
            chart.cursor.behavior = "zoomX";

            // add legend
            chart.legend = new am4charts.Legend();

            // Set
            this.chart = chart;
        }
    },
    computed: {
        getCSDive() {
            if (this.chart_data.dive) {
                return this.chart_data.dive;
            } else {
                return this.clinic_sample_dive;
            }
        },
        getChartHeight() {
            var height =
                (this.scales.length + 2) * this.options.item_height +
                this.container_top_height;
            // height = height + this.options.item_height;
            return height;
        }
    },
    mounted() {
        this.chartBuild();
    },
    beforeDestroy() {
        if (this.chart) {
            this.chart.dispose();
        }
    },
    template: `
        <template>
            <div ref="full_chart">
              <div v-bind:style="{ width: '100%', height: getChartHeight + 'px' }" ref="chartdiv"></div>
              <div style="background:white;z-index:100;position:relative;height: 50px;width: 60px;max-width: 80px;margin-top:-55px;"></div>
              <div style="margin-top:-60px;z-index:200;position:relative" v-if="clinic_samples">
                <v-tooltip right>
                  <template v-slot:activator="{ on }">
                    <div v-on="on">
                      <v-btn
                        icon
                        v-on:click="toggleCS"
                        v-if="!cs_toggle"
                        class="ma-2"
                        color="grey"
                      >
                        <v-icon>mdi-settings</v-icon>
                      </v-btn>

                      <v-btn
                        icon
                        v-on:click="toggleCS"
                        v-if="cs_toggle"
                        class="ma-2"
                        color="pink"
                      >
                        <v-icon>mdi-settings-box</v-icon>
                      </v-btn>
                    </div>
                  </template>
                  <span>Klinikstichprobe anpassen</span>
                </v-tooltip>
              </div>
              
              <v-container fluid v-if="cs_toggle">
                <v-row align="center" v-if="chart_data.dive">
                  <v-col
                    class="d-flex"
                    cols="12"
                    :sm="12 / chart_data.dive.length"
                    v-for="(dim, index) in clinic_samples.dimensions"
                    :key="index"
                  >
                    <v-select
                      :label="dim.name"
                      :items="dim.array"
                      item-value="id"
                      v-model="chart_data.dive[index]"
                      v-on:change="updateData"
                    ></v-select>
                  </v-col>
                </v-row>
              </v-container>
              
            </div>
        </template>
      `
});


// ----------------------------------------
// General Components
// ----------------------------------------
// Optinomic App-Optinomic
Vue.component('app-optinomic', {
    props: {
        title: {
            type: String,
            default: "Optinomic"
        },
        subtitle: {
            type: String,
            default: "App"
        },
        identifier: {
            type: String,
            default: helpers.getAppID()
        }
    },
    created() {
        var params = {
            "identifier": this.identifier,
            "title": this.title,
            "subtitle": this.subtitle
        };
        this.$store.dispatch('getSurveyResponses', params);
        this.$store.dispatch('getApps');

        if (helpers.getPatientID() !== 0) {
            this.$store.dispatch('getPatient');
            this.$store.dispatch('getPatientStays');
        };
        this.$store.dispatch('getUser');
        this.$store.dispatch('getClinic');
    },
    computed: {
        sr() {
            try {
                return this.$store.state.data_apps.data_object[this.identifier];
            } catch (e) {
                return [];
            };
        },
        isAdmin() {
            try {
                return this.$store.state.user.data.isAdmin;
            } catch (e) {
                return {};
            };
        },
        loaded() {
            try {
                if (this.sr.loaded === true) {
                    return true;
                } else {
                    return false;   
                };
            } catch (e) {
                return false;
            };
        },
        user_text() {
            try {
                return this.$store.state.user.data.first_name + " " + this.$store.state.user.data.last_name + " (" + this.$store.state.user.data.initials + ")";
            } catch (e) {
                return '';
            };
        },
        clinic_data() {
            try {
                return this.$store.state.clinic.data;
            } catch (e) {
                return false;
            };
        },
        could_have_data() {
            try {
                var ret_bool = false;
                if (this.$store.state.current_app.module.surveys.length > 0) {
                    ret_bool = true;
                }
                return ret_bool;
            } catch (e) {
                return false;
            };
        },
        missing_data() {
            try {
                if (this.sr === null) {
                    return false;
                } else {
                    var sr_data = this.sr.data;
                    var data_errors = false;
                    sr_data.forEach(function (item) {
                        if (item.all_found === false) {
                            data_errors = true;
                        };
                    }.bind(this));
                    return data_errors;
                };
            } catch (e) {
                return false;
            };
        }
    },
    methods: {
        logState: function (pretty) {
            try {
                var log = JSON.parse(JSON.stringify(this.$store.state));
                var dateObj = new Date();
                const options = {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric'
                };
                var title = "STATE :: " + dateObj.toLocaleDateString('de-DE', options);

                if (pretty === true) {
                    var str = JSON.stringify(log, null, 2);
                    console.log(title, str);
                } else {
                    console.log(title, log);
                };

            } catch (e) {
                console.log('logState', e);
            }
        }
    },
    template: `
        <template>
            <v-app id="top" style="background-color:#f8f8f8!important;">
                <v-content class="mb-12 pb-12">
                    <v-container class="mt-10 pt-8 pl-10 pr-8 elevation-1" style="background-color:white!important;">

                        <v-row>
                            <v-col cols="12" sm="6">
                                <img v-if="clinic_data" :src="clinic_data.clinic_logo" :alt="clinic_data.clinic_slogan"
                                    height="46">
                                <v-skeleton-loader v-if="!clinic_data" height="46px" max-width="240px" type="image">
                                </v-skeleton-loader>
                            </v-col>
                            <v-col cols="12" sm="6">
                                <optinomic-toc></optinomic-toc>
                            </v-col>
                        </v-row>

                        <app-title :title="title" :subtitle="subtitle" class="mt-4"></app-title>

                        <div v-if="loaded">
                            <div v-if="could_have_data">
                                <div v-if="sr.have_data">
                                    <optinomic-content-block title="Missings" subtitle="Datenhinweis" id="data_note"
                                        v-if="missing_data">
                                        <div v-for="r in sr.data">
                                            <div v-if="r.all_found === false">
                                                <v-alert dense outlined text type="error">
                                                    <p style="margin:0;padding:0">Bei der Messung vom <span
                                                            v-html="formatDateCH(r.date)"></span> sind nicht alle Daten
                                                        vorhanden:
                                                    </p>
                                                    <p style="margin:0;padding:0" v-if="r.calculation_found === false">
                                                        - Calculation nicht gefunden / noch nicht berechnet!
                                                    </p>
                                                    <p style="margin:0;padding:0" v-if="r.event_found === false">
                                                        - Event <span v-html="r.event_id"></span> nicht gefunden.
                                                    </p>
                                                    <p style="margin:0;padding:0" v-if="r.patient_found === false">
                                                        - Patient <span v-html="r.patient_id"></span> nicht gefunden.
                                                    </p>
                                                    <p style="margin:0;padding:0" v-if="r.stay_found === false">
                                                        - Fall <span v-html="r.stay_id"></span> nicht gefunden.
                                                    </p>
                                                </v-alert>
                                            </div>
                                        </div>
                                    </optinomic-content-block>
                                    <slot></slot>
                                </div>
                                <div v-else>
                                    <optinomic-content-block subtitle="Hinweis" title="Keine Messdaten" id="in_no_data"
                                        show_in_toc="false">
                                        <v-alert prominent text type="error">
                                            Es sind keine Messdaten vorhanden.
                                        </v-alert>
                                    </optinomic-content-block>
                                </div>
                            </div>
                            <div v-else>
                                <slot></slot>
                            </div>
                        </div>
                        <div v-else lass="mx-3 mt-3">
                            <v-sheet class="px-3 pt-3 pb-3">
                                <v-skeleton-loader class="mx-auto" type="card"></v-skeleton-loader>
                            </v-sheet>
                        </div>
                        <!-- FOOTER -->
                        <div class="mt-12 pt-12 ml-4 mr-6">
                            <v-row style="border-top: 1px solid #8b0042;">
                                <v-col cols="12" sm="6" class="px-0">
                                    <p class="subtitle-1 font-italic font-weight-light text-left" style="color:#8b0042"
                                        v-text="clinic_data.clinic_slogan" v-if="clinic_data"></p>
                                </v-col>
                                <v-col cols="12" sm="6" class="px-0">
                                    <v-btn class="ml-1" style="float:right;" icon x-small color="#8b0042"
                                        @click="$vuetify.goTo('#top')">
                                        <v-icon dark>mdi-arrow-up</v-icon>
                                    </v-btn>
                                    <p class="caption font-weight-light text-right" v-text="user_text"></p>
                                </v-col>
                            </v-row>
                        </div>
                    </v-container>
                    <v-container class="mt-12 mx-auto px-8">
                        <!-- ADMIN - Tools -->
                        <div v-if="isAdmin">
                            <p class="overline ml-4" style="margin-left:1px;color:#8b0042">Admin-Tools</p>
                            <v-simple-table dense>
                                <tbody>
                                    <tr style="background-color:#f8f8f8">
                                        <td>State (check console)</td>
                                        <td>
                                            <v-btn text small @click="logState(true)">
                                                beautify
                                            </v-btn>
                                            <v-btn text small color="#8b0042" @click="logState(false)">
                                                log
                                            </v-btn>
                                        </td>
                                    </tr>
                                </tbody>
                            </v-simple-table>
                        </div>
                    </v-container>
                </v-content>
            </v-app>
        </template>
    `
});

// optinomic-clipboard-text
Vue.component('optinomic-clipboard-text', {
    props: {
        text: {
            type: String,
            default: ""
        }
    },
    data: () => ({
        snackbar: false,
        alert_text: '',
        alert_color: 'error',
        timeout: 2000,
    }),
    methods: {
        copyClipboard() {
            try {
                let textToCopy = document.querySelector('#clipboard-text')
                textToCopy.setAttribute('type', 'text')
                textToCopy.select()

                var successful = document.execCommand('copy');
                if (successful) {
                    this.alert_text = '✓ Erfolgreich in die Zwischenablage kopiert.';
                    this.alert_color = 'success';
                } else {
                    this.alert_text = 'Oops, der Text konnte nicht in die Zwischenablage kopiert werden.';
                };

                /* unselect the range */
                textToCopy.setAttribute('type', 'hidden')
                window.getSelection().removeAllRanges()
            } catch (err) {
                this.alert_text = "Oops, kopieren in die Zwischenablage ist nicht möglich.";
            }
            this.snackbar = true;
        },
    },
    computed: {},
    template: `
        <div>
            <v-tooltip left>
                <template v-slot:activator="{ on }">
                    <span v-on="on" style="float:right;">
                        <v-btn x-small @click="copyClipboard" icon color="indigo">
                            <v-icon>mdi-content-copy</v-icon>
                        </v-btn>
                    </span>
                </template>
                <span class="caption">Kopiere in die Zwischenablage.</span>
            </v-tooltip>

            <p class="text--primary body-1" v-text="text">optinomic-clipboard-text</p>

            <input type="hidden" id="clipboard-text" :value="text">

            <v-snackbar v-model="snackbar" :timeout="timeout" :color="alert_color">
                <span v-text="alert_text"></span>
            </v-snackbar>
        </div>
    `
});

// optinomic-content-block
Vue.component('optinomic-content-block', {
    props: {
        title: {
            type: String,
            default: "Optinomic"
        },
        subtitle: {
            type: String,
            default: ""
        },
        id: {
            type: String,
            default: "id_undefined"
        },
        show_in_toc: {
            type: Boolean,
            default: true
        },
        bold: {
            type: Boolean,
            default: false
        }
    },
    created() {
        // Push to table_of_contents if needed.
        if (this.show_in_toc === true) {
            var toc = this.$store.state.table_of_contents.slice(0);
            var toc_entry = {
                title: this.title,
                subtitle: this.subtitle,
                id: this.id
            };
            var have_to_push = true;
            toc.forEach(function (item) {
                if (item.id === this.id) {
                    have_to_push = false;
                };
            }.bind(this));

            if (have_to_push) {
                toc.push(toc_entry);

                this.$store.commit({
                    type: 'saveData',
                    root: 'table_of_contents',
                    data: toc
                });
            };
        };
    },
    template: `
        <div class="mb-6 pt-8" :id="id">
            <v-divider class="mb-6 pt-8 mt-12" v-if="bold"></v-divider>
            
            <div class="d-flex flex-row justify-space-between align-end">
                <div v-if="bold">
                    <h2 class="display-1 font-weight-medium" v-html="title" style="margin-top:-16px"></h2>
                    <p class="overline" style="margin-left:1px;color:#8b0042" v-html="subtitle"></p>
                </div>
                <div v-else>
                    <p class="overline" style="margin-left:1px;color:#8b0042" v-html="subtitle"></p>
                    <h2 class="headline font-weight-light text--secondary" v-html="title" style="margin-top:-16px"></h2>
                </div>
                <div>
                    <v-btn icon x-small color="#8b0042" @click="$vuetify.goTo('#top')">
                        <v-icon dark>mdi-arrow-up</v-icon>
                    </v-btn>
                </div>
            </div>
            <v-divider v-if="!bold"></v-divider>
            <div class="mt-6 mb-4">
                <slot></slot>
            </div>
        </div>
    `
});

// optinomic-data-table
Vue.component('optinomic-data-table', {
    props: {
        rows: {
            type: Array,
            default: []
        },
        interpretations: {
            type: Object,
            default: {}
        },
        sr: {
            type: Array,
            default: []
        }
    },
    data() {
        return {
            headers: [{
                    text: 'Variable',
                    value: 'variable',
                    width: 20
                },
                {
                    text: 'Frage | Item',
                    align: 'start',
                    value: 'name',
                }
            ]
        }
    },
    methods: {
        flattenObject: function (ob) {
            var toReturn = {};
            try {
                for (var i in ob) {
                    if (!ob.hasOwnProperty(i)) continue;

                    if ((typeof ob[i]) == 'object' && ob[i] !== null) {
                        var flatObject = this.flattenObject(ob[i]);
                        for (var x in flatObject) {
                            if (!flatObject.hasOwnProperty(x)) continue;
                            toReturn[i + '.' + x] = flatObject[x];
                        }
                    } else {
                        toReturn[i] = ob[i];
                    }
                }
            } catch (e) {
                console.log('flattenObject', e);
            }
            return toReturn;
        }
    },
    computed: {
        rows_extended() {
            try {
                var new_rows = this.rows.slice();
                var sr = this.sr;
                var sr_pushed = -99;

                if ((new_rows.length > 0) && (sr.length > 0)) {
                    sr.forEach(function (item, item_index) {
                        new_rows.forEach(function (row, row_index) {

                            var r_flat = this.flattenObject(item);
                            var computed_variablename = r_flat.event_id + '__measurment';
                            var new_header = {
                                text: formatDateCH(r_flat.date),
                                value: computed_variablename
                            };
                            if (sr_pushed !== item_index) {
                                this.headers.push(new_header);
                                sr_pushed = item_index;
                            };

                            if ((r_flat[row.path] === "") || (r_flat[row.path] === undefined) || (r_flat[row.path] === null)) {
                                // Missings
                                row[computed_variablename] = "-"
                            } else {
                                // Interpretation
                                try {
                                    if (row.interpretation !== null) {
                                        if (row.interpretation === 'date') {
                                            var dateObj = new Date(r_flat[row.path]);
                                            const options = {
                                                year: 'numeric',
                                                month: 'numeric',
                                                day: 'numeric'
                                            };
                                            row[computed_variablename] = dateObj.toLocaleDateString('de-DE', options);
                                        } else {
                                            var current_interpretation = this.interpretations[row.interpretation].slice();

                                            var value = r_flat[row.path];
                                            current_interpretation.forEach(function (i) {
                                                if ((i.value + '') === (value + '')) {
                                                    value = i.value + ', ' + i.text;
                                                };
                                            }.bind(this));
                                            row[computed_variablename] = value;
                                        };
                                    };
                                } catch (e) {
                                    row[computed_variablename] = r_flat[row.path];
                                };
                            };

                        }.bind(this));
                    }.bind(this));
                };
                return new_rows;
            } catch (e) {
                return this.rows;
            }
        }
    },
    template: `
        <div>
            <v-data-table
              :headers="headers"
              :items="rows_extended"
              :items-per-page="rows.length"
              hide-default-footer
              dense
            >
                <template v-slot:item.variable="{ item }">
                <kbd v-text="item.variable">v</kbd>

                </template>
            </v-data-table>
            </optinomic-content-block>
        </div>
    `
});

// optinomic-pdfmake
Vue.component('optinomic-pdfmake', {
    props: {
        headerLeft: {
            type: String,
            default: ""
        },
        headerRight: {
            type: String,
            default: ""
        },
        footerLeft: {
            type: String,
            default: ""
        },
        documentTitle: {
            type: String
        },
        content: {
            type: Array,
            default: null
        },
        pageSize: {
            type: String,
            default: 'A4'
        },
        pageOrientation: {
            type: String,
            default: 'portrait'
        },
        hideLogo: {
            type: Boolean,
            default: false
        },
        hidePageNumbers: {
            type: Boolean,
            default: false
        }
    },
    data: function () {
        return {
            loadingString: "..."
        }
    },
    mounted() {},
    computed: {
        doc_title() {
            // return data
            try {
                var doc_name = "";

                var d = new Date();
                var y = d.getFullYear();
                var m = d.getMonth() + 1;
                var t = d.getUTCDate();

                if (m < 10) {
                    m = "0" + m;
                };

                if (t < 10) {
                    t = "0" + t;
                };

                datum_str = y + "_" + m + "_" + t;


                // Demo Muster (21.5.1973 | 46) => Hr_DeM_1973
                var pat_string = "";
                if (this.$store.state.patient.data.gender === "male") {
                    pat_string = "Hr_";
                } else {
                    pat_string = "Fr_";
                };
                pat_string = pat_string + this.$store.state.patient.data.last_name.substring(0, 2);
                pat_string = pat_string + this.$store.state.patient.data.first_name.substring(0, 1);
                pat_string = pat_string + "_";
                pat_string = pat_string + this.$store.state.patient.data.birthdate.substring(0, 4);

                doc_name = doc_name + datum_str + " - " + this.documentTitle + " - " + pat_string;
                doc_name = doc_name + ".pdf";

                return doc_name;
            } catch (e) {
                return "";
            };
        },
        pdf_ready() {
            // return data
            try {
                if ((this.doc_title !== "") && (this.content.length > 0)) {
                    return true;
                } else {
                    return false;
                };
            } catch (e) {
                return false;
            };
        }
    },
    methods: {
        __open_pdf: function () {
            var dd = makepdf._create_document(this.documentTitle, this.headerLeft, this.headerRight, this.footerLeft, this.pageSize, this.pageOrientation, this.hideLogo, this.hidePageNumbers);
            dd.content = this.content.slice();
            dd = makepdf._addFooter(dd, this.footerLeft, this.hidePageNumbers);

            console.log('PDF | open :: ' + this.doc_title, dd);
            this.pdf_request_possible = false;
            pdfMake.createPdf(dd).open();
        },
        __download_pdf: function () {
            var dd = makepdf._create_document(this.documentTitle, this.headerLeft, this.headerRight, this.footerLeft, this.pageSize, this.pageOrientation, this.hideLogo, this.hidePageNumbers);
            dd.content = this.content.slice();
            dd = makepdf._addFooter(dd, this.footerLeft, this.hidePageNumbers);

            console.log('PDF | download :: ' + this.doc_title, dd);
            this.pdf_request_possible = false;
            pdfMake.createPdf(dd).download(this.doc_title);
        }
    },
    template: `
        <div v-if="pdf_ready" class="d-flex flex-row justify-space-between align-center pt-2 mb-1">
            <div class="mb-3 mr-2">
                <v-icon color="#8b0042">mdi-file-pdf</v-icon>
            </div>
            <p v-text="doc_title" class="mr-auto mt-2"></p>
            
            <div style="margin-top:-8px">
                <v-tooltip left>
                    <template v-slot:activator="{ on }">
                        <span v-on="on">
                            <v-btn v-on:click="__download_pdf" icon color="grey">
                                <v-icon>mdi-content-save</v-icon>
                            </v-btn>
                        </span>
                    </template>
                    <span>Herunterladen</span>
                </v-tooltip>
                <v-btn outlined small rounded color="#8b0042" v-on:click="__open_pdf">
                    Öffnen
                </v-btn>
            </div>
        </div>
    `
});

// Optinomic App-title
Vue.component('app-title', {
    props: {
        title: {
            type: String,
            default: "Optinomic"
        },
        subtitle: {
            type: String,
            default: "App"
        }
    },
    computed: {
        readme_html() {
            try {
                return this.$store.state.current_app.module.readme.html;
            } catch (e) {
                return null;
            };
        },
        app_description() {
            try {
                return this.$store.state.current_app.module.description;
            } catch (e) {
                return null;
            };
        },
        app_data() {
            try {
                return this.$store.state.current_app;
            } catch (e) {
                return null;
            };
        },
        clinic_data() {
            // get survey_response
            try {
                return this.$store.state.clinic.data;
            } catch (e) {
                return false;
            };
        },
        patient_text() {
            try {
                return this.$store.state.patient.data.extras.full_name;
            } catch (e) {
                return null;
            };
        }
    },
    template: `
        <div>
            <h1 v-text="title" class="display-1 font-weight-medium"></h1>
            <p style="margin-left:1px;color:#8b0042">
                <span v-text="subtitle"></span>
                <span v-if="patient_text" class="mx-1" style="color:#616161">|</span>
                <span v-if="patient_text" v-text="patient_text"></span>
            </p>

            <optinomic-content-block title="Dokumentation" subtitle="Readme" id="id_readme">
                <v-expansion-panels flat light tile v-if="readme_html === null">
                    <v-expansion-panel disabled>
                        <v-expansion-panel-header style="padding:0">
                            <v-skeleton-loader class="" min-width="200" max-width="550" type="heading"></v-skeleton-loader>
                        </v-expansion-panel-header>
                    </v-expansion-panel>
                </v-expansion-panels>

                <v-expansion-panels flat light tile v-if="readme_html !== null">
                    <v-expansion-panel>
                        <v-expansion-panel-header style="margin:0; padding:0;">
                            <p class="text--primary body-1 mx-auto">
                                <span v-text="app_description"></span>
                                <span class="overline mx-2" style="color:#8b0042">[ </span>
                                <span class="overline">Mehr</span>
                                <span class="overline mx-2" style="color:#8b0042">]</span>
                            </p>
                        </v-expansion-panel-header>
                        <v-expansion-panel-content class="mx-0 px-0" style="margin:0; padding:0;">
                            <!-- Readme -->
                            <div style="border-bottom: 1px solid #8b0042">&nbsp;</div>
                            <p class="overline mt-1 pb-1" style="margin-left:1px;color:#8b0042">README</p>
                            <div class="mt-2" v-html="readme_html"></div>
                            <!-- Info-Table -->
                            <div class="mt-6" style="border-bottom: 1px solid #8b0042">&nbsp;</div>
                            <p class="overline mt-1 pb-1" style="margin-left:1px;color:#8b0042">Applikation - Info</p>
                            <v-simple-table>
                                <template v-slot:default>
                                    <tbody>
                                        <tr>
                                            <td>App (updated @ <span v-text="formatDateCH(app_data.module_activation.data.last_update)"></span>)</td>
                                            <td>
                                                <a :href="'https://github.com/Optinomic/' + app_data.module.identifier" target="_blank" v-text="app_data.module.identifier"></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Licensed</td>
                                            <td>
                                                <a :href="clinic_data.clinic_www" target="_blank" v-text="clinic_data.clinic_name + ', ' + clinic_data.clinic_address"></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Support</td>
                                            <td>
                                                <a :href="'mailto:'+ clinic_data.admin_email" v-text="clinic_data.admin_name"></a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </template>
                            </v-simple-table>
                            <v-divider></v-divider>
                        </v-expansion-panel-content>
                    </v-expansion-panel>
                </v-expansion-panels>
            </optinomic-content-block>
        </div>
    `
});

// Optinomic optinomic-toc
Vue.component('optinomic-toc', {
    props: {},
    computed: {
        toc_data() {
            // return data
            try {
                //console.log('TOC', this.$store.state.table_of_contents);
                return this.$store.state.table_of_contents;
            } catch (e) {
                return [];
            };
        }
    },
    template: `
        <div class="d-flex flex-row justify-start">
            <div class="mb-12 mt-2">
                <div class="ml-5 mb-2">
                    <p class="overline" style="color:#8b0042">Table of Contents</p>
                    <h2 class="headline font-weight-light text--secondary" style="margin-top:-22px">Inhaltsverzeichnis</h2>
                </div>
                <p class="d-flex flex-row align-top" v-for="item in toc_data" :key="item.id" style="margin:0">
                    <span class="body-1 font-weight-black" style="color:#8b0042">-</span>
                    <a style="color:#212121" class="ml-3" @click="$vuetify.goTo('#'+item.id)">
                        <v-tooltip left>
                            <template v-slot:activator="{ on }">
                                <span v-on="on" class="body-1 font-weight-light" v-text="item.title"></span>
                            </template>
                            <span class="caption mx-1" v-text="item.subtitle"></span>
                        </v-tooltip>
                    </a>
                </p>
            </div>
        
        </div>
    `
});

// General Plugins
// Plugin: optinomic_globals
const optinomic_globals = {
    install(Vue, options) {
        Vue.mixin({
            methods: {
                getDateCH: function (date, full) {
                    var dateObj = new Date(date);
                    var o = {};
                    if (full === true) {
                        o = {
                            "weekday": "long",
                            "year": "numeric",
                            "month": "long",
                            "day": "numeric"
                        };
                    } else {
                        o = {
                            "year": "numeric",
                            "month": "numeric",
                            "day": "numeric"
                        };
                    };
                    return dateObj.toLocaleDateString('de-DE', o);
                },
                get_app_data(identifier) {
                    try {
                        return this.$store.state.data_apps.data_object[identifier];
                    } catch (err) {
                        console.error('get_app_data', err);
                        return null;
                    }
                },
                get_pdf_chart_options(options) {
                    try {
                        var copy = Object.assign({}, options);
                        copy.item_height = copy.item_height - 12;
                        return copy;
                    } catch (err) {
                        console.error('get_pdf_chart_options', err);
                        return options;
                    }
                }
            },
            computed: {
                sr() {
                    try {
                        return this.$store.state.data_apps.data_object[this.identifier];
                    } catch (e) {
                        return null;
                    };
                },
                sr_data() {
                    try {
                        return this.sr.data;
                    } catch (e) {
                        return [];
                    };
                },
                missings() {
                    try {
                        var d = this.$store.state.data_apps.data_object[this.identifier];
                        if (d === null) {
                            return false;
                        } else {
                            var sr = d.data;
                            var data_errors = false;
                            sr.forEach(function (item) {
                                if (item.all_found === false) {
                                    data_errors = true;
                                };
                            }.bind(this));
                            return data_errors;
                        };
                    } catch (e) {
                        return false;
                    };
                },
                current_module() {
                    try {
                        return this.$store.state.current_app.module;
                    } catch (e) {
                        return null;
                    };
                },
                patient_modules() {
                    try {
                        return this.$store.state.apps.data.patient_modules;
                    } catch (e) {
                        return null;
                    };
                },
                user_modules() {
                    try {
                        return this.$store.state.apps.data.user_modules;
                    } catch (e) {
                        return null;
                    };
                },
                patient_data() {
                    try {
                        return this.$store.state.patient.data;
                    } catch (e) {
                        return null;
                    };
                }
            }
        });
    }
};
Vue.use(optinomic_globals);

// Plugin: optinomic_pdf_globals
const optinomic_pdf_globals = {
    install(Vue, options) {
        Vue.mixin({
            methods: {
                pdf_app_title: function (title, subtitle, description) {
                    var titel = [];
                    titel.push(makepdf._horizontalLine(100, "#E0E0E0"));
                    titel.push(makepdf._heading(title, subtitle, 'h1'));
                    if ((description !== null) && (description !== "")) {
                        titel.push(makepdf._text(description));
                    }
                    return makepdf._keepTogether(titel, title + '_titel');
                },
                pdf_no_data: function (title) {
                    // No Data
                    var pdf = [];
                    pdf.push(makepdf._noData(title + ': ', 'Keine Daten vorhanden.'));
                    return makepdf._keepTogether(pdf, title + '_no_data');
                },
                pdf_error: function (title) {
                    // No Data
                    var pdf = [];
                    pdf.push(makepdf._noData(title + ': ', 'Unerwarteter Fehler.'));
                    return makepdf._keepTogether(pdf, title + '_pdf_error');
                },
                pdf_app_info: function (m, big) {
                    // No Data
                    var pdf = [];
                    // pdf.push(makepdf._suedhang_logo_anschrift());

                    if (big === true) {
                        pdf.push(makepdf._title(m.name, m.short_description));
                        pdf.push(makepdf._text(m.description));
                        return makepdf._keepTogether(pdf, m.name + '_appinfo_big');
                    } else {
                        pdf.push(this.pdf_app_title(m.name, m.short_description, m.description));
                        return makepdf._keepTogether(pdf, m.name + '_appinfo');
                    };
                },
                get_pdf_chart_options(options) {
                    try {
                        var copy = Object.assign({}, options);
                        copy.item_height = copy.item_height - 12;
                        return copy;
                    } catch (err) {
                        console.error('get_pdf_chart_options', err);
                        return options;
                    }
                }
            }
        });
    }
};
Vue.use(optinomic_pdf_globals);

// App Init
// Init Vue
new Vue({
    el: '#optinomic_app',
    vuetify: new Vuetify(),
    store: new Vuex.Store({
        state: {
            apps: {},
            table_of_contents: [],
            current_app: null,
            user: null,
            patient: null,
            stays: null,
            clinic: null,
            data_apps: {
                count: 0,
                init_array: [],
                loaded_array: [],
                data_object: {}
            }
        },
        getters: {
            isAdmin: state => {
                try {
                    return state.user.data.isAdmin;
                } catch (err) {
                    return false;
                };
            }
        },
        mutations: {
            saveData(state, d) {
                try {
                    state[d.root] = d.data;
                    // console.warn('state :: ', new Date(), state);
                } catch (err) {
                    console.error('Error: saveData', err);
                };
            },
            saveAppData(state, pl) {
                var d = Object.assign({}, pl);
                var da = Object.assign({}, state.data_apps);
                try {
                    if (d.data.loaded !== true) {
                        da.init_array.push(d.root);
                    } else {
                        da.data_object[d.root] = Object.assign({}, d.data);
                        da.loaded_array.push(d.root);
                        da.count = da.count + 1;
                    };

                    // https://vuex.vuejs.org/guide/mutations.html#mutations-follow-vue-s-reactivity-rules
                    // Vue.set(da, state.data_apps);
                    // state.data_apps = { ...state.data_apps, da };
                    state.data_apps = Object.assign({}, da);

                    // console.warn('state :: ', new Date(), state);
                } catch (err) {
                    console.error('Error: saveAppData', err);
                };
            }
        },
        actions: {
            getSurveyResponses({
                commit
            }, params) {

                if (params === undefined) {
                    params = {};
                };

                var is_defined = function (val) {
                    if ((val === undefined) || (val === null)) {
                        return false;
                    } else {
                        return true;
                    }
                };

                var module_identifier = helpers.getAppID();
                var current_pid = parseInt(helpers.getPatientID());
                var current_stay_id = parseInt(helpers.getStayID());;
                var store_root = module_identifier;

                try {
                    if (is_defined(params.identifier)) {
                        module_identifier = params.identifier;
                        store_root = module_identifier;
                    }

                    if (is_defined(params.pid)) {
                        current_pid = params.pid;
                    }

                    if (is_defined(params.sid)) {
                        current_stay_id = params.sid;
                    }

                    if (is_defined(params.root)) {
                        store_root = params.root;
                    }
                } catch (err) {
                    console.error('getSurveyResponses - Params', err);
                };


                var base_data = {
                    "date": new Date(),
                    "data": null,
                    "calculations_all": null,
                    "loaded": false,
                    "have_data": false,
                    "possible_data": true,
                    "request": null,
                    "pid": current_pid,
                    "fid": current_stay_id,
                    "app_id": module_identifier,
                    "params": params
                };

                console.log('(?) getSurveyResponses', module_identifier, current_pid, current_stay_id, store_root);


                var savetype = 'saveData';
                if (store_root !== 'sr') {
                    savetype = 'saveAppData';
                };

                commit({
                    type: savetype,
                    root: store_root,
                    data: base_data
                });

                var calculation_results_api_url = '/patients/' + current_pid + '/calculations/' + module_identifier;
                if (current_stay_id) {
                    var api_url = '/stays/' + current_stay_id + '/survey_responses/' + module_identifier + '/full';
                    data_request = 'stay';
                } else {
                    var api_url = '/patients/' + current_pid + '/survey_responses/' + module_identifier + '/full';
                    data_request = 'patient';
                };


                // Do async task
                helpers.callAPI('GET', api_url, {}, {}, function (req) {

                    // var app_id = helpers.getAppID();
                    var app_id = base_data.app_id;

                    if (req.status == 200) {
                        var resp = JSON.parse(req.response);


                        helpers.callAPI('GET', calculation_results_api_url, {}, {}, function (inner_req) {

                            if (req.status == 200) {
                                var inner_resp = JSON.parse(inner_req.response);
                                var calculation_results = inner_resp.calculation_results;

                                // console.log('actionGetSurveyResponsesNew:: resp', resp, inner_resp);


                                // Reformat req
                                var return_array = [];
                                resp.survey_responses.forEach(function (current_response, srID) {
                                    var return_obj = {};

                                    return_obj.all_found = false;

                                    return_obj.app_id = null;
                                    return_obj.date = current_response.data.filled;

                                    return_obj.response_id = current_response.id;
                                    return_obj.response = current_response.data.response;

                                    return_obj.event = null;
                                    return_obj.event_found = false;
                                    return_obj.event_id = current_response.data.event_id;

                                    return_obj.patient = null;
                                    return_obj.patient_found = false;
                                    return_obj.patient_id = null;

                                    return_obj.stay = null;
                                    return_obj.stay_found = false;
                                    return_obj.stay_id = null;

                                    return_obj.patient_uses_module = null;
                                    return_obj.patient_uses_module_found = false;
                                    return_obj.patient_uses_module_id = null;

                                    return_obj.calculation = {};
                                    return_obj.calculation_found = false;
                                    return_obj.calculation_found_method = null;


                                    resp.events.forEach(function (current_event, eventID) {
                                        if (current_event.id === current_response.data.event_id) {
                                            return_obj.event_found = true;

                                            current_event.data.id = current_event.id;
                                            return_obj.event = current_event.data;
                                            return_obj.event.extras = createEventExtras(current_event.data);
                                            return_obj.patient_uses_module_id = current_event.data.patient_uses_module_id;
                                            return_obj.patient_id = current_event.data.patient_id;
                                            return_obj.app_id = current_event.data.module;
                                            app_id = return_obj.app_id;
                                        };
                                    });

                                    if (return_obj.event_found) {
                                        resp.patients.forEach(function (current_patient, patientID) {
                                            if (current_patient.id === return_obj.patient_id) {
                                                return_obj.patient_found = true;
                                                current_patient.data.id = current_patient.id;
                                                current_patient.data.pid = current_patient.id;
                                                var current_patient_data = createPatientExtras(current_patient.data);
                                                return_obj.patient = current_patient_data;
                                            };
                                        });

                                        resp.patient_uses_modules.forEach(function (current_pum, pumID) {
                                            if (current_pum.id === return_obj.patient_uses_module_id) {
                                                return_obj.patient_uses_module_found = true;
                                                current_pum.data.id = current_pum.id;
                                                return_obj.patient_uses_module = current_pum.data;
                                                return_obj.stay_id = current_pum.data.stay_id;
                                            };
                                        });
                                    };

                                    if (return_obj.stay_id) {
                                        resp.stays.forEach(function (current_stay, stayID) {
                                            if (current_stay.id === return_obj.stay_id) {
                                                return_obj.stay_found = true;

                                                current_stay.data.id = current_stay.id;
                                                current_stay.data.fid = current_stay.id;
                                                var current_stay_data = createStayExtras(current_stay.data);
                                                return_obj.stay = current_stay_data;
                                            };
                                        });
                                    };

                                    // console.error('-> resp.calculations', resp.calculations);
                                    calculation_results.forEach(function (current_calculation_top, calculationID) {
                                        var calculation_name = current_calculation_top.name;


                                        if (current_calculation_top.result.length > 0) {
                                            current_calculation_top.result.forEach(function (current_calculation, calculationID) {
                                                var variant_info = false;
                                                if ("info" in current_calculation) {
                                                    if ("response" in current_calculation.info) {
                                                        variant_info = true;
                                                    };
                                                };

                                                var variant_response = false;
                                                if ("response" in current_calculation) {
                                                    if ("data" in current_calculation.response) {
                                                        if ("response" in current_calculation.response.data) {
                                                            variant_response = true;
                                                        };
                                                    };
                                                };

                                                if (variant_info) {
                                                    var calc_resp = current_calculation.info.response;

                                                    if (JSON.stringify(calc_resp) === JSON.stringify(return_obj.response)) {
                                                        // console.log('(+) EQUAL: ', calc_resp);

                                                        return_obj.calculation_found = true;
                                                        return_obj.calculation_found_method = "variant_info";
                                                        return_obj.calculation[calculation_name] = current_calculation;
                                                    };
                                                };

                                                if (variant_response) {
                                                    var calc_resp = current_calculation.response.data.response;

                                                    if (JSON.stringify(calc_resp) === JSON.stringify(return_obj.response)) {
                                                        // console.log('(+) EQUAL: ', calc_resp);

                                                        return_obj.calculation_found = true;
                                                        return_obj.calculation_found_method = "variant_response";
                                                        return_obj.calculation[calculation_name] = current_calculation;

                                                    } else {

                                                        if ("TMTAError" in calc_resp) {
                                                            // TMT - Special
                                                            // console.error('DEBUG HERE ::', calc_resp, return_obj.response, current_calculation);

                                                            if ((parseInt(calc_resp.TMTAError) === parseInt(return_obj.response.TMTAError)) &&
                                                                (parseInt(calc_resp.TMTATime) === parseInt(return_obj.response.TMTATime)) &&
                                                                (parseInt(calc_resp.TMTBError) === parseInt(return_obj.response.TMTBError)) &&
                                                                (parseInt(calc_resp.TMTBTime) === parseInt(return_obj.response.TMTBTime)) &&
                                                                (parseInt(calc_resp.Ausbildungsjahre) === parseInt(return_obj.response.Ausbildungsjahre)) &&
                                                                (parseInt(calc_resp.Messzeitpunkt) === parseInt(return_obj.response.Messzeitpunkt))
                                                            ) {

                                                                return_obj.calculation_found = true;
                                                                return_obj.calculation_found_method = "variant_response_tmt";
                                                                return_obj.calculation[calculation_name] = current_calculation;
                                                            };

                                                        };

                                                    };
                                                };
                                            });
                                        };
                                    });


                                    if (return_obj.calculation_found && return_obj.event_found && return_obj.patient_found && return_obj.stay_found && return_obj.patient_uses_module_found) {
                                        return_obj.all_found = true;
                                    };

                                    return_array.push(return_obj);
                                });


                                if (return_array.length > 0) {
                                    var have_data = true;

                                    // Sort
                                    return_array.sort(function (a, b) {
                                        var nameA = a.date.toUpperCase(); // ignore upper and lowercase
                                        var nameB = b.date.toUpperCase(); // ignore upper and lowercase
                                        if (nameA < nameB) {
                                            return -1;
                                        }
                                        if (nameA > nameB) {
                                            return 1;
                                        }
                                        return 0;
                                    });
                                } else {
                                    var have_data = false;
                                };

                                var response = {
                                    "date": new Date(),
                                    "data": return_array,
                                    "calculations_all": calculation_results,
                                    "have_data": have_data,
                                    "loaded": true,
                                    "possible_data": true,
                                    "request": data_request,
                                    "pid": current_pid,
                                    "fid": current_stay_id,
                                    "app_id": app_id,
                                    "params": params
                                };
                                console.log('(✔) Data (' + api_url + '):', response);


                                commit({
                                    type: savetype,
                                    root: store_root,
                                    data: response
                                });


                            } else {
                                var response = {
                                    "error": true,
                                    "error_message": "Failed with status code: " + req.status,
                                    "status_code": req.status,
                                    "request": data_request,
                                    "app_id": app_id
                                };
                                console.error('(!) Error: ', response);
                            };
                        });

                    } else {
                        var response = {
                            "error": true,
                            "error_message": "Failed with status code: " + req.status,
                            "status_code": req.status,
                            "request": data_request,
                            "app_id": app_id
                        };
                        console.error('(!) Error: ', response);
                    };

                });


            },
            getApps({
                commit
            }) {

                var api_url = 'module_activations';
                var parameters = {}

                // Do async task
                helpers.callAPI('GET', api_url, parameters, {}, function (req) {
                    if (req.status == 200) {

                        var resp = JSON.parse(req.response);
                        var hotloaded = [];

                        // Sortieren nach App-Name
                        if ("patient_modules" in resp) {
                            if (resp.patient_modules.length > 0) {
                                resp.patient_modules.sort(function (a, b) {
                                    var nameA = a.module.name.toUpperCase(); // ignore upper and lowercase
                                    var nameB = b.module.name.toUpperCase(); // ignore upper and lowercase
                                    if (nameA < nameB) {
                                        return -1;
                                    }
                                    if (nameA > nameB) {
                                        return 1;
                                    }
                                    return 0;
                                });

                                resp.patient_modules.forEach(function (m, mID) {
                                    m.first_template = {
                                        "found": "false",
                                        "name": null
                                    };

                                    // Safty - not breakting thins
                                    m.identifier = m.module.identifier;

                                    if (m.module.templates.length > 0) {
                                        m.first_template.name = m.module.templates["0"].name;
                                        m.first_template.found = true;
                                    };

                                    if (m.module_activation.data.overwritten) {
                                        hotloaded.push(m);
                                    };

                                    if (m.identifier === helpers.getAppID()) {
                                        commit({
                                            type: 'saveData',
                                            root: 'current_app',
                                            data: m
                                        });
                                    };

                                });

                            };
                        };
                        if ("user_modules" in resp) {

                            if (resp.user_modules.length > 0) {
                                resp.user_modules.sort(function (a, b) {
                                    var nameA = a.module.name.toUpperCase(); // ignore upper and lowercase
                                    var nameB = b.module.name.toUpperCase(); // ignore upper and lowercase
                                    if (nameA < nameB) {
                                        return -1;
                                    }
                                    if (nameA > nameB) {
                                        return 1;
                                    }
                                    return 0;
                                });

                                resp.user_modules.forEach(function (m, mID) {
                                    m.first_template = {
                                        "found": "false",
                                        "name": null
                                    };

                                    // Safty - not breakting thins
                                    m.identifier = m.module.identifier;

                                    if (m.module.templates.length > 0) {
                                        m.first_template.name = m.module.templates["0"].name;
                                        m.first_template.found = true;
                                    };

                                    if (m.module_activation.data.overwritten) {
                                        hotloaded.push(m);
                                    };

                                    if (m.identifier === helpers.getAppID()) {
                                        commit({
                                            type: 'saveData',
                                            root: 'current_app',
                                            data: m
                                        });
                                    };

                                });
                            };
                        };

                        var response = {
                            "data": {
                                "patient_modules": resp.patient_modules,
                                "user_modules": resp.user_modules,
                                "errors": resp.errors,
                                "hotloaded": hotloaded
                            }
                        };

                        response = addOptinomicExtras(response, api_url);


                        commit({
                            type: 'saveData',
                            root: 'apps',
                            data: response
                        });


                        console.log('(✔) Data (' + api_url + '):', response, parameters);
                    } else {
                        // Errorhandling
                        // While what action with what params error happend
                        var error_action = {
                            "name": "getApps",
                            "params": []
                        };

                        dispatch({
                            "type": "ERROR",
                            "error": handleError(req, error_action)
                        });
                    };

                });

            },
            getUser({
                commit
            }) {

                const api_url = '/users/' + helpers.getUserID();
                var parameters = {}

                // Do async task
                helpers.callAPI('GET', api_url, parameters, {}, function (req) {
                    if (req.status == 200) {

                        var resp = JSON.parse(req.response);
                        var data_return = resp.user.data;
                        data_return.id = resp.user.id;
                        data_return.uid = resp.user.id;
                        data_return.isAdmin = false;
                        if (resp.user.data.role === "Admin") {
                            data_return.isAdmin = true;
                        };

                        var response = {
                            "id": resp.user.id,
                            "date": new Date(),
                            "data": data_return
                        };
                        console.log('(✔) Data (' + api_url + '):', response);

                        commit({
                            type: 'saveData',
                            root: 'user',
                            data: response
                        });

                    } else {
                        var response = {
                            "error": true,
                            "api_url": api_url,
                            "error_message": "Failed with status code: " + req.status,
                            "status_code": req.status,
                            "req": req
                        };
                        console.error('(!) Error: ', response);
                    };

                });

            },
            getPatient({
                commit
            }) {

                const api_url = '/patients/' + helpers.getPatientID();
                var parameters = {}

                // Do async task
                helpers.callAPI('GET', api_url, parameters, {}, function (req) {
                    if (req.status == 200) {

                        var resp = JSON.parse(req.response);
                        var data_return = resp.patient.data;
                        data_return.id = resp.patient.id;
                        data_return.pid = resp.patient.id;
                        data_return.extras = createPatientExtras(data_return);

                        var response = {
                            "date": new Date(),
                            "data": data_return
                        };
                        console.log('(✔) Data (' + api_url + '):', response);

                        commit({
                            type: 'saveData',
                            root: 'patient',
                            data: response
                        });

                    } else {
                        var response = {
                            "error": true,
                            "api_url": api_url,
                            "error_message": "Failed with status code: " + req.status,
                            "status_code": req.status,
                            "req": req
                        };
                        console.error('(!) Error: ', response);
                    };

                });

            },
            getPatientStays({
                commit
            }) {

                const api_url = '/patients/' + helpers.getPatientID() + '/stays/';
                var parameters = {}

                // Do async task
                helpers.callAPI('GET', api_url, parameters, {}, function (req) {
                    if (req.status == 200) {

                        var resp = JSON.parse(req.response);
                        var stays = resp.stays;

                        var current_stay_id = parseInt(helpers.getStayID());

                        var stay_response = {
                            "all": stays,
                            "current": {
                                "id": current_stay_id,
                                "data": null,
                                "found": false
                            }
                        }

                        stays.forEach(function (stay, stayID) {
                            stay.data = createStayExtras(stay.data);
                            stay.data.id = stay.id;
                            stay.data.fid = stay.id;
                            if (current_stay_id === stay.id) {
                                stay_response.current.data = stay.data;
                                stay_response.current.found = true;
                            };
                        });

                        console.log('(✔) Data (' + api_url + '):', stay_response);

                        commit({
                            type: 'saveData',
                            root: 'stays',
                            data: stay_response
                        });

                    } else {
                        var response = {
                            "error": true,
                            "api_url": api_url,
                            "error_message": "Failed with status code: " + req.status,
                            "status_code": req.status,
                            "req": req
                        };
                        console.error('(!) Error: ', response);
                    };

                });

            },
            getClinic({
                commit
            }) {

                const api_url = '/clinic';
                var parameters = {}

                // Do async task
                helpers.callAPI('GET', api_url, parameters, {}, function (req) {
                    if (req.status == 200) {

                        var resp = JSON.parse(req.response);

                        // All fields are coming as array: Make Object out of it:
                        var json_data = {};
                        resp.clinic.forEach(function (item, itemIndex) {
                            json_data[item[0]] = item[1];
                        });

                        var response = {
                            "date": new Date(),
                            "data": json_data
                        };
                        response.data.array = resp.clinic;
                        console.log('(✔) Data (' + api_url + '):', response);

                        commit({
                            type: 'saveData',
                            root: 'clinic',
                            data: response
                        });

                    } else {
                        var response = {
                            "error": true,
                            "api_url": api_url,
                            "error_message": "Failed with status code: " + req.status,
                            "status_code": req.status,
                            "req": req
                        };
                        console.error('(!) Error: ', response);
                    };

                });

            }
        }
    }),
    methods: {}
});


// ----------------------------------------
// Helpers
// ----------------------------------------
function setValue(obj,access,value){if("string"==typeof access&&(access=access.split(".")),access.length>1){var init=obj[access[0]]||{};setValue(obj[access.shift()]=init,access,value)}else obj[access[0]]=value}addOptinomicExtras=function(obj,api_url){return api_url=api_url||null,obj.api_timestamp=(new Date).toISOString(),obj.api_url=api_url,obj},handleError=function(req,error_action){var error={error:!0,error_message:"Failed with status code: "+req.status,status:req.status,statusText:req.statusText,responseURL:req.responseURL,readyState:req.readyState,error_action:error_action};try{var responseText=JSON.parse(req.responseText);"error"in responseText&&(error.responseErrorText=responseText.error)}catch(err){error.responseErrorText=null}return 0!==req.status&&console.error("(!) "+req.status+" ("+req.statusText+")",error),error},debounce=function(fn,wait){var timeout=null,c=function(){clearTimeout(timeout),timeout=null},t=function(fn){timeout=setTimeout(fn,wait)};return function(){var context=this,args=arguments,f=function(){fn.apply(context,args)};timeout?c()||t(f):t(c)||f()}},formatDateCH=function(date_string){if(null!==(date_string=date_string||null)){var year=parseInt(date_string.substring(0,4)),month=parseInt(date_string.substring(5,7));return parseInt(date_string.substring(8,10))+"."+month+"."+year}return null},createPatientExtras=function(patient){var dateString,today,birthDate,age,m;patient.extras={},patient.extras.age=(dateString=patient.birthdate,today=new Date,birthDate=new Date(dateString),age=today.getFullYear()-birthDate.getFullYear(),((m=today.getMonth()-birthDate.getMonth())<0||0===m&&today.getDate()<birthDate.getDate())&&age--,age),patient.extras.birthday=formatDateCH(patient.birthdate),patient.extras.birthday_age=patient.extras.birthday+" | "+patient.extras.age,patient.extras.name=patient.last_name+" "+patient.first_name;var birthYear=new Date(patient.birthdate);birthYear=birthYear.getFullYear(),patient.extras.birth_year=birthYear,patient.extras.secure=patient.last_name.substring(0,2)+". "+patient.first_name.substring(0,1)+". ("+birthYear+")","male"===patient.gender?(patient.extras.ansprache="Herr",patient.extras.anrede="Herr "+patient.last_name):(patient.extras.ansprache="Frau",patient.extras.anrede="Frau "+patient.last_name),patient.extras.full_name=patient.extras.ansprache+" "+patient.extras.name+" ("+patient.extras.birthday_age+")",patient.extras.full_address=patient.address1+", "+patient.zip_code+" "+patient.city;var myPhone="";patient.phone_home&&(myPhone=patient.phone_home),patient.phone_mobile&&(myPhone=""!=myPhone?myPhone+", "+patient.phone_mobile:patient.phone_mobile),patient.extras.phone=myPhone,patient.extras.infoline=patient.extras.full_address,""!=myPhone&&(patient.extras.infoline,patient.extras.phone);var myColor="#3F51B5",myColorAccent="#E91E63";return"female"===patient.gender&&(myColor="#E91E63",myColorAccent="#3F51B5"),patient.extras.color_main=myColor,patient.extras.color_accent=myColorAccent,patient.extras},createStayExtras=function(current_stay){current_stay.extras={},current_stay.extras.in_stay=!1,current_stay.stop?(current_stay.extras.duration=Math.floor((Date.parse(current_stay.stop)-Date.parse(current_stay.start))/864e5),current_stay.extras.duration=current_stay.extras.duration+1):current_stay.extras.duration=Math.floor((new Date-Date.parse(current_stay.start))/864e5);var phase=current_stay.phase,translated_de="";return"before_stay"===phase&&(translated_de="Bevorstehende Behandlung",translated_en="the stay starts in the future"),"in_stay"===phase&&(translated_de="In aktueller Behandlung",translated_en="the patient is currently in stay",current_stay.extras.in_stay=!0),"after_exit"===phase&&(translated_de="Die Behandlung wurde vor weniger als 14 Tage beendet",translated_en="the stay ended less than 14 days ago (included)"),"frozen"===phase&&(translated_de="Die Behandlung wurde manuell eingefroren",translated_en="the stay has manually been frozen (no more events, changes, ...)"),"unfrozen"===phase&&(translated_de="Die Behandlung ist abgeschlossen, wurde jedoch zur Bearbeitung wieder geöffnet",translated_en="the stay is complete but has been unfrozen by somebody"),"complete"===phase&&(translated_de="Die Behandlung wurde vor mehr als 14 Tage beendet",translated_en="the stay ended more than 14 days ago"),current_stay.extras.phase_de=translated_de,current_stay.extras.phase_en=translated_en,current_stay.extras.beginn=formatDateCH(current_stay.start),current_stay.extras.from_to=formatDateCH(current_stay.start),current_stay.extras.from_to=current_stay.extras.from_to+" - ",current_stay.stop?(current_stay.extras.from_to=current_stay.extras.from_to+formatDateCH(current_stay.stop),current_stay.extras.ende=formatDateCH(current_stay.stop)):current_stay.extras.from_to=current_stay.extras.from_to+"Unbekannt",current_stay},createEventExtras=function(current_event){var extras={};return extras.created_at=formatDateCH(current_event.created_at),extras.due=formatDateCH(current_event.due),extras.status=current_event.status.charAt(0).toUpperCase()+current_event.status.slice(1),extras.status_de="Undefined","done"===current_event.status&&(extras.status_de="Erledigt",extras.show_do_it_now=!1),"to_be_done"===current_event.status&&(extras.status_de="Offen",extras.show_do_it_now=!0),"aborted"===current_event.status&&(extras.status_de="Abgebrochen",extras.show_do_it_now=!1),"irrelevant"===current_event.status&&(extras.status_de="Nicht relevant",extras.show_do_it_now=!1),extras};

var makepdf=function(){var _getImage=function(image){var images={optinomic_trademark:"data:image/png;base64,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",suedhang:"data:image/png;base64,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"};return(image=void 0===image?"optinomic_trademark":image)in images?images[image]:images.optinomic_trademark},_formatDateCH=function(date_string){if(null!==(date_string=date_string||null)){var year=parseInt(date_string.substring(0,4)),month=parseInt(date_string.substring(5,7));return parseInt(date_string.substring(8,10))+"."+month+"."+year}return null},_hasValue=function(value){return null!==value&&"null"!==value&&void 0!==value&&""!==value},_create_document=function(documentTitle,headerLeft,headerRight,footerLeft,pageSize,pageOrientation,hideLogo,hidePageNumbers){return documentTitle=void 0===documentTitle?"Optinomic":documentTitle,headerLeft=void 0===headerLeft?"":headerLeft,headerRight=void 0===headerRight?"":headerRight,footerLeft=void 0===footerLeft?"":footerLeft,pageSize=void 0===pageSize?"A4":pageSize,pageOrientation=void 0===pageOrientation?"portrait":pageOrientation,hideLogo=void 0!==hideLogo&&hideLogo,hidePageNumbers=void 0!==hidePageNumbers&&hidePageNumbers,{pageSize:pageSize,pageOrientation:pageOrientation,info:{title:_create_document_name(documentTitle,headerLeft),author:headerRight,subject:documentTitle+" - "+headerLeft+" - "+headerRight,keywords:headerLeft+", "+headerRight+", "+documentTitle+", Optinomic"},header:{columns:[{text:headerLeft,alignment:"left",style:"header"},{text:headerRight,alignment:"right",style:"header"}]},content:[],styles:{header:{fontSize:11,bold:!1,color:"#9E9E9E",margin:[40,25,40,40]},footer:{fontSize:11,bold:!1,color:"#9E9E9E",margin:[40,0,40,40]},title:{fontSize:36,bold:!1,color:"#616161",alignment:"left",margin:[0,40,0,0]},caption:{fontSize:11,bold:!1,color:"#9E9E9E",alignment:"left",margin:[0,0,0,0]},h1:{fontSize:18,bold:!1,color:"#424242",alignment:"left",margin:[0,40,0,24]},h2:{fontSize:15,bold:!1,color:"#212121",alignment:"left",margin:[0,20,0,12]},h3:{bold:!0,color:"#212121",alignment:"left",margin:[0,0,0,6]},p:{color:"#212121",alignment:"left",fontSize:12,margin:[0,0,0,6]},chart_p:{color:"#212121",alignment:"left",fontSize:8.3,margin:[0,3,0,3]}}}},_create_document_name=function(title,left){var doc_name="",d=new Date,y=d.getFullYear(),m=d.getMonth()+1,t=d.getUTCDate();d.getHours(),d.getMinutes();return m<10&&(m="0"+m),t<10&&(t="0"+t),datum_str=y+"_"+m+"_"+t,doc_name=doc_name+datum_str+" - "+title.replace(/\./g,"")+" - "+left.replace(/\./g,""),doc_name+=".pdf"},_addFooter=function(dd,footerLeft,hidePageNumbers){if(hidePageNumbers)dd.footer={text:footerLeft,alignment:"left",style:"footer"};else{var footer=function(currentPage,pageCount){return{columns:[{text:"___footerLeft___",alignment:"left",style:"footer"},{text:"Seite "+currentPage.toString()+"/"+pageCount.toString(),alignment:"right",style:"footer"}]}},footer_string=footer.toString();footer_string=footer_string.replace("___footerLeft___",footerLeft),eval("dd.footer="+footer_string)}return dd},_keepTogether=function(given_stack_array,id){id=void 0===id?"keep_together":id;var obj,stack_array=[];return void 0!==(obj=given_stack_array)&&obj&&obj.constructor===Array?stack_array=given_stack_array:stack_array.push(given_stack_array),{id:id,layout:"noBorders",table:{dontBreakRows:!0,headerRows:0,body:[[{stack:stack_array}]]}}},_spacer=function(space){return{text:"",margin:[0,space,0,space]}},_title=function(title,subtitle){return{id:(title=void 0===title?"":title)+"_"+(subtitle=void 0===subtitle?"":subtitle),stack:[{text:" "+title,style:"title",alignment:"left"},{text:" "+subtitle,style:"caption",color:"#616161",margin:[1,0,0,0],alignment:"left"}],margin:[0,24,0,36]}},_heading=function(text_left,text_left_sub,style){text_left=void 0===text_left?"Optinomic":text_left,text_left_sub=void 0===text_left_sub?null:text_left_sub,"h1"!==(style=void 0===style?"h2":style)&&"h2"!==style&&"h3"!==style&&(style="h2");var left={id:"heading_"+style,stack:[{text:text_left,style:style,margin:[0,12,0,0],alignment:"left"}],margin:[0,0,0,12]};if(null!==text_left_sub){var sub={text:text_left_sub,style:"caption",color:"#616161",margin:[1,0,0,0],alignment:"left"};left.stack.push(sub)}return left},_text=function(text){return{text:" "+(text=void 0===text?"Optinomic":text),style:"p"}},_caption=function(text){return{text:text=void 0===text?"Optinomic":text,style:"caption"}},_pageBreak=function(when){return{fontSize:0,text:"",pageOrientation:"portrait",pageBreak:when=void 0===when?"after":when}},_horizontalLine=function(width,color,space){return width=void 0===width?100:width,color=void 0===color?"#E0E0E0":color,{margin:[0,space=void 0===space?6:space,0,0],canvas:[{type:"line",x1:0,y1:0,x2:5.14*width,y2:0,lineWidth:1,lineColor:color}]}},_noData=function(title,text,space){title=void 0===title?null:title,text=void 0===text?"Keine Daten vorhanden.":text,space=void 0===space?24:space;var date=new Date;date=_formatDateCH(date.toISOString()),null!==title&&(text=title+text);var no_data={table:{widths:[24,"*"],body:[[{text:"!",color:"#F44336",fontSize:36,margin:[0,0,0,0]},{stack:[{text:date,fontSize:9,color:"#BDBDBD",margin:[0,6,0,0]},{text:text,color:"#424242",margin:[0,6,0,0]}],margin:[0,0,0,6]}]]},layout:"noBorders",margin:[space,space,space,space]},return_obj={stack:[]};return return_obj.stack.push(_horizontalLine(100,"#F5F5F5")),return_obj.stack.push(no_data),return_obj.stack.push(_horizontalLine(100,"#F5F5F5")),_keepTogether(return_obj,"no_data")},_indication=function(sign,title,color){sign=void 0===sign?"!":sign,title=void 0===title?"Optinomic":title,color=void 0===color?"#F44336":color;var date=new Date,indication={id:"indication_"+sign,table:{widths:[24,"*"],body:[[{text:sign,color:color,fontSize:36,margin:[0,0,0,0]},{stack:[{text:date=_formatDateCH(date.toISOString()),fontSize:9,color:"#BDBDBD",margin:[0,6,0,0]},{text:title,color:"#424242",margin:[0,6,0,0]}],margin:[0,0,0,6]}]]},layout:"noBorders",margin:[24,24,24,24]},return_obj={stack:[]};return return_obj.stack.push(_horizontalLine(100,"#F5F5F5")),return_obj.stack.push(indication),return_obj.stack.push(_horizontalLine(100,"#F5F5F5")),_keepTogether(return_obj,sign+"_indication")},_suedhang_logo_anschrift=function(space){return{id:"suedhang_logo_anschrift",alignment:"left",margin:[0,space=void 0===space?90:space,0,0],columns:[{},{width:220,stack:[{width:220,image:_getImage("suedhang")},{margin:[0,6,0,0],fontSize:10,color:"#69604d",alignment:"left",text:" Kompetenzzentrum für Mensch und Sucht"},{margin:[0,3,0,0],fontSize:10,color:"#69604d",alignment:"left",text:" Südhang 1"},{margin:[0,3,0,0],fontSize:10,color:"#69604d",alignment:"left",text:" CH - 3038 Kirchlindach"},{margin:[0,12,0,0],fontSize:10,color:"#69604d",alignment:"left",text:" +41 31 828 14 14  |  Telefon"},{margin:[0,3,0,0],fontSize:10,color:"#69604d",alignment:"left",text:" +41 31 828 14 24  |  Fax"}]}]}},_stamp=function(documentTitle,space){documentTitle=void 0===documentTitle?"Optinomic":documentTitle,space=void 0===space?36:space;var d=new Date,y=d.getFullYear(),m=d.getMonth()+1,_date_time=d.getUTCDate()+"."+m+"."+y+", "+d.getHours()+":"+d.getMinutes();return{margin:[0,space,0,space],alignment:"left",columnGap:12,columns:[{width:48,margin:[0,6,0,0],image:_getImage("optinomic_trademark")},{width:"*",stack:[{fontSize:12,bold:!1,color:"#3F51B5",alignment:"left",margin:[0,2,0,0],text:"«"+documentTitle+"»"},{fontSize:10,bold:!1,color:"#616161",margin:[0,4,0,0],alignment:"left",text:"Datenstand: "+_date_time},{fontSize:10,bold:!1,color:"#3F51B5",alignment:"left",margin:[0,6,0,0],text:"www.optinomic.com"},{fontSize:9,bold:!1,color:"#616161",alignment:"left",text:"Erkenntnisgewinn für den Behandlungsalltag"}]}]}},_pdf_chart_profile=function(l,o,st,cs,csd,s,sc,r){var d,_return,_inner,options=void 0===o?{}:Object.assign({},o),clinic_samples=(statusbar,void 0===cs?{}:cs),_scales_scores=function(scores,init){return init.scales.forEach(function(scale,scaleID){scale.scores=[],scale.id=scaleID,void 0!==scores&&null!==scores&&scores.forEach(function(score,scoreID){var score_obj={value:null,title:"Unbekannt",date:null,dropout:!1,dropout_reason:null};scale.score_path&&(score_obj.value=_getDataPath(score,scale.score_path)),init.options.response_title_path&&(score_obj.title=_getDataPath(score,init.options.response_title_path)),init.options.response_date_path&&(score_obj.date=_getDataPath(score,init.options.response_date_path),score_obj.date=_formatDateCH(score_obj.date)),"dropout_flag"in init.options&&""!==init.options.dropout_flag&&null!==init.options.dropout_flag&&void 0!==init.options.dropout_flag&&(score_obj.dropout=_getDataPath(score,init.options.dropout_flag)),"dropout_reason"in init.options&&""!==init.options.dropout_reason&&null!==init.options.dropout_reason&&void 0!==init.options.dropout_reason&&(score_obj.dropout_reason=_getDataPath(score,init.options.dropout_reason)),scale.scores.push(score_obj)})}),init},_getDataPath=function(current_score,path){var data_dive=JSON.parse(JSON.stringify(current_score)),dots_count=path.split(".").length-1;if(0===dots_count)return data_dive[path];var dive=[];for(i=0;i<dots_count;i++){var n=path.indexOf("."),item=path.substring(0,n);path=path.substring(n+1,path.length),dive.push(item),i===dots_count-1&&dive.push(path)}for(i=0;i<dive.length;i++)if(data_dive=data_dive[dive[i]],i===dots_count)return data_dive},_autoMinMax=function(data){var d=JSON.parse(JSON.stringify(data));return(d.options.do_max||d.options.do_min)&&(d.options.do_min&&(d.options.item_min=0),d.options.do_max&&(d.options.item_max=0),d.scales.forEach(function(scale,scaleID){scale.scores.forEach(function(score,scoreID){d.options.do_min&&score.value<d.options.item_min&&(d.options.item_min=score.value),d.options.do_max&&score.value>d.options.item_max&&(d.options.item_max=score.value)})}),d.options.do_min?(d.options.item_min<0?(d.options.item_min=Math.ceil(Math.abs(d.options.item_min))+1,d.options.item_min=-1*d.options.item_min):d.options.item_min=Math.ceil(Math.abs(d.options.item_min))+1,d.options.item_min>0&&(d.options.item_min=0)):d.options.item_min=d.options.min,d.options.do_max?d.options.item_max<0?(d.options.item_max=Math.ceil(Math.abs(d.options.item_max))+1,d.options.item_max=-1*d.options.item_max):d.options.item_max=Math.ceil(Math.abs(d.options.item_max))+1:d.options.item_max=d.options.max),d.options.min_max_range=d.options.item_max-d.options.item_min,d.options.item_min<0&&(d.options.min_max_range=d.options.item_max+Math.abs(d.options.item_min)),d},_getXPos=function(min,max,svg_width_100,current_value){var width_value=null;if(void 0!==current_value){var width_100=Math.abs(min)+Math.abs(max);width_value=svg_width_100/width_100*(current_value+Math.abs(min)),width_value_max=svg_width_100/width_100*(Math.abs(max)+Math.abs(min)),width_value>width_value_max&&(width_value=width_value_max),width_value<0&&(width_value=0)}return width_value},_shadeColor=function(color,percent){var f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?-1*percent:percent,R=f>>16,G=f>>8&255,B=255&f;return"#"+(16777216+65536*(Math.round((t-R)*p)+R)+256*(Math.round((t-G)*p)+G)+(Math.round((t-B)*p)+B)).toString(16).slice(1)},_getColor=function(id,color_skin){var colors=[];return"default"===(color_skin=void 0===color_skin?"default":color_skin)&&(colors.push("#3F51B5"),colors.push("#E91E63"),colors.push("#00BCD4"),colors.push("#8BC34A"),colors.push("#FFC107"),colors.push("#795548"),colors.push("#673AB7"),colors.push("#F44336"),colors.push("#03A9F4"),colors.push("#4CAF50"),colors.push("#FFEB3B"),colors.push("#FF5722"),colors.push("#2196F3"),colors.push("#9C27B0"),colors.push("#009688"),colors.push("#CDDC39"),colors.push("#FF9800"),colors.push("#607D8B")),"grey_dark_to_light"===color_skin&&(colors.push("#424242"),colors.push("#9E9E9E"),colors.push("#E0E0E0"),colors.push("#FAFAFA")),"indigo_dark_to_light"===color_skin&&(colors.push("#283593"),colors.push("#3F51B5"),colors.push("#7986CB"),colors.push("#E8EAF6")),"pink_dark_to_light"===color_skin&&(colors.push("#AD1457"),colors.push("#E91E63"),colors.push("#7986CB"),colors.push("#E8EAF6")),"indigo_grey_pink"===color_skin&&(colors.push("#1A237E"),colors.push("#212121"),colors.push("#880E4F"),colors.push("#3F51B5"),colors.push("#9E9E9E"),colors.push("#E91E63"),colors.push("#C5CAE9"),colors.push("#F5F5F5"),colors.push("#F8BBD0")),"zebra"===color_skin&&(colors.push("#212121"),colors.push("#EEEEEE")),id>colors.length-1?colors[id-Math.floor(id/colors.length)*colors.length]:colors[id]},init=function(scores,definition,scales,ranges,clinic_samples,clinic_sample_dive){var d={};d.options=definition,d.options.offset_top=10,"item_height"in d.options?d.options.item_height=d.options.item_height:d.options.item_height=60,"topnumber_hide_first_last"in d.options?d.options.topnumber_hide_first_last=d.options.topnumber_hide_first_last:d.options.topnumber_hide_first_last=!1,"show_ranges_overview"in d.options?d.options.show_ranges_overview=d.options.show_ranges_overview:d.options.show_ranges_overview=!0,"item_text_left"in d.options?d.options.item_text_left=d.options.item_text_left:d.options.item_text_left=73,"item_text_right"in d.options?d.options.item_text_right=d.options.item_text_right:d.options.item_text_right=73,"dropout_flag"in d.options?d.options.dropout_flag=d.options.dropout_flag:d.options.dropout_flag=null,"dropout_reason"in d.options?d.options.dropout_reason=d.options.dropout_reason:d.options.dropout_reason=null;d.options.item_text_left=d.options.item_text_left/2+12,d.options.item_text_right=d.options.item_text_right/2+12,d.options.item_text_left<=62?d.options.legend_left=62:d.options.legend_left=d.options.item_text_left,d.options.chart_width=495-d.options.item_text_left-d.options.item_text_right;"show_scale_text"in d.options&&d.options.show_scale_text;"color_grid"in d.options&&d.options.color_grid,d.scales=scales,d.scales.length>0?d.options.chart_height=d.scales.length*d.options.item_height:d.options.chart_height=0,d.ranges=ranges,d.ks=null!==clinic_samples&&void 0!==clinic_samples?clinic_samples:null;var ks_dive={defined:!1,text:"",data:null,array:[]};return null!==clinic_sample_dive&&void 0!==clinic_sample_dive&&(ks_dive.array=clinic_sample_dive,ks_dive.array.length>0&&(ks_dive.defined=!0)),d.ks_dive=ks_dive,d.options.do_min=!1,"auto"===d.options.min||void 0===d.options.min?d.options.do_min=!0:d.options.item_min=parseInt(d.options.min),d.options.do_max=!1,"auto"===d.options.max||void 0===d.options.max?d.options.do_max=!0:d.options.item_max=parseInt(d.options.max),d.scores=scores.data,d.scores.length>0?(d.have_data=!0,d=_scales_scores(d.scores,d),d=_autoMinMax(d)):d.have_data=!1,console.log("<optinomic-pdf-chart-profile>",d),d}(void 0===sc?{}:sc,options,void 0===s?{}:s,void 0===r?{}:r,clinic_samples,void 0===csd?[]:csd),chart_stack=[],chart_top=[];if(!0===init.have_data){chart_stack.push(function(d){var _scales_text={id:"scales_text",stack:[]};return d.scales.length>0&&d.scales.forEach(function(scale,scaleID){var left_text=[],right_text=[];if(_hasValue(scale.left_title))if(""!==scale.left_text&&d.options.show_scale_text){var title={text:scale.left_title+": ",bold:!0},text={text:scale.left_text,bold:!1};left_text.push(title),left_text.push(text)}else title={text:scale.left_title,bold:!0},left_text.push(title);else""!==scale.left_text&&(text={text:scale.left_text,bold:!1},left_text.push(text));_hasValue(scale.right_title)?""!==scale.right_text&&d.options.show_scale_text?(title={text:scale.right_title+": ",bold:!0},text={text:scale.right_text,bold:!1},right_text.push(title),right_text.push(text)):(title={text:scale.right_title,bold:!0},right_text.push(title)):""!==scale.right_text&&(text={text:scale.right_text,bold:!1},right_text.push(text));var inner_width=495-d.options.item_text_left-d.options.item_text_right,column_scale={columns:[{width:d.options.item_text_left,style:"chart_p",alignment:"right",text:left_text},{width:inner_width,text:""},{width:d.options.item_text_right,style:"chart_p",alignment:"left",text:right_text}],relativePosition:{x:0,y:scaleID*d.options.item_height+d.options.offset_top},columnGap:10};_scales_text.stack.push(column_scale)}),_scales_text}(init)),chart_stack.push(function(d){var beschriftung_top={id:"numbers_top",stack:[]},grind_count=0;for(i=0;i<d.options.min_max_range+1;i++)if(0===i||grind_count===d.options.vertical_grid_every_x){var my_x=_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,d.options.item_min+i),inner={color:"#616161",fontSize:8,alignment:"left",text:d.options.item_min+i,relativePosition:{x:d.options.item_text_left+8+my_x,y:0}};d.options.topnumber_hide_first_last?0!==i&&i!==d.options.min_max_range&&beschriftung_top.stack.push(inner):beschriftung_top.stack.push(inner),grind_count=1}else grind_count+=1;return beschriftung_top}(init)),chart_stack.push((_return={id:"ranges",stack:[]},_inner={relativePosition:{x:(d=init).options.item_text_left+10,y:d.options.offset_top},canvas:[]},d.ranges.forEach(function(range,rangeID){var my_x=0;-999!==range.range_start&&(my_x=_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,range.range_start));var my_y=d.options.chart_width;999!==range.range_stop&&(my_y=_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,range.range_stop)),range={type:"rect",x:my_x,y:0,w:my_y-my_x,h:d.options.chart_height,color:_shadeColor(range.color,1-d.options.range_alpha)},_inner.canvas.push(range)}),_return.stack.push(_inner),_return)),null!==init.ks&&chart_stack.push(function(d,clinic_samples){var _return={id:"clinic_sample",stack:[]},_inner={relativePosition:{x:d.options.item_text_left+10,y:d.options.offset_top},canvas:[]};d.ks_dive=function(d,clinic_samples){d.scores[d.scores.length-1];var clinic_sample_dive={defined:!1,text:"",data:null,array:[]};if(d.ks_dive.defined&&(clinic_sample_dive=d.ks_dive),d.ks_dive.defined||JSON.stringify(clinic_samples)===JSON.stringify({})||(clinic_samples.dimensions.forEach(function(dim){clinic_sample_dive.array.push(dim.array.length-1)}),console.log("Defaultstichprobe erstellt!")),d.ks_dive.defined&&JSON.stringify(clinic_samples)!==JSON.stringify({})){var dive_data=d.ks.data;d.ks_dive.array.forEach(function(dive,diveID){dive_data=JSON.parse(JSON.stringify(dive_data[dive]))});try{clinic_sample_dive.data=JSON.parse(JSON.stringify(dive_data.statistics))}catch(err){clinic_sample_dive.data={}}var n_value=0;for(var property in clinic_sample_dive.data)clinic_sample_dive.data.hasOwnProperty(property)&&(n_value=clinic_sample_dive.data[property].n);clinic_sample_dive.text="",d.ks.dimensions.forEach(function(dim,dimID){var pos=d.ks_dive.array[dimID],dim_text=dim.name+": "+dim.array[pos].text;dimID!==d.ks.dimensions.length-1&&(dim_text+=", "),clinic_sample_dive.text=clinic_sample_dive.text+dim_text}),0!==n_value&&(clinic_sample_dive.text=clinic_sample_dive.text+" (N="+n_value+")"),clinic_sample_dive.defined=!0}return clinic_sample_dive}(d,clinic_samples);var ks_points=[],ks_line_points=[];try{d.scales.forEach(function(scale,scaleID){var ks_var=d.ks_dive.data[scale.clinic_sample_var]||{},mean_1sd_min=ks_var.mean_1sd_min||0,mean=(ks_var.mean_1sd_plus,ks_var.mean||0),my_y_1=scaleID*d.options.item_height+7;0===scaleID&&(my_y_1=0);var my_y_2=scaleID*d.options.item_height+(d.options.item_height-7);scaleID===d.scales.length-1&&(my_y_2=d.options.chart_height);var point_1={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean_1sd_min),y:my_y_1},point_2={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean_1sd_min),y:my_y_2};ks_points.push(point_1),ks_points.push(point_2);var line_point_1={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean),y:my_y_1},line_point_2={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean),y:my_y_2};ks_line_points.push(line_point_1),ks_line_points.push(line_point_2)});var clone_scales=JSON.parse(JSON.stringify(d.scales));clone_scales.reverse(),clone_scales.forEach(function(scale,scaleID){var scaleIDCorrected=clone_scales.length-1-scaleID,ks_var=d.ks_dive.data[scale.clinic_sample_var]||{},mean_1sd_plus=(ks_var.mean_1sd_min,ks_var.mean_1sd_plus||0),my_y_1=(ks_var.mean,scaleIDCorrected*d.options.item_height+(d.options.item_height-7)),my_y_2=scaleIDCorrected*d.options.item_height+7;0===scaleIDCorrected&&(my_y_2=0),scaleIDCorrected===d.scales.length-1&&(my_y_1=d.options.chart_height);var point_1={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean_1sd_plus),y:my_y_1},point_2={x:_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,mean_1sd_plus),y:my_y_2};ks_points.push(point_1),ks_points.push(point_2)});var ks_area={type:"polyline",fillOpacity:.5,color:d.options.color_clinic_sample,points:ks_points};_inner.canvas.push(ks_area);var ks_line={type:"polyline",lineWidth:2,lineColor:_shadeColor(d.options.color_grid,.5),points:ks_line_points};_inner.canvas.push(ks_line),_return.stack.push(_inner)}catch(e){}return _return}(init,clinic_samples)),chart_stack.push(function(d){var _grid={id:"grid",stack:[]},_grid_inner={relativePosition:{x:d.options.item_text_left+10,y:0},canvas:[{type:"rect",x:0,y:d.options.offset_top,w:d.options.chart_width,h:d.options.chart_height,lineColor:d.options.color_grid}]};d.scales.length>0&&d.scales.forEach(function(scale,scaleID){var horizontal_line={type:"line",x1:0,y1:scaleID*d.options.item_height+d.options.offset_top,x2:d.options.chart_width,y2:scaleID*d.options.item_height+d.options.offset_top,lineWidth:1,lineColor:d.options.color_grid};0!==scaleID&&_grid_inner.canvas.push(horizontal_line)});var grind_count=0;for(i=0;i<d.options.min_max_range;i++)if(grind_count===d.options.vertical_grid_every_x){var my_x=_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,d.options.item_min+i),line_width=1;d.options.item_min+i===0&&0!==i&&(line_width=2);var vertical_line={type:"line",x1:my_x,y1:d.options.offset_top,x2:my_x,y2:d.options.chart_height+d.options.offset_top,lineWidth:line_width,lineColor:d.options.color_grid};_grid_inner.canvas.push(vertical_line),grind_count=1}else grind_count+=1;return _grid.stack.push(_grid_inner),_grid}(init)),chart_stack.push(function(d){var _return={id:"scores",stack:[]},_inner={relativePosition:{x:d.options.item_text_left+10,y:d.options.offset_top},canvas:[]},points_obj={},lines_count=0,dots=[];for(d.scales.forEach(function(scale,scaleID){scale.scores.forEach(function(score,scoreID){if(!0!==score.dropout){lines_count=scoreID+1,void 0===points_obj[scoreID]&&(points_obj[scoreID]=[]),my_x=_getXPos(d.options.item_min,d.options.item_max,d.options.chart_width,score.value);var my_y=scaleID*d.options.item_height+d.options.item_height/2,point={x:my_x,y:my_y};if(points_obj[scoreID].push(point),d.options.show_score_vertical_line){var show_score_vertical_line={type:"line",x1:my_x,y1:scaleID*d.options.item_height,x2:my_x,y2:scaleID*d.options.item_height+d.options.item_height,lineWidth:4,lineColor:_getColor(scoreID,d.options.color_skin)};_inner.canvas.push(show_score_vertical_line)}if(d.options.show_score_circles){var circle_color="#FFFFFF";d.ranges.forEach(function(range,rangeID){score.value>=range.range_start&&score.value<=range.range_stop&&(circle_color=range.color)});var circle={type:"ellipse",x:my_x,y:my_y,color:circle_color,lineColor:_getColor(scoreID,d.options.color_skin),lineWidth:2,fillOpacity:.9,r1:4.25,r2:4.25};dots.push(circle)}}})}),i=0;i<lines_count;i++){var score_line={type:"polyline",lineWidth:3,lineColor:_getColor(i,d.options.color_skin),points:points_obj[i]};_inner.canvas.push(score_line)}return d.options.show_score_circles&&dots.forEach(function(dot,dotID){_inner.canvas.push(dot)}),_return.stack.push(_inner),_return}(init));var spacer={canvas:[{type:"rect",x:-3,y:0,w:0,h:init.options.offset_top+init.options.chart_height+6,lineColor:"#FFFFFF"}]};chart_stack.push(spacer),chart_stack.push(function(init){var messung_title="Keine Daten vorhanden.";1===init.scores.length&&(messung_title="Messung"),init.scores.length>1&&(messung_title="Messungen");var messungen={columns:[{width:init.options.legend_left,style:"chart_p",color:"#757575",alignment:"right",text:[{text:messung_title}]}],columnGap:10};return init.scores.forEach(function(score,scoreID){"dropout_flag"in init.options&&""!==init.options.dropout_flag&&null!==init.options.dropout_flag&&void 0!==init.options.dropout_flag&&(score.dropout_have=_getDataPath(score,init.options.dropout_flag)),"dropout_reason"in init.options&&""!==init.options.dropout_reason&&null!==init.options.dropout_reason&&void 0!==init.options.dropout_reason&&(score.dropout_reason=_getDataPath(score,init.options.dropout_reason));var zuordner={width:10,canvas:[{type:"line",x1:0,y1:8,x2:15,y2:8,lineWidth:4,lineColor:_getColor(scoreID,init.options.color_skin)}]},title=_getDataPath(score,init.options.response_title_path),date=_getDataPath(score,init.options.response_date_path);date=_formatDateCH(date);var dropout_text="";score.dropout_have?(dropout_text="Dropout: ","dropout_reason"in score&&""!==score.dropout_reason&&(dropout_text=dropout_text+_getDataPath(score,init.options.dropout_reason)+" "),""!==dropout_text&&null!==dropout_text&&"null"!==dropout_text&&(date=date+", "+dropout_text)):messungen.columns.push(zuordner);var beschriftung={width:"*",style:"chart_p",alignment:"left",text:[{text:title},{text:" ("+date+")",color:"#757575"}]};messungen.columns.push(beschriftung)}),messungen}(init)),chart_top.push({text:"",margin:[0,0,0,6]}),chart_top.push(function(init){if("norm_sample"in init.options){if(_hasValue(init.options.norm_sample))var normstichprobe={columns:[{width:init.options.legend_left,style:"chart_p",color:"#757575",alignment:"right",text:[{text:"Normstichprobe"}]},{width:"*",style:"chart_p",alignment:"left",text:[{text:init.options.norm_sample}]}],columnGap:10}}else normstichprobe={};return normstichprobe}(init)),chart_top.push(function(init){var return_object={};void 0!==init.ks_dive&&1==init.ks_dive.defined&&(return_object={columns:[{width:init.options.legend_left,style:"chart_p",color:"#757575",alignment:"right",text:[{text:"Klinikstichprobe"}]},{width:"*",style:"chart_p",alignment:"left",text:[{text:init.ks_dive.text}]}],columnGap:10});return return_object}(init)),init.options.show_ranges_overview&&chart_top.push(function(init){var interpretation={columns:[{width:init.options.legend_left,style:"chart_p",color:"#757575",alignment:"right",text:[{text:"Interpretation"}]}],columnGap:10},beschriftung={width:"*",style:"chart_p",alignment:"left",text:[]};return void 0!==init.ranges&&(init.ranges.forEach(function(range,rangeID){var title=range.text,range_text="";-999!==range.range_start?(range_text=range.range_start,999!==range.range_stop&&(range_text=">"+range_text+" bis ")):range_text="<=",999!==range.range_stop?range_text+=range.range_stop:range_text=">="+range_text;var title_obj={text:title},range_obj={text:" ("+range_text+")",color:"#757575"};beschriftung.text.push(title_obj),beschriftung.text.push(range_obj),rangeID!==init.ranges.length-1&&(title_obj={text:", "},beschriftung.text.push(title_obj))}),interpretation.columns.push(beschriftung)),interpretation}(init)),chart_top.push(function(init,start){var return_object={};void 0!==start&&1==init.ks_dive.defined&&(return_object={columns:[{width:init.options.item_text_left,style:"chart_p",alignment:"right",color:start.left_color,text:start.left_title},{width:"*",style:"chart_p",alignment:"left",text:[{text:start.left_text}]},{width:"*",style:"chart_p",alignment:"right",text:[{text:start.right_text}]},{width:init.options.item_text_right,style:"chart_p",alignment:"left",color:start.right_color,text:start.right_title}],columnGap:10});return return_object}(init)),chart_top.push({text:"",margin:[0,0,0,6]}),chart_stack=chart_top.concat(chart_stack)}return{id:"chart_zscore",layout:"noBorders",table:{dontBreakRows:!0,headerRows:0,body:[[{stack:chart_stack}]]}}};return{_create_document:_create_document,_create_document_name:_create_document_name,_addFooter:_addFooter,_keepTogether:_keepTogether,_spacer:_spacer,_title:_title,_heading:_heading,_text:_text,_caption:_caption,_pageBreak:_pageBreak,_horizontalLine:_horizontalLine,_noData:_noData,_indication:_indication,_suedhang_logo_anschrift:_suedhang_logo_anschrift,_stamp:_stamp,_hasValue:_hasValue,_pdf_chart_profile:_pdf_chart_profile}}();


</script>

<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.62/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.62/vfs_fonts.js"></script>
